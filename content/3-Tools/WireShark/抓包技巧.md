可以通过使用 [capture filters](https://gitlab.com/wireshark/wireshark/-/wikis/CaptureFilters) 和 [display filters](https://gitlab.com/wireshark/wireshark/-/wikis/DisplayFilters) 准确获取你想抓取的数据包。

> [! tip] Filters Syntax
> capture filters 语法请参考 [pcap-filter(7)](https://man.archlinux.org/man/pcap-filter.7) ，display filters 语法参考 [wireshark-filter(4)](https://man.archlinux.org/man/wireshark-filter.4)。

## 过滤 TCP 包
查看所有 TCP 数据包，则在 *Filter* 栏输入 `tcp`，或在终端使用：
```shell
tshark -f "tcp"
```

## 过滤 UDP 包
同上，在 *Filter* 栏输入 `udp`，或在终端使用：
```shell
tshark -f "udp"
```


## 查看指定 IP 地址的数据包
1. 只查看发送到特定地址的数据包：`ip.dst == 1.2.3.4`；
2. 只查看从特定地址发出的数据包：`ip.src == 1.2.3.4`；
3. 查看某个特定地址的所有数据包：`ip.addr == 1.2.3.4`；

## 排除特定 IP 地址的数据包
要排除特定地址：
```shell
ip.addr != 1.2.3.4
```

## 查看局域网数据包
过滤所有来自私有网络地址的数据包：
```shell
(ip.src==10.0.0/8 AND ip.dst==10.0.0/8) OR (ip.src==172.16.0.0/12 AND ip.dst==172.16.0.0/12) OR (ip.src==192.168.0.0/16 and ip.dst==192.168.0.0/16)
```

## 查看指定端口的数据包
查看某两个或更多端口的流量：
```shell
tcp.port==80||tcp.port==3306
tcp.port==80||tcp.port==3306||tcp.port==443
```

## 使用 dumpcap 捕获数据包
dumpcap 是 Wireshark 的一部分，可以使用该工具在无图形界面的情况下捕获数据包。dumpcap 可以在 [tmux]( https://wiki.archlinuxcn.org/wiki/Tmux "Tmux") 或 [GNU Screen]( https://wiki.archlinuxcn.org/wiki/GNU_Screen "GNU Screen") 中使用，以在一个处于 Detached 状态的会话中捕获数据包。可以使用 `-h` 参数查看 dumpcap 的所有选项。

下面的例子展示了如何捕获循环缓冲区（ringbuffer）中内容。下面的命令会以每个文件 100MB 的大小捕获20个`.pcap`文件，并且会在捕获第21个文件时替换最早创建的文件并依次继续。因此此命令会保持运行，而不会持续消耗磁盘空间以致磁盘容量耗尽。

```shell
dumpcap -i 1 -b filesize:100000 -b files:20 -w _mycapture_.pcapng
```
-   `-i` - 接口名称或编号（`dumpcat -D` 命令列出的编号）
-   `-b filesize:` - 创建的`.pcap`文件的大小，以 kB 为单位
-   `-b files:` - 在输出指定的文件数量后覆盖旧文件
-   `-w` - 输出文件名，上例中输出会保存到 `mycapture_identifier_.pcapng`

