## A += Assignment Puzzler

Try to answer without using the console: what is the result of evaluating the two expressions in [Example 2-16](#ex_aug_item_assign_question)?[^9]

##### Example 2-16. A riddle

```
>>> 
```

What happens next? Choose the best answer:

1. `t` becomes `(1, 2, [30, 40, 50, 60])`.
    
2. `TypeError` is raised with the message `'tuple' object does not support item assignment`.
    
3. Neither.
    
4. Both A and B.
    

When I saw this, I was pretty sure the answer was B, but it’s actually D, “Both A and B”! [Example 2-17](#ex_aug_item_assign_solution) is the actual output from a Python 3.9 console.[^10]

##### Example 2-17. The unexpected result: item t2 is changed _and_ an exception is raised

```
>>> 
```

[Online Python Tutor](https://fpy.li/2-14) is an awesome online tool to visualize how Python works in detail. [Figure 2-5](#aug_item_assign_tutor) is a composite of two screenshots showing the initial and final states of the tuple `t` from [Example 2-17](#ex_aug_item_assign_solution).

![References diagram](assets/flpy_0205.png)

###### Figure 2-5. Initial and final state of the tuple assignment puzzler (diagram generated by Online Python Tutor).

If you look at the bytecode Python generates for the expression `s[a] += b` ([Example 2-18](#ex_aug_item_assign_bytecode)), it becomes clear how that happens.

##### Example 2-18. Bytecode for the expression `s[a] += b`

```
>>> 
```

[![^1]

Put the value of `s[a]` on `TOS` (Top Of Stack).

[![^2]

Perform `TOS += b`. This succeeds if `TOS` refers to a mutable object (it’s a list, in [Example 2-17](#ex_aug_item_assign_solution)).

[![^3]

Assign `s[a] = TOS`. This fails if `s` is immutable (the `t` tuple in [Example 2-17](#ex_aug_item_assign_solution)).

This example is quite a corner case—in 20 years using Python, I have never seen this strange behavior actually bite somebody.

I take three lessons from this:

- Avoid putting mutable items in tuples.
    
- Augmented assignment is not an atomic operation—we just saw it throwing an exception after doing part of its job.
    
- Inspecting Python bytecode is not too difficult, and can be helpful to see what is going on under the hood.
    

After witnessing the subtleties of using `+` and `*` for concatenation, we can change the subject to another essential operation with sequences: sorting.