
## 安装方式

### 官方给出的安装脚本

#### MacOS or Linux
```shell
# Just run:
$ curl -L https://raw.githubusercontent.com/rust-lang/rustlings/main/install.sh | bash
# Or if you want it to be installed to a different path:
$ curl -L https://raw.githubusercontent.com/rust-lang/rustlings/main/install.sh | bash -s mypath/
```

This will install Rustlings and give you access to the `rustlings` command. Run it to get started!

#### NixOS
Basically: Clone the repository at the latest tag, finally run `nix develop` or `nix-shell`.
```shell
# find out the latest version at https://github.com/rust-lang/rustlings/releases/latest (on edit 5.3.0)
git clone -b 5.3.0 --depth 1 https://github.com/rust-lang/rustlings
cd rustlings
# if nix version > 2.3
nix develop
# if nix version <= 2.3
nix-shell
```


#### Windows
In PowerShell (Run as Administrator), set `ExecutionPolicy` to `RemoteSigned`:
```shell

Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

Then, you can run:
```shell
Start-BitsTransfer -Source https://raw.githubusercontent.com/rust-lang/rustlings/main/install.ps1 -Destination $env:TMP/install_rustlings.ps1; 

Unblock-File $env:TMP/install_rustlings.ps1; 

Invoke-Expression $env:TMP/install_rustlings.ps1
```

To install Rustlings. Same as on MacOS/Linux, you will have access to the `rustlings` command after it. Keep in mind that this works best in PowerShell, and any other terminals may give you errors.

If you get a permission denied message, you might have to exclude the directory where you cloned Rustlings in your antivirus.

### 手动安装

Basically, clone the repository at the latest tag, run `cargo install --path .`:
```shell
# find out the latest version at https://github.com/rust-lang/rustlings/releases/latest (on edit 5.3.0, 8st,Jan,2023)
git clone -b 5.3.0 --depth 1 https://github.com/rust-lang/rustlings
cd rustlings
cargo install --force --path .
```

If there are installation error, ensure that your toolchain is up to date. For the latest, run:
```shell
rustup update

# if you install rustup by your system software package manager(such as pacman), you need to update rustup by pacman to have a system update.
```
Then, same as above, run `rustlings` to get started.

## 报错及解决办法

### 运行`rustlings`找不到该命令
![[rustlings_command_not_found.png]]

出现这种报错的原因是因为没有在`$PATH`环境变量中添加 `rustlings`的执行目录（一般情况下是`.cargo/bin`或`/usr/bin/cargo`），导致shell中无法找到对应的rustlings可执行文件：
![[echo_PATH_env.png]]

就我而言，我使用软件包管理器 pacman 安装 `rustup` 和 `cargo`，却使用官方脚本安装 `rustlings`。这导致 `rustup` 和 `cargo` 的安装及运行目录都在 `/usr/bin` 中，而 `rustlings` 的运行目录在 `~/.cargo/bin/`。系统 `$PATH` 环境变量中无法找到 `rustlings` 可执行文件，自然无法运行。

因此每次运行`rustup`或`cargo`命令，都是相当于从`$PATH`环境变量中获取命令的可执行文件所在的目录，然后才能运行。这相当于系统级的`rust`环境，在这种情况下想要安装`rustlings`，就应当保持继续使用`yay`或`pacman`这样的软件包管理器进行安装：`yay -S rustlings`。

如果使用官方脚本进行安装，这样的好处是可以方便地自定义安装目录，可以安全地在用户目录下使用IDE进行调试，那么就需要手动将`~/.cargo/bin`添加到`$PATH`中去。这样的解决方式有两种：
- 临时命令（不推荐，毕竟不可能只使用一次`rustlings`）：
	- `export PATH="/home/{username}/.cargo/bin:$PATH"`，
	- 当然，也可以耍小聪明，在`~/.bashrc` or `~/.zshrc`这样的shell配置文件里添加上述命令，这样只不过是掩耳盗铃之计，只是在shell每次打开时添加环境变量，而想要在IDE中作进一步调试时，还需要更多的配置，徒增烦琐；
- 长期命令：
	- `sudo vim /etc/profile`，在其中将上述命令添加到末尾，之后保存退出即可，
	- `source /etc/profile`，激活刚才的配置。

### 几种安装时有关网络情况的报错
诸如：
1. cargo warning: spurious network error (2 tries remaining): [92] Stream error in the HTTP/2 framing layer (HTTP/2 stream 3 was not closed cleanly before end of the underlying stream); class=Net (12)
2. cargo warning: spurious network error (2 tries remaining): [6] Couldn't resolve host name (Could not resolve host: crates)
3. rust拉取crates库文件时，遇到报错：warning: spurious network error (2 tries remaining): [28] Timeout was reached (Operation timed out after 30857 milliseconds with 0 out of 0 bytes received): unable to get packages from source

等等，不一而足。这些解决办法可以参考如下博客或Github Issues：
1. [Stream error in the HTTP/2 framing layer.](https://github.com/archiecobbs/s3backer/issues/168)；
	[git 提交报错 error: RPC failed; curl 92 HTTP/2 stream 0 was not closed cleanly: PROTOCOL_ERROR (err 1)](https://blog.csdn.net/wjk_along/article/details/104423443)；
2. [「问题修复」「cargo」warning: spurious network error (2 tries remaining): [6] Couldn't resolve host name (Could not resolve host: crates)](https://www.cnblogs.com/QuLory/p/13992013.html)；
3. [Rust拉取库文件时遇到spurious network error.](https://www.wkwkk.com/articles/b1c6cf4f1fc959f4.html)

这其中与我而言有效的是更换`rustup toolchain`的镜像源：
`export RUSTUP_DIST_SERVER=https://mirrors.ustc.edu.cn/rust-static`，为了持久化这个镜像源，需要改动`/etc/profile`文件，在其中添加环境变量：
```shell
RUSTUP_DIST_SERVER=https://mirrors.ustc.edu.cn/rust-static
```

以及在`~/.cargo/`目录下建立`config`文件（注意没有扩展名），为`cargo`设置镜像：
```shell
[source.crates-io]
registry = "https://github.com/rust-lang/crates.io-index"
replace-with = 'ustc'
[source.ustc]
registry = "https://mirrors.ustc.edu.cn/crates.io-index"
```

其它问题请参考博客及Cargo文档：
- [Rust环境配置事项一览](zhuanlan.zhihu.com/p/27782375)；
- [配置Cargo国内源](https://blog.csdn.net/u010953692/article/details/106464851)；
- [Cargo source-replacement](https://doc.rust-lang.org/cargo/reference/source-replacement.html)。

## 安装成功后的输出
```
❯ rustlings  
  
      welcome to...  
                _   _ _  
 _ __ _   _ ___| |_| (_)_ __   __ _ ___  
| '__| | | / __| __| | | '_ \ / _` / __|  
| |  | |_| \__ \ |_| | | | | | (_| \__ \  
|_|   \__,_|___/\__|_|_|_| |_|\__, |___/  
                              |___/  
  
Thanks for installing Rustlings!  
  
Is this your first time? Don't worry, Rustlings was made for beginners! We are  
going to teach you a lot of things about Rust, but before we can get  
started, here's a couple of notes about how Rustlings operates:  
  
1. The central concept behind Rustlings is that you solve exercises. These  
  exercises usually have some sort of syntax error in them, which will cause  
  them to fail compilation or testing. Sometimes there's a logic error instead  
  of a syntax error. No matter what error, it's your job to find it and fix it!  
  You'll know when you fixed it because then, the exercise will compile and  
  Rustlings will be able to move on to the next exercise.  
2. If you run Rustlings in watch mode (which we recommend), it'll automatically  
  start with the first exercise. Don't get confused by an error message popping  
  up as soon as you run Rustlings! This is part of the exercise that you're  
  supposed to solve, so open the exercise file in an editor and start your  
  detective work!  
3. If you're stuck on an exercise, there is a helpful hint you can view by typing  
  'hint' (in watch mode), or running `rustlings hint exercise_name`.  
4. If an exercise doesn't make sense to you, feel free to open an issue on GitHub!  
  (https://github.com/rust-lang/rustlings/issues/new). We look at every issue,  
  and sometimes, other learners do too so you can help each other out!  
5. If you want to use `rust-analyzer` with exercises, which provides features like  
  autocompletion, run the command `rustlings lsp`.  
  
Got all that? Great! To get started, run `rustlings watch` in order to get the first  
exercise. Make sure to have your editor open!
```