## 硬盘存储

### 非易失性存储器

### 磁芯存储器

### 磁表面存储器

- 如何保存? 磁颗粒的不同磁化偏转方向
- 如何表示? 磁记录方式
- 如何组织? 扇区、磁道、柱面、硬盘
- 如何管理? 操作系统的文件系统

磁记录方式：
- 归零制（RZ）
	- 线圈中正脉冲为“1” ，负脉冲表示“0” ，两位信息位之间线圈中电流为零。
- 不归零制（NRZ）
	- 线圈中一直有正或负脉冲（包括两位信息位之间）。
- 见 1 翻转的不归零制（NRZ1）
	- 只有见到“1”才改变电流的方
- 调相制（PM）
	- 用脉冲的边沿来表示“0”和“1” 
- 调频制（FM）
	- “1”: 位周期中心和位与位之间都翻转 
	- “0”: 位周期中心不翻转，位与位之间翻转
- 改进的调频制（MFM）
	- 只有连续两个或以上的“0”时，才在位周 期的起始位置翻转

![[34-Disk-magnet-methods.png]]

### 随机访问和串行访问

随机访问
- 随机访问任何单元，访问时间与信息存放位置无关
- 每一位都有各自的读写设备

串行访问
- 顺序地一位一位地进行，访问时间与存储位的物理位置有关
- 共用一个读写设备
- 顺序访问和直接访问

### 技术指标

存储密度
- 单位长度（磁带）或单位面积（磁盘）磁层表面所存储的二进制信息量

存储容量
- 磁表面存储器所能存储的二进制信息的总量，以字节为单位

寻址时间

数据传输率

误码率

价格

### 磁盘结构

![[34-Disk-structure.png]]

磁盘访问过程：
- 寻道：将读写磁头移动到正确的磁道上（平均需要 8~20 ms ）
- 寻找扇区：等待磁盘旋转到需要访问的扇区（ 0.5 / RPM）
- 数据传输：读写数据（1 个或多个扇区）（ 2 to 15 MB/sec

磁盘参数：
- 与容量有关
	- 500 至 2,000 磁道（每面）
	- 32 至 128 个扇区（每个磁道）
		- 扇区是磁盘访问的最小单位 
- 早期硬盘上每个磁道上的扇区数是一样的
- 增加容量：位密度不变：外磁道比内磁道扇区数多一些
- 柱面：位于同一半径的磁道集合
- 读/写数据的三个步骤：
	- 寻道时间：将磁头移动到正确的磁道上
	- 旋转延迟：等待磁盘上扇区旋转到磁头下
	- 传输时间：真正的数据读/写时间
- 当前平均寻道时间：一般为 8 至 12 ms
- 旋转延迟：
	- 旋转速度：3,600 至 7200 RPM
	- 旋转时间：16 ms 至 8 ms 每转
	- 平均寻址时间 8ms 至 4ms
- 访问速度：
	- 数据量（通常为 1 个扇区）： 1 KB / sector
	- 旋转速度： 3600 RPM 至 7200 RPM
	- 存储密度：磁道上单位长度存储的位数
	- 磁盘直径： 2.5 至 5.25 in 
	- 一般为： 2 至 12 MB 每秒
- 磁盘访问时间 = 寻道时间 + 旋转延迟 + 传输时间 + 磁盘控制器延迟

![[60-IO管理与磁盘#磁盘性能参数]]

### 对磁盘访问的思考

页容量大，为什么扇区却如此小呢？
- 理由 1 ： 可用性。 可以在扇区物理损坏时不再使用该扇区。
- 理由 2 ： 还是可用性。检错纠错码分布在每个扇 区，扇区容量小，检错速度快，效率高。
- 理由 3 ：灵活性。使用不同的操作系统，不同的页面大小。

采用并行方式和大容量传输方式**克服磁盘控制器延迟**
- 大容量传输： 每次读取多个扇区，可以节约时间。
- 也可以分担部分总线延迟
- 并行 
	- 1 ：并行读多个层面
	- 2 ：并行读多个磁盘

### 访问磁盘过程

对磁盘的访问总是由缺页引起的：
- CPU 给出地址，需要访问某存储单元；
- 并行进行 TLB 查找和 cache 查找；
- TLB 查找后申明没有找到；
- 停止并行查找，并通知操作系统处理；
- 操作系统检查页表，发现该页不在内存中，需要从硬盘调入。应该如何进行呢？

操作系统从主存中选择一页准备换出，为调入的页安排存放空间；
- 若被换出的页是“脏”页，需要将其写回磁盘存储；
- 操作系统申请 I/O 总线；
	- 获得批准后，发送写命令给 I/O 设备 （磁盘）。 
	- 紧跟着传送需要写回的页的全部数据。
	- I/O 控制器发现发给自己的写命令，加入到握手协议，并接受数据。
	- 根据数据要写入的地址，读/写头移动到正确的柱面，同时，将数据接收到缓冲区。
- 寻道结束后，等待相应的扇区旋转到磁头下面，将数据写入扇区中。
- 在写入数据间隙，计算校验码并写入扇区中。
- 下一步，操作系统继续申请总线（如果还保持总线控制权，则不必申请）。
- 得到授权后，向磁盘发出读命令。
	- 然后，磁盘识别地址，并转换为相应的地址段。
	- 寻道，将读/写头移动到指定位置。
	- 从指定扇区中读去数据，并进行校验。
	- 磁盘申请 I/O 总线。
	- 得到授权后，将数据通过总线送到内存。

> [! note] 区分可用性和可靠性
> 两个经常混淆的词汇： n 可靠性：设备出现故障的几率来衡量。 n 可用性：系统能正常运行的几率来衡量。 p可用性可以增加硬件冗余来提高： n 例如：在存储器中增加校验码。 p可靠性只能通过下面途径提高： n 改善使用环境 n 提高各部件的可靠性 n 减少组成部件 n可用性的提高可能带来可靠性的降低

## RAID

![[60-IO管理与磁盘#RAID]]

## SSD

![[62-SSD]]