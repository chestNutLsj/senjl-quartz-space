
## 网络模型

- 任务分层
    - 发送方、接收方和载体
    - 层次结构
        - 对发送方和接收方而言，任务的进行必须按照给定的层次顺序完成
        - 服务：在接收方，每一层都使用其直接下层提供的服务

### OSI模型

Open System InterConnection

- 简述
	
	- 一个能包含网络通信各方面的ISO（国际标准化组织）标准的模型
		
	- 开放系统open system，是一组协议，它允许任何两个不同系统进行相互通信，而不管其底层结构如何
		
	- OSI模型目的：使不同系统间的通信变得容易，而不要求对其底层的硬件和软件的逻辑结构做任何改动
		
	- OSI模型不是一个协议，而是一个模型，利用这一模型可以理解并设计一个灵活、健壮和可互操作的网络体系结构
		
	- OSI模型提供了一个用来进行网络系统设计的层次化框架，由7个相互独立又相互关联的层次组成，每一层都定义了通过网络传递信息的一部分功能


- 层次化体系
	
	- OSI可有序地分层：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层
		
	- 建立模型过程中，设计者将传输数据的过程归结为一些最基本的元素，这些元素确定了具有相关用途的网络功能，按照功能归类的功能组就是各个层次。每一层都定义了一系列与其他层次不同的功能
		
	- 通过这种方式进行功能定义和局部化，使设计者能建立一个全面又灵活的体系结构。由此，OSI模型得以使不兼容系统之间完全透明化
		
	- 单台机器中，每一层调用下一层提供的服务；两台机器之间，一台机器上的第x层与另一台机器的第x层进行通信。这种通信由一些列协议来控制


- 对等过程
	
	- 定义：每台机器上==特定层次的通信过程==。由此，机器间的通信就是使用适用于给定层次的协议的对等过程
		
	- 在发送端，每一层都在从直接上层传来的报文加上自己的信息，并将整个分组传到它的直接下层；在物理层，整个分组被转换成可以传输到接收端设备的形式；在接收端，报文被一层一层打开，每一层接收兵提取对它有意义的数据
		
	- 层间接口：数据和网络信息在层次间的传递，是通过相邻两层的接口来实现的
		
		- 每一层接口都定义了该层必须向上层提供信息和服务
			
		- 良好定义的接口和层功能可使网络模块化
			
		- 只要某一层仍能为上一层提供所期望的功能，该层功能的具体实现就可以在不改变周围层次的基础上进行修改和替换
			
		
	- 层次组织
		
		- 7个层次可以分成3个子功能组
			
			- 网络支持层（物理层、数据链路层、网络层）：处理从一设备到另一个设备数据传输的物理方面问题（如电气特性、物理连接、物理寻址、传输的时序和可靠性）
				
			- 传输层：将两个子功能组连接起来，保证下层是以上层能够使用的形式传输的
				
			- 用户支持层（会话层、表示层和应用层）：允许不相关的软件系统间的互操作
				
			
		- 高层通常通过软件实现，低层则通过硬件软件混合，物理层几乎都是硬件
			
		- 发送过程从第七层（应用层）开始，一层层向下移动，在每一层数据单元可能加入头部或尾部。格式化的数据到达物理层时，转换成电磁信号在物理链路上传输
			
		- 接受过程，信号传入第一层并被重新转换成数字形式，之后从下向上传到OSI各层。当每一数据块到达下一更高层时，在发送端对应层次附加的头部和尾部就被除去，并执行该层相应的动作


- 封装
	
	- 定义：第n-1层的分组中的数据部分是第n层的完整分组（数据+头部或尾部）
		
	- 第 n-1层不知道被封装分组中，哪些部分是数据，哪些部分是头部或尾部。对于第 n-1层，来自第 n 层的分组是作为一个整体单元处理的

### OSI模型各层功能

![[20-网络模型-OSI.png]]

#### 物理层

通过介质传输bit，提供机械及电气规范

- 定义了接口与传输介质的机械和电气特性，也定义了物理设备和接口为了传输而必须执行的过程和功能
	
- 负责位从一个节点到另一个节点的传递
	
- 考虑问题：
	
	- 接口与介质的物理特性：定义了设备与传输介质之间的接口特性，也定义了传输介质的类型
		
	- 位的表示：物理层的数据是没有任何解释的位bit流（由0、1组成的序列），要进行传输必须将之编码成信号（电信号、光信号）。因此，要定义编码encoding的类型（如何将0、1转换成信号）
		
	- 数据速率：传输速率——每秒发送的位数。换言之，定义一个位的持续时间
		
	- 位同步：发送方和接收方要有相同的比特率，也要位同步（发送时钟和接收时钟同步）
		
	- 线路配置：设备与介质的连接（点到点配置、多点配置）
		
	- 物理拓扑结构：定义如何将设备连接成网络（网状、星型、环状、总线）
		
	- 传输方式：两台设备间的传输方向（单工、半双工、全双工）


#### 数据链路层

将 bit 组成帧，提供节点到节点的传递

- 将物理层——对数据不做任何改动的传输通道变成可靠的链路，由此将物理层的数据无差错地传递给上层（网络层）
	
- 负责帧从一跳（节点）到下一跳（节点）的传递
	
- 考虑问题：
	
	- 成帧：将接收到的来自网络层的位流划分成帧（易处理的数据单元）
		
	- 物理寻址：
		
		- 如果帧是发送给网络中的不同系统，则链路层在帧的头部添加发送方的物理地址和接收方的物理地址
			
		- 如果帧发往发送方网络之外的系统，接收方的地址就是连接一个网络到下一个网络的设备地址
			
		
	- 流量控制：防止接收方接收数据过载
		
	- 差错控制：检测与重发损坏帧或丢失帧，防止重复帧（差错控制通常在一个帧地结束处增加一个尾部来处理）
		
	- 访问控制：当两台或多台设备连接到同一条链路上时，数据链路协议必须能决定在任意时刻由哪一台设备来获取对链路的控制权
		
	
- 跳到跳传递hop-to-hop delivery（节点到节点传递node-to-ndoe delivery）

#### 网络层

将分组从源传递到目的地，提供网际互连

- 负责将各个分组从源地址传递到目的地址，可能会通过多个网络（链路）。尽管链路层会监视同一个网络（链路）上两个系统之间分组的传递，但仍需网络层确保每个分组能够从出发点到达目的地
	
- 如果两个系统连接在同一条链路上，通常不需要网络层；如果两个系统在不同的网络（链路）上并通过网络（链路）之间的设备连接，通常需要网络层以完成源端到目的端地传递
	
- 考虑问题：
	
	- 逻辑寻址：给来自上一层的分组增加一个头部，包括发送方和接收方的逻辑地址
		
		- （物理寻址负责处理本地网络寻址问题，由链路层完成，如果一个分组通过网络边界，就需要另一个寻址系统来帮助区分源与目的系统）
			
		
	- 路由选择：提供连接设备（路由器或网关）把分组送到它们的最终目的地的机制。（对于一些独立网络或链路连接在一起构成一个互联网或一个更大网络的情况）

#### 传输层

提供端到端的可靠报文传递和差错纠正

- 负责整个报文的进程到进程传递
	
- 网络层监管各个分组的源端到目的端传递，但并不了解这些分组之间的相互关系。传输层确保整个报文误差挫并按顺序地到达目的地，在源到目的层次进行差错控制和流量控制
	
- 考虑问题：
	
	- 服务点寻址：将信息的头部包含服务点地址（端口地址），以应对从计算机到计算机、特定进程到特定进程的情况。网络层将每个分组传送到指定的计算机上，传输层将整个报文传送给该计算机上的指定进程
		
	- 分段和组装：将报文分解成可传输的片段，并且给这些片段编号（编号可以在接收端正确组装报文，也可以用来标识和替换传输中丢失的分组）
		
	- 连接控制：无连接或面向连接
		
		- 无连接：将每个片段作为一个独立的分组，并将它传递到目的机器的传输层
			
		- 面向连接：在传递分组之前，需要与目的机器的传输层建立一条连接，所有数据被传输后，该连接释放
			
		
	- 流量控制：端到端上控制流量，而不是单条链路上
		
	- 差错控制：进程到进程上控制差错，而不是单条链路上。发送方的传输层确保整个报文无差错（损坏、丢失或重复）地到达接收方的传输层。通过重发来纠正差错


#### 会话层

建立、管理和终止对话

- 网络的对话控制器，建立、维护和同步通信系统间的交互操作
	
- 考虑问题：
	
	- 对话控制：允许两个系统进入会话，允许两个进程之间以半双工、全双工方式进行通信
		
	- 同步：允许一个进程在数据流中增加检查点或同步点(synchronization point)


#### 表示层

翻译、加密和压缩数据

- 两个系统之间交换信息的语义和语法
	
- 负责翻译、加密和压缩数据
	
- 考虑问题：
	
	- 翻译：发送方的表示层将信息从发送方使用的格式转换成一个公共格式，接收方机器的表示层将公共格式转换成接收方使用的格式
		
		- 两个系统中的进程通常以字符串、数字等格式交换信息，传输前信息要转换成位流，不同的计算机采用不同的编码系统，表示层负责不同编码方式之间的互操作
			
		
	- 加密：发送方将原来的信息转换为另一种形式，并在网络上发送转换后的形式。解密反之
		
	- 压缩：减少需要传输数据的位数。对于多媒体（文本、音频、视频）的传输很重要


#### 应用层

允许访问网络资源

- 使得用户（人或软件）可以访问网络，提供了用户接口和访问支持。（如电子邮件、远程文件访问与传输、共享数据库管理以及其它分布式信息服务）
	
- 负责向用户提供服务
	
- 考虑问题：
	
	- 网络虚拟终端：物理终端的软件版本，允许用户登陆到一台远程主机上
		
		- 应用程序在远程主机上创建一个软件模拟终端，用户计算机只与这个软件终端对话，软件终端与主机对话，反之亦然。远程主机认为自己是在与自己的一个终端通信，因而允许用户登录
			
		
	- 文件传输、访问和管理：允许用户访问远程计算机上的文件（进行修改或读取数据），从远程计算机上检索文件，以及管理或控制远程计算机上的文件
		
	- 邮件服务：电子邮件存储转发的基础
		
	- 目录服务：提供分布式数据库资源以及对不同对象和服务的全球信息的访问

### TCP/IP协议族

- 由相互作用的模块组成分层协议，每一层提供一个特定的功能，但不需要相互依赖。各层包含一些相对独立的协议，它们依据系统的需要混合语匹配（分层：意指每个上一层协议是由一个或多个下层协议支持的）
	
- 分层与各层协议
	
	- 实际层次：
		
		- 主机到网络层：相当于OSI的物理层和数据链路层的组合
			
		- 互联网层：网络层
			
		- 传输层：处理会话层的部分功能
			
		- 应用层：相当于会话层、表示层和应用层
			
		
	- 为分析理解假定层次：
		
		- 对应于OSI模型前4层，提供物理标准、网络接口、网际互连和传输功能
			
			- 物理层和数据链路层：TCP/IP不定义任何协议，支持所有标准和专门协议，采用TCP/IP互联的网络可以是LAN和WAN
				
			- 网络层：支持网际协议IP（Internetworking Protocol）
				
				- 网际协议IP：TCP/IP协议使用的传输机制
					
					- 是一个不可靠、无连接数据报协议，称为尽力传递best-effort delivery，尽力意即IP没有差错检测和跟踪。IP假定了底层是不可靠的，只是尽最大努力传输到目的地，但没有保证
						
					- IP传输的数据称为数据报，每一个数据报都独立地传输。数据包可以沿着不同的路由传输，有可能不按顺序到达、重复出现等。IP没有路由跟踪，数据报一旦到达目的地，没有重新排序功能
						
					- 不要将这个局限看作缺点，这样简单的传输使用户自由添加已知应用所必需的功能，效率更高
						
					
				- IP使用四个支持协议：
					
					- 地址解析协议ARP（Address Resolution Protocol）：将逻辑地址与物理地址相联系起来，用于已知节点的因特网地址寻找该节点的物理地址
						
					- 逆地址解析协议RARP（Reverse Address Resolution Protocol）：允许主机在仅知道物理地址的情况下寻找因特网地址。在主机第一次连接到网络上或启动一台无盘计算机时会用到
						
					- 因特网控制报文协议ICMP（Internet Control Message Protocol）：有主机和网关所使用的一种机制，用来向发送方通知数据报所发生的问题
						
					- 因特网组报文协议IGMP（Internet Group Message Protocol）：用于将一个报文同时发送给一组接收者
						
					
				
			- 传输层：用TCP、UDP、SCTP三个协议表示
				
				- IP是主机到主机协议，可以将分组从一个物理设备传递到另一个物理设备；UDP、TCP是负责将报文从一个进程传递到另一个进程的传输层协议
					
				- 用户数据报协议UDP（User DATa gram Protocol）：是一个进程到进程的协议，仅将端口号、校验和差错控制及信息长度添加到来自上一层的数据中
					
				- 传输控制协议TCP（Transmission Control Protocol）：为应用程序提供了完整的传输层服务，是一个可靠的流传输协议（流表示面向连接的：在传输的两端可以传送数据以前必须先建立连接）
					
				- 流控制传输协议SCTP（Stream Control Transmission Protocol）：用于对较新应用提供支持，如音频传输
					
				
			
		- 对应OSI模型最上面3层（会话层、表示层、应用层）的单一层
			
			- 应用层

### 寻址

采用TCP/IP协议的互联网使用四层地址：

- 物理（链路）地址physical（link） address：
	
	- 对应数据链路层和物理层
		
	- 是局域网或广域网定义的节点地址，包含在数据链路层所用的帧中，是最低级的地址
		
	- 长度和格式可变，与网络有关。大多局域网用48位（6个字节）的物理地址，被写作12个十六进制的数字，每个字节用冒号分割开
		
	- 帧的头部含有物理地址，目的地址在前，源地址在后


- 逻辑地址logical address：
	
	- 对应网络层
		
	- 唯一定义了连接到因特网的一台主机，与下面的物理网络无关，适应全世界互联的网络环境
		
	- 发送方在网络层封装分组并添加源地址和目的地址，源地址在前，目的地址在后
		
	- 帧的物理地址会改变，但源和目的逻辑地址必须保持相同，否则该分组将会被丢失


- 端口地址port address：
	
	- 对应传输层
		
	- 因特网通信的最终目的是进程到进程的通信。为了使不同的进程同时接收数据，用16位端口地址赋予进程标识符，以此标记不同的进程
		
	- 即使两台计算机运行同一个应用程序，但一个是客户进程，另一个是服务进程，其端口地址不同
		
	- 在因特网范围内，从跳到跳物理地址会改变，但从源到目的逻辑地址和端口地址保持不变

- 专用地址：
	
	- 对应应用层
		
	- 面向用户的应用设计为专用地址。如电子邮件的地址 `1821552335@qq.com`，统一资源定位符 URL `www.google.com`，
	- 前者定义邮件的接发者，后者在万维网中寻找一个文档。这些地址由发送计算机转换成对应的端口地址和逻辑地址
