实际中链路都是有限带宽，为了达到特殊目的就需要合理进行带宽利用。
- 通过**复用**，可以将一些低带宽通道组合在一起形成一条高带宽通道，提高效率；
- 通过**扩频**，扩展通道带宽，达到保密、抗干扰的目的


## 复用 multiplexing

允许同时通过一条数据链路传输多个信号的一组技术。把来自源端的信号组合在一起获得带宽的效率，链路的有用贷款在各个源端之间划分

### 复用技术的背景

- 只要连接两台设备的介质带宽比设备间传输所要求的带宽高时，该链路就可以被共享

- 如果一条链路的带宽比连接在它的上面的设备所需的带宽要大，那么多余的带宽就被浪费，而带宽是数据通信中最为昂贵的资源之一，所以一个高效的系统应该最大限度地使用所有设备的资源


### 复用原理

n条线路共享一条链路的带宽。

- n 条输入线将其传输流量送到复用器 MUX（multiplexer），复用器将这些流量组成一个单独的传输流

- 在接收端，这个传输流量被分离器 DEMUX（demultiplexer）接收，并分解成原来几个独立的传输流再发送到对应线路上

- MUX 和 DEMUX 之间是链路 link，其中有 n 个通道（ 指在给定一对设备之间传送传输信号的链路的那部分）


### 三种基本技术

#### 频分复用 FDM 

frequency-division multiplexing：**用于模拟信号**。在链路带宽（单位：Hz）大于要传输的信号的带宽之和时采用

- 每个发送设备生成的信号用于调制不同的载波频率，调制后的信号再被合并为一个可以通过链路传输的复合信号

- FDM是模拟复用技术，若在复用之前数字信号转换成模拟信号，就可以实现将源端的数字信号处理

- 原始信号能够重新恢复的条件：
	- 载波频率之间的频率差必须能够容纳调制信号的带宽，这些带宽的范围就是不同信号通过的通道
	- 通道之间由狭长的未使用的带宽作为防护频带（guard band）进行分隔，以防止信号重叠
	- 载波频率必须不会影响原始的数据频率

- 复用过程：每一个源端产生频率范围类似的信号，在复用器中这些类似信号被调制到不同载波频率上，然后将调制后的信号合成为一个复合信号通过具有足够带宽的介质链路发送出去

- 复用分离过程：分离器使用一系列滤波器来将复用信号分解为组成它的各个信号，每个信号随后被传送到解调器，解调器将它们与载波分离并发送给等待的接收端

- 模拟载波系统：电话公司为了最大限度地提高基础设施效率，而把低带宽线路的信号复用到更高带宽的线路上，由此许多交换和专用线路可以合并成更少但是容量更大的通道

- AT&T采用层次结构系统：由群、超群、主群、巨群组成

- 模拟层次结构 analog hierarchy：
	- 12 个语音通道复用到一个更高带宽的线路上构成一个群 group，一个群带宽为48kHz
	- 5 个群复用产生一个超群 supergroup，带宽240kHz
	- 10 个超群复用为一个主群 master group，必须有2.40MHz 带宽。由于超群之间需要防护频带，总带宽上升至2.52MHz
	- 6 个主群复用为一个巨群 jumbo group，必须有15.12MHz 带宽，由于主群之间的防护频带，总带宽上升至16.984MHz



- FDM应用：
	- AM/FM 广播：无线电使用空气作为传输介质，将一个特定波段分配给 AM 无线电广播（530~1700kHz，FM 广播为88~108MHz），所有无线电台共享这一波段
		- 每个 AM 电台都需要10kHz 带宽（FM 电台为200kHz），每个电台使用不同的载波频率，这需要对它的信号平移并复用
		- 空气中传播的信号是所有信号的组合，接收机会接受所有信号，但能够滤波想要接收的信号
		- 如果没有复用，就只会有一个 AM 电台可以向公共链路即空气广播信号
		- 实现：只要所有电台使用不同的载波频率向空气中传播，就可以实现多路复用
	- 电视广播：每一个电视频道的带宽是6MHz
	- 第一代移动电话：每一用户分配两个30kHz 的通道，一个用于发送语音另一个用于接收



#### 波分复用 WDM

wave-division multiplexing：用于模拟信号。用于具有高数据速率传输能力的光缆

- 概念原理与FDM相同，都是将不同频率的信号合并，但**WDM的频率很高**

- 过程：来自不同源端的*窄波段的光合并生成一种波段更宽的光*，在接受器端，信号通过信号分离器进行分离

- 实现：在复用器上将多个光源组成单一光信号，而在分离器上做相反的处理。光源的组合与分离由棱镜完成

- 应用：同步光纤网络SONET，其中多条光纤线路进行复用和信号分离

- 密集波分复用DWDM（dense WDM）：通过使相邻通道之间的频率更接近的办法来复用大量通道，从而获得非常高的效率


#### 时分复用 TDM
time-division multiplexing：**用于数字信号**。允许多个连接在时间上（FDM 是在空间上）共享一条高带宽链路，每个连接占用链路的一个时间段（称为时隙）

- TDM是数字复用技术，将不同源端的数字数据合并到一个时间共享的链路上。源端也可以产生模拟数据，只要被采样改变成数字数据即可

- TDM 是组合多个低速的通道为一个高速通道数据的复用技术，换言之，将一个高速通道拆分为多个低速通道以提高利用率的复用技术

- 两种方案：**同步时分复用**和**统计时分复用**
	- 同步时分复用synchronous TDM：
		- 时隙和帧：同步 TDM 中，每个输入连接的数据流被划分为多个单元，每个输入占用一个输入间隙。
			- ![[第6章-带宽利用-sync-TDM.png]]
			- 一个单元可以是一位、一个字符或一个数据块，每个输入单元成为一个输出单元的，占用一个输出时隙
			- ==每个输出单元的持续时间是输入单元持续时间的n分之一==。如果输入时隙是T秒，则输出时隙是T/n秒
			- 每个输入连接的全部数据单元组成一个帧。如果有n条连接线，则一帧分为n个时隙，一个时隙分配给一个单元。如果输入单元持续T秒，则每个时隙持续时间是T/n，每个帧持续时间是T。每个单元在复用之前的持续时间是复用后的n倍
			- ==输出的链路的数据速率必须是单个连接的数据速率的n倍，以保证数据流动==。
			- 时隙分组为多个帧，帧由多个时隙组成的一个完整的循环构成，每个时隙专用于一个发送设备。在具有n条输入线路的系统中，每个帧有n个时隙，分配每个时隙用于传送来自特定输入线路的数据
			
		- 交替interleaving：将TDM看作两个开关，一个位于复用一侧，另一个位于信号分离一侧。两个开关同步以相同的速度旋转，但是方向相反
			- 复用一侧，当开关在一个连接前打开时，==连接有机会向通路上发送一个单元==。这就是交替
			- 信号分离一侧，当开关在某个连接前打开时，==连接有机会从通路中接收一个单元==
			
		- 空时隙：同步TDM的频率不高。当某一源端没有数据发送时，输出帧中对应的时隙是空的。统计TDM可以通过除去帧中空时隙来提高效率
			
		- 数据速率管理：当**输入数据速率有差异**时，上述以相同速率的分析就需要做出改变。有三种策略：
			- ==多级复用==：当一条输入数据线的数据速率是其他一些输入数据线数据速率的整数倍时，采用多级复用技术将几条输入线复用以达到其他输入线的数据速率
			- ==多时隙分配==：多级复用的反向操作，不过对于高倍数据速率输入需要插入穿并行转换来使原输入线分成几个输入线，进而与其他线路匹配
			- ==脉冲填充==：源输入线的比特率不是其他每个输入线比特率的整数倍，此时需要选取输入线最高速率为主要速率，然后将所有低速率的输入线添加虚位，此即脉冲填充或位填充
			
		- 帧同步：如果复用器和分离器失去同步，则属于某一个通道的位可能会被错误的通道所接收
			- 因此，需要在每帧的开始增加一个或者多个**同步位**作为帧指示位framing bit
			- 帧指示位按照某种模式逐帧发生变化，使分离器与输入流同步，以准确地分离时隙。==一般每帧的同步信息由1位构成，0/1交替变化==
			
		- 数字信号服务：电话公司通过一种数字信号的层次结构实现TDM，又称数字层次结构digital hierarchy
			- 层次：
				- DS-0服务：64kbps的单一数字通道
				- DS-1服务：1.544Mbps（24×64kbps+8kbps开销）服务，可以用作单一的1.544Mbps传输服务，或作为24个64kbps通道的多路复用，或其他服务类型的组合形式
				- DS-2服务：6.312Mbps（96×64kbps+168kbps开销）服务，可以用作单一的6.312Mbps传输服务，或4个DS-1通道的多路复用，或96个DS-0通道，或其他
				- DS-3服务：44.376Mbps（672×64kbps+1.368Mbps开销）服务，单一、7个DS-2、28个DS-1、672个DS-0、或其他
				- DS-4服务：274.176Mbps（4032×64kbps+16.128Mbps开销）服务，、单一、6个DS-3、42个DS-2、168个DS-1、4032个DS-0、或其他
				
			- T线路（T lines）：为了实现DS-0、DS-1等服务，使用T线路，这些线路的容量与DS-1到DS-4的数据速率是精确匹配的（就是各级服务对DS-0的语音通道包含数）
				- T-1线路用于实现DS-1，T-2线路用于实现DS-2等等。DS-0实际上没有作为服务提供，但是被定义为用于参考的基础
				- 用于模拟传输的T线路：T线路是为数字数据、音频、视频设计的数字线路，模拟传输（电话连接）需要先对模拟信号采样然后使用TDM
				- T-1帧：DS-1有8kbps的开销，如何理解？
					- 用于T-1线路的帧通常是193位，分为24个9位的时隙，每帧附加1位用于同步。换言之，每个时隙包含来自每个通道的信号片段，24个片段在帧中交替排列
					- 如果一条T-1线路传送8000帧，则数据速率为1.544Mbps，其中有8000位同步位
				
			- E线路：欧洲使用的T线路，概念相同而容量不相同
			
		- 同步 TDM 的其他应用：第二代移动电话
		
	- 统计时分复用 statistical TDM：
		- 对于有些输入线没有数据发送导致效率不高的情况，统计时分复用**动态地分配时隙以提高带宽的利用率**，仅当输入线有发送数据，时隙才有意义并在输出帧中给予一个时隙。
		
		- 统计复用中，每个帧中时隙的个数小于输入线的条数。复用器循环顺序地检测每条输入线，如果输入线有数据发送，则对输入线分配一个时隙，否则跳过这条线检测下一条线
		
		- 寻址：同步TDM中，输出时隙全部由数据占用；统计TDM中，**输出时隙需要携带数据和目的地址**
			- 同步 TDM 中不需要寻址，作为输入和输出的地址之间的关系的同步的和指定的
			- 统计 TDM 中，由于输入和输出之间不存在指定或预定的时隙，它们之间没有固定关系，需要在每个时隙中包含接收方地址以表明将要传送的地方
		
		- 时隙大小：统计 TDM 中时隙携带数据和地址，为了传送效率，数据长度与地址长度之比应合理（数据长而地址短）
		
		- **没有同步位**：统计 TDM 处于帧级，不需要同步
		
		- **带宽：通常小于每个通道容量之和**。统计TDM按照每条通道负载的统计确定链路的容量，如果输入时隙平均百分之x即认为满了，那么链路的容量反映了这一情况，高峰时某些时隙需要等待



## 扩频 SS（spread spectrum）
也是把来自某些源端的信号组合在一起形成一个更宽的带宽，但**目的为了无线应用（wireless LAN）而设计**。

### 目的
- 无线应用中，==所有站点都以空气（真空）为传输介质，共享该介质需要没有窃听者拦截或恶意者干扰==

### 方法：
- 扩频技术增加了冗余部分，扩展原始信号的频带满足各个站的需要。如果每个站要求的带宽是 B，扩频将带宽扩展到 $B_{ss}$，$B_{ss}>>B$。**扩大的带宽允许源端用有防护的封装将它的报文进行更安全的传输**

### 原则：
- 对每个站点需要分配的带宽显然要比它所需要的带宽更大
- 原来的带宽 B 扩大到 $B_{ss}$ 必须由一个与原来的信号无关的过程来做，即**信号由源端生成后，扩频过程才能发生**。
- 信号由源端生成后，扩频过程利用扩频代码并扩大带宽。扩频代码是伪随机二进制数据流。

### 两种扩频

#### 跳频扩频 FHSS

frequency hopping spread spectrum：用源信号调制 M 个不同的载波频率，在某一时刻使用信号调制1个载波频率，在下一时刻信号跳至另一个频率，最终使用 M 个频率。源信号扩展后占用的带宽是 $B_{FHSS}>>B$

- 过程：
	- 伪随机代码生成器 pseudorandom code generator（又称为伪随机噪声 pseudorandom noise，PN）对每个跳周期 $T_{h}$（hopping period）生成一个 k 位模式
	- 频率表使用这个模式查找频率作为这个跳周期的频率，再通过它发送到频率合成器
	- 频率合成器生成该频率的载波信号，同时源信号调制这个载波

![[第6章-带宽利用-FHSS.png]]
- 如图，模式是伪随机的。这个方案实现了扩频的目的：当有许多个k位组模式而跳周期是短的，那么发送方和接收方具有保密性。入侵者窃听传输信号，只能获得很少一部分，不知道扩频序列就不能适应下一跳变。而干扰者发送的噪声只会到达一个跳周期，而不是全部周期，所以抗干扰能力强

- 宽带共享：如果跳频数是 M，则可将 M 个通道复用为使用同一带宽 $B_{ss}$ 的一个通道。一个站点在每跳周期中只用一个频率，其他 M-1个站点使用 M-1个频率，如果使用合适的调制技术，如 FSK（MFSK），M 个不同站点可用同一带宽 Bss

- FDM 中，每个站点用带宽的1/M，但是固定分配；FHSS 中，每个站点占用带宽的1/M，但跳到跳改变分配 


#### 直接序列扩频 DSSS

direct sequence spread spectrum:也是扩大源信号的带宽

- 方法：每个数据位用扩展编码的 n 位代替。即每一位被编码的 n 个码片，此处码片的速率是数据比特率的 n倍

- 巴克序列 Barker sequence：n=11，假定源信号与码片生成器中的码片使用极性 NRZ 编码，例图 6.33 复用源信号和扩频信号的结果。扩频信号是源信号的 11 倍，扩频信号提供保密，若每个站点使用不同的编码，可以获得抗干扰能力
- ![[第6章-带宽利用-DSSS.png]]

- 宽带共享：
	- 如果使用一个扩频代码去扩频不能组合和分离的信号（来自不同的站），就不能共享带宽
	- 如果使用一个允许组合和分离的扩频信号的特殊类型的序列代码，则可以共享带宽