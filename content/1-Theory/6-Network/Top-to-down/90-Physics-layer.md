> 来自参考书《数据通信与网络》佛罗赞
> 这里的内容太过贴近底层——电信专业的内容，所以大概看看就好。

## 绪论

### 数据通信

- 数据：指以任何格式表示的信息，该格式需经由创建和使用数据的双方均已达成共识 

- 数据通信：是在两台设备之间通过诸如线缆等某种形式的传输介质进行的数据交换
    - 决定效率的四个关键因素
        - 传递性
        - 准确性
        - 及时性
            - 什么是实时传输？
        - 抖动性
    - 组成
        - 报文 message 
        - 发送方 sender 
        - 接收方 receiver 
        - 传输介质 transmission medium 
        - 协议 protocol 

- 数据表示
	- 文本
		- 位模式（位序列）表示
		- 位的数目决定
		- 统一码 Unicode，ASCII 码 
	- 数字
		- 位模式表示，但ASCII码不是用来表示数字的，直接二进制数转换即可
	- 图像image
		- 位模式表示
		- 被划分为像素矩阵，对每个像素分配一个位模式，模式的大小和值取决于该图像
			- 对一幅仅由黑白点（棋盘）构成的图像而言，1位就足以表示一个像素
			- 如果不是纯黑或纯白，可以增加为模式的大小来包含更多的灰度范围，如黑（00），深灰（01），浅灰（10），白（11）
			- 表示彩色：
			1. 每个颜色像素分解为三原色 RGB，测量其浓度并赋予一种位模式；
			2. YCM 作为三原色
		- 像素大小取决于分辨率
	- 音频audio
		- 连续的、非离散的信号。需要转换
	- 视频video
		- 由一个连续实体或由一组图像或动画合成


- 数据流
	- 单工simplex mode
		- 单向通信，一台设备只发送，另一台只接收。仅具有一个方向的发送能力
	- 半双工half-duplex mode
		- 每台主机均能发送和接收，但不能同时进行，当一台设备发送时，另一台只能接收，即通道的通信能力被发送方完全占用
		- 用于不需要双方同时通信的情况，每一方均可利用整个通道的能力
	- 全双工full-duplex mode
		- 双方主机都能同时发送和接收。两个方向的信号共享该链路的通信能力。共享可以有两种方式：
			- 链路包含两条物理上独立的传输通路，其中一条用于发送，另一条接收
			- 通道的通信能力在以不同方向传输的信号间进行划分
		- 要求双方同时通信时，采用全双工，然而通道的通信能力必须在两个方向之间进行划分


### 网络

- 网络network
    - 是用通信链路连接起来的设备（又称节点）的集合
    - 链路：将数据由一台设备传输到另一台设备的通信通路
    - 设备（节点）：任何能够发送或接收数据的设备，如计算机、打印机
    - 分布式处理distributed processing
        - 将任务划分给多台计算机，而不是让一台大型机负责所有的处理

#### 网络准则

- 性能performance
	- 衡量
		- 传输时间：指报文从一台设备传输到另一台设备所需的时间
		- 响应时间：指请求和响应之间所花费的时间
	- 度量
		- 吞吐量throughput
		- 延迟delay
- 可靠性reliability——衡量标准：
	- 故障出现的频率
	- 一条链路从故障恢复所花费的时间
	- 在灾难中的健壮性
- 安全性security——衡量标准：
	- 保护数据免受未授权的访问
	- 保护数据在传输过程中免受攻击
	- 数据丢失与损伤的恢复策略和方法

#### 物理结构

- 连接类型
	- 点到点（point to-point）：提供两台设备之间专用的链路。链路全部能力均为两台设备之间的传输所共用
	- 多点连接multipoint connection（多站连接multidrop connection）：两台以上设备共享单一链路的情形。通道的能力在空间或时间上共享。
		- 空间上共享连接：同时可以有多台设备使用链路
		- 时间上共享连接：用户必须轮流使用

- 物理拓扑结构(physical topology)：网络在物理上的分布方式，是所有链路及其互相连接的设备（节点）之间关系的几何表示
	- 网状（点到点连接）mesh topology
		- 各台设备之间都有一条专用的点到点链路。专用的，意味着该链路只负责它所连接的两台设备间的通信量
		- n个节点就需要n（n-1）条物理链路，如果允许双工通信，则除2。为了提供这么多数量的链路，网络中的每台设备必须有n-1个IO端口
		- 优点：
			- 专用链路的使用保证了每条链路都能传输自己的数据载荷，消除了当链路被多台设备共享时可能发生的通信量问题
			- 网状拓扑结构是健壮的
			- 良好的机密性和安全性。每一个报文经过专用线路传输时，只有特定的接收方才能看见它
			- 容易进行故障识别和故障隔离
		- 缺点：
			- 安装和重新连接十分困难，因为每台设备都必须与其他所有设备相连
			- 线缆的数量过多，可能超过可利用空间的容纳能力
			- 为连接每个链路所需的IO端口和电缆成本过高
	- 星型（点到点连接）star topology
		- 每台设备拥有一条仅与中央控制器连接的点到点专用链路，中央控制器称为集线器（hub）。此结构不允许设备之间有直接的通信量，集线器扮演交换的角色
		- 优点
			- 易于安装和重新配置，增加、移动和删除链路只涉及一条连接
			- 健壮性
			- 易于进行故障识别和故障隔离
		- 缺点
			- 过于依赖集线器
	- 总线（多点连接）bus topology
		- 由一条较长的线缆作为主干backbone来连接网络上所有的设备
		- 节点由引出线和分接头连接到总线电缆。引出线是在设备和主线缆之间运行的连接，分接头是一个焊入主线缆或穿过线缆的外皮与金属芯接触的连接器
		- 优点：
			- 安装简易，主干线缆以最高效的路径来铺设，通过不同长度的引出线连接到节点
			- 只有主干电缆铺设于整个房间中，每条引出线只需到达主干线上最近的节点
		- 缺点：
			- 信号沿主干传输时，部分能量转化为热能，会随着距离的增加信号越来越微弱。因此总线所能支持的分接头数目以及这些分接头之间的距离有限
			- 难以重新连接和进行错误隔离。它在设计安装时就按最优方式铺设，增加新设备较困难
			- 在分接头会产生信号反射造成质量下降，虽然可以通过限制连接到给定电缆的设备数目和距离来控制这种质量下降的问题
			- 总线电缆上的错误或中断会使所有的传输中止，即使位于故障区域同一侧的设备。故障区域会将源方向的信号反射回去，从而在两个方向上产生噪音
	- 环状（多点连接）ring topology
		- 每台设备只与其两侧的设备有一条专用的点到点的连接。信号以一个方向在环中传输，从一台设备到另一台，直到目的设备。环中每台设备中安装一个中继器，当设备接收到发给另一台设备的信号时，它的中继器会再生并转发这些位
		- 优点：
			- 易于安装和重新配置，要增加或删除设备只需要改变两条连接
			- 简化了故障隔离
		- 不利因素：
			- 在于介质和通信量方面（环最大长度和设备的最大数目）
			- 单向通信量。简单的环中，故障可能使整个网络瘫痪，可以通过引入双环或使用能够旁路故障的开关弥补
	- 混合型
		- 如：一个星型结构为主干并具有多个总线结构的网络

#### 网络模型

- 计算机网络是由许多实体组成，需要标准协调网络之间的通信

- 著名标准：
	- OSI（开放系统互连）模型
	- 因特网模型


- 网络分类：按规模划分
	- 局域网 LAN（local area network），覆盖范围小于两英里
		- 通常是专用的。其设计用来共享个人计算机或工作站之间的资源（硬件如打印机、软件如应用程序、数据等等）
		- 通常给定的LAN仅使用一种类型的传输介质，常见使用总线结构、环状结构、星型结构
		- 传统数据速率在4~16Mbps之间。吉位系统的开发可以使其提升至100
	- 城域网MAN（metropolitan area network），覆盖范围十几英里
		- 为需要高速地连接因特网的用户而设计
	- 广域网WAN（wide area network），可以是世界范围
		- 提供远距离的数据、音频、图像和视频信息传输，跨越的地理区域包括国家、洲、世界。
		- 通常首先指交换广域网，其次是点到点广域网
			- 交换广域网：连接端系统，该系统含有一个路由器（网际互联设备），它连接另一个局域网或广域网。典例：X.25和异步传输模式ATM网络
			- 点到点广域网：通常从电话局或有线电视电缆提供商租用专线连接家用计算机或小型局域网到因特网服务提供商ISP，常用作对因特网的访问


- 网络互连：因特网

- 两个或多个网络彼此连接，成为互联网络internetwork


### 因特网

- 历史
	- 因特网Internet是由成千上万的互相连接的网络组成的集合
	- 1967年，ACM会议上，ARPA（美国国防部DoD高级研究计划局Advanced Research Project Agency）提出了ARPANET概念
	- 1969年，实现了由四个节点（UCLA、|UCSB、SRI、犹他大学）通过IMP（接口报文处理器）连接而成的ARPANET。由称为网络控制协议NCP的软件提供主机间通信
	- 1972年，Vint Cerf和Bob Kahn在网络互连项目上合作。第二年发表论述了端到端的信息分组发送协议实现的论文TCP，后来专家将其拆分成两部分
		- 传输控制协议TCP（Transmisson Control Protocol）：负责高层功能，如分段、重组和差错检测
		- 网际协议IP（Internetworking Protocol）：负责处理数据报路由

- 现状
	- 因特网现在是由私有公司而不是政府运行，大多数想建立因特网连接的终端用户使用因特网服务提供商ISP（Internet Service Provider）提供的服务
	- ISP分类
		- 国际服务提供商
		- 国家服务提供商NSP（National Service Provider）：有专门的公司创建和维护的主干网络。为了提供终端用户之间的连接，主干网络由复杂的交换工作站连接，称为网络访问点NAP（network access point）。以很高的数据速率（600Mbps）运行
		- 区域性因特网服务提供商regional ISP，连接到一个或多个NSP的小型ISP。数据速率较低，第三层
		- 本地因特网服务提供商local ISP，提供到终端用户的直接服务

### 协议与标准

- 协议
	- 实体是能够发送和接收信息的任何事物，计算机网络中的通信发生在不同系统的实体之间。协议是用来管理数据通信的一组规则，规定了通信的内容、通信的方式和通信的时间
	- 核心要素
		- 语法syntax：数据的结构或格式
		- 语义semantics：每一个位片段的含义
		- 时序timing：报文的发送时间和发送速率

- 标准：为制造商、销售商、政府部门和其他服务提供商提供了一系列准则
	- 事实通信标准de facto standard：未经组织团体承认但已经在广泛使用中被接受的标准
	- 法定通信标准de jure standard：由官方认可的团体制定的标准

- 标准化组织（北美）
	- 国际标准化组织ISO
	- 国际电信联盟-电信标准分会ITU-T
	- 美国国家标准协会ANSI
	- 电气和电子工程师协会IEEE
	- 电子工业协会IEA
	- 论坛forums：由于其用户专注于某一具体的技术，能够在电信领域加速这些技术的采纳和使用

- 因特网标准Internet standard：经过完全测试的规范，对使用因特网的人们有用并且被他们所拥护



## 网络模型

- 任务分层
    - 发送方、接收方和载体
    - 层次结构
        - 对发送方和接收方而言，任务的进行必须按照给定的层次顺序完成
        - 服务：在接收方，每一层都使用其直接下层提供的服务

### OSI模型

Open System InterConnection

- 简述
	
	- 一个能包含网络通信各方面的ISO（国际标准化组织）标准的模型
		
	- 开放系统open system，是一组协议，它允许任何两个不同系统进行相互通信，而不管其底层结构如何
		
	- OSI模型目的：使不同系统间的通信变得容易，而不要求对其底层的硬件和软件的逻辑结构做任何改动
		
	- OSI模型不是一个协议，而是一个模型，利用这一模型可以理解并设计一个灵活、健壮和可互操作的网络体系结构
		
	- OSI模型提供了一个用来进行网络系统设计的层次化框架，由7个相互独立又相互关联的层次组成，每一层都定义了通过网络传递信息的一部分功能


- 层次化体系
	
	- OSI可有序地分层：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层
		
	- 建立模型过程中，设计者将传输数据的过程归结为一些最基本的元素，这些元素确定了具有相关用途的网络功能，按照功能归类的功能组就是各个层次。每一层都定义了一系列与其他层次不同的功能
		
	- 通过这种方式进行功能定义和局部化，使设计者能建立一个全面又灵活的体系结构。由此，OSI模型得以使不兼容系统之间完全透明化
		
	- 单台机器中，每一层调用下一层提供的服务；两台机器之间，一台机器上的第x层与另一台机器的第x层进行通信。这种通信由一些列协议来控制


- 对等过程
	
	- 定义：每台机器上==特定层次的通信过程==。由此，机器间的通信就是使用适用于给定层次的协议的对等过程
		
	- 在发送端，每一层都在从直接上层传来的报文加上自己的信息，并将整个分组传到它的直接下层；在物理层，整个分组被转换成可以传输到接收端设备的形式；在接收端，报文被一层一层打开，每一层接收兵提取对它有意义的数据
		
	- 层间接口：数据和网络信息在层次间的传递，是通过相邻两层的接口来实现的
		
		- 每一层接口都定义了该层必须向上层提供信息和服务
			
		- 良好定义的接口和层功能可使网络模块化
			
		- 只要某一层仍能为上一层提供所期望的功能，该层功能的具体实现就可以在不改变周围层次的基础上进行修改和替换
			
		
	- 层次组织
		
		- 7个层次可以分成3个子功能组
			
			- 网络支持层（物理层、数据链路层、网络层）：处理从一设备到另一个设备数据传输的物理方面问题（如电气特性、物理连接、物理寻址、传输的时序和可靠性）
				
			- 传输层：将两个子功能组连接起来，保证下层是以上层能够使用的形式传输的
				
			- 用户支持层（会话层、表示层和应用层）：允许不相关的软件系统间的互操作
				
			
		- 高层通常通过软件实现，低层则通过硬件软件混合，物理层几乎都是硬件
			
		- 发送过程从第七层（应用层）开始，一层层向下移动，在每一层数据单元可能加入头部或尾部。格式化的数据到达物理层时，转换成电磁信号在物理链路上传输
			
		- 接受过程，信号传入第一层并被重新转换成数字形式，之后从下向上传到OSI各层。当每一数据块到达下一更高层时，在发送端对应层次附加的头部和尾部就被除去，并执行该层相应的动作


- 封装
	
	- 定义：第n-1层的分组中的数据部分是第n层的完整分组（数据+头部或尾部）
		
	- 第 n-1层不知道被封装分组中，哪些部分是数据，哪些部分是头部或尾部。对于第 n-1层，来自第 n 层的分组是作为一个整体单元处理的

### OSI模型各层功能

![[20-网络模型-OSI.png]]

#### 物理层

通过介质传输bit，提供机械及电气规范

- 定义了接口与传输介质的机械和电气特性，也定义了物理设备和接口为了传输而必须执行的过程和功能
	
- 负责位从一个节点到另一个节点的传递
	
- 考虑问题：
	
	- 接口与介质的物理特性：定义了设备与传输介质之间的接口特性，也定义了传输介质的类型
		
	- 位的表示：物理层的数据是没有任何解释的位bit流（由0、1组成的序列），要进行传输必须将之编码成信号（电信号、光信号）。因此，要定义编码encoding的类型（如何将0、1转换成信号）
		
	- 数据速率：传输速率——每秒发送的位数。换言之，定义一个位的持续时间
		
	- 位同步：发送方和接收方要有相同的比特率，也要位同步（发送时钟和接收时钟同步）
		
	- 线路配置：设备与介质的连接（点到点配置、多点配置）
		
	- 物理拓扑结构：定义如何将设备连接成网络（网状、星型、环状、总线）
		
	- 传输方式：两台设备间的传输方向（单工、半双工、全双工）


#### 数据链路层

将 bit 组成帧，提供节点到节点的传递

- 将物理层——对数据不做任何改动的传输通道变成可靠的链路，由此将物理层的数据无差错地传递给上层（网络层）
	
- 负责帧从一跳（节点）到下一跳（节点）的传递
	
- 考虑问题：
	
	- 成帧：将接收到的来自网络层的位流划分成帧（易处理的数据单元）
		
	- 物理寻址：
		
		- 如果帧是发送给网络中的不同系统，则链路层在帧的头部添加发送方的物理地址和接收方的物理地址
			
		- 如果帧发往发送方网络之外的系统，接收方的地址就是连接一个网络到下一个网络的设备地址
			
		
	- 流量控制：防止接收方接收数据过载
		
	- 差错控制：检测与重发损坏帧或丢失帧，防止重复帧（差错控制通常在一个帧地结束处增加一个尾部来处理）
		
	- 访问控制：当两台或多台设备连接到同一条链路上时，数据链路协议必须能决定在任意时刻由哪一台设备来获取对链路的控制权
		
	
- 跳到跳传递hop-to-hop delivery（节点到节点传递node-to-ndoe delivery）

#### 网络层

将分组从源传递到目的地，提供网际互连

- 负责将各个分组从源地址传递到目的地址，可能会通过多个网络（链路）。尽管链路层会监视同一个网络（链路）上两个系统之间分组的传递，但仍需网络层确保每个分组能够从出发点到达目的地
	
- 如果两个系统连接在同一条链路上，通常不需要网络层；如果两个系统在不同的网络（链路）上并通过网络（链路）之间的设备连接，通常需要网络层以完成源端到目的端地传递
	
- 考虑问题：
	
	- 逻辑寻址：给来自上一层的分组增加一个头部，包括发送方和接收方的逻辑地址
		
		- （物理寻址负责处理本地网络寻址问题，由链路层完成，如果一个分组通过网络边界，就需要另一个寻址系统来帮助区分源与目的系统）
			
		
	- 路由选择：提供连接设备（路由器或网关）把分组送到它们的最终目的地的机制。（对于一些独立网络或链路连接在一起构成一个互联网或一个更大网络的情况）

#### 传输层

提供端到端的可靠报文传递和差错纠正

- 负责整个报文的进程到进程传递
	
- 网络层监管各个分组的源端到目的端传递，但并不了解这些分组之间的相互关系。传输层确保整个报文误差挫并按顺序地到达目的地，在源到目的层次进行差错控制和流量控制
	
- 考虑问题：
	
	- 服务点寻址：将信息的头部包含服务点地址（端口地址），以应对从计算机到计算机、特定进程到特定进程的情况。网络层将每个分组传送到指定的计算机上，传输层将整个报文传送给该计算机上的指定进程
		
	- 分段和组装：将报文分解成可传输的片段，并且给这些片段编号（编号可以在接收端正确组装报文，也可以用来标识和替换传输中丢失的分组）
		
	- 连接控制：无连接或面向连接
		
		- 无连接：将每个片段作为一个独立的分组，并将它传递到目的机器的传输层
			
		- 面向连接：在传递分组之前，需要与目的机器的传输层建立一条连接，所有数据被传输后，该连接释放
			
		
	- 流量控制：端到端上控制流量，而不是单条链路上
		
	- 差错控制：进程到进程上控制差错，而不是单条链路上。发送方的传输层确保整个报文无差错（损坏、丢失或重复）地到达接收方的传输层。通过重发来纠正差错


#### 会话层

建立、管理和终止对话

- 网络的对话控制器，建立、维护和同步通信系统间的交互操作
	
- 考虑问题：
	
	- 对话控制：允许两个系统进入会话，允许两个进程之间以半双工、全双工方式进行通信
		
	- 同步：允许一个进程在数据流中增加检查点或同步点(synchronization point)


#### 表示层

翻译、加密和压缩数据

- 两个系统之间交换信息的语义和语法
	
- 负责翻译、加密和压缩数据
	
- 考虑问题：
	
	- 翻译：发送方的表示层将信息从发送方使用的格式转换成一个公共格式，接收方机器的表示层将公共格式转换成接收方使用的格式
		
		- 两个系统中的进程通常以字符串、数字等格式交换信息，传输前信息要转换成位流，不同的计算机采用不同的编码系统，表示层负责不同编码方式之间的互操作
			
		
	- 加密：发送方将原来的信息转换为另一种形式，并在网络上发送转换后的形式。解密反之
		
	- 压缩：减少需要传输数据的位数。对于多媒体（文本、音频、视频）的传输很重要


#### 应用层

允许访问网络资源

- 使得用户（人或软件）可以访问网络，提供了用户接口和访问支持。（如电子邮件、远程文件访问与传输、共享数据库管理以及其它分布式信息服务）
	
- 负责向用户提供服务
	
- 考虑问题：
	
	- 网络虚拟终端：物理终端的软件版本，允许用户登陆到一台远程主机上
		
		- 应用程序在远程主机上创建一个软件模拟终端，用户计算机只与这个软件终端对话，软件终端与主机对话，反之亦然。远程主机认为自己是在与自己的一个终端通信，因而允许用户登录
			
		
	- 文件传输、访问和管理：允许用户访问远程计算机上的文件（进行修改或读取数据），从远程计算机上检索文件，以及管理或控制远程计算机上的文件
		
	- 邮件服务：电子邮件存储转发的基础
		
	- 目录服务：提供分布式数据库资源以及对不同对象和服务的全球信息的访问

### TCP/IP协议族

- 由相互作用的模块组成分层协议，每一层提供一个特定的功能，但不需要相互依赖。各层包含一些相对独立的协议，它们依据系统的需要混合语匹配（分层：意指每个上一层协议是由一个或多个下层协议支持的）
	
- 分层与各层协议
	
	- 实际层次：
		
		- 主机到网络层：相当于OSI的物理层和数据链路层的组合
			
		- 互联网层：网络层
			
		- 传输层：处理会话层的部分功能
			
		- 应用层：相当于会话层、表示层和应用层
			
		
	- 为分析理解假定层次：
		
		- 对应于OSI模型前4层，提供物理标准、网络接口、网际互连和传输功能
			
			- 物理层和数据链路层：TCP/IP不定义任何协议，支持所有标准和专门协议，采用TCP/IP互联的网络可以是LAN和WAN
				
			- 网络层：支持网际协议IP（Internetworking Protocol）
				
				- 网际协议IP：TCP/IP协议使用的传输机制
					
					- 是一个不可靠、无连接数据报协议，称为尽力传递best-effort delivery，尽力意即IP没有差错检测和跟踪。IP假定了底层是不可靠的，只是尽最大努力传输到目的地，但没有保证
						
					- IP传输的数据称为数据报，每一个数据报都独立地传输。数据包可以沿着不同的路由传输，有可能不按顺序到达、重复出现等。IP没有路由跟踪，数据报一旦到达目的地，没有重新排序功能
						
					- 不要将这个局限看作缺点，这样简单的传输使用户自由添加已知应用所必需的功能，效率更高
						
					
				- IP使用四个支持协议：
					
					- 地址解析协议ARP（Address Resolution Protocol）：将逻辑地址与物理地址相联系起来，用于已知节点的因特网地址寻找该节点的物理地址
						
					- 逆地址解析协议RARP（Reverse Address Resolution Protocol）：允许主机在仅知道物理地址的情况下寻找因特网地址。在主机第一次连接到网络上或启动一台无盘计算机时会用到
						
					- 因特网控制报文协议ICMP（Internet Control Message Protocol）：有主机和网关所使用的一种机制，用来向发送方通知数据报所发生的问题
						
					- 因特网组报文协议IGMP（Internet Group Message Protocol）：用于将一个报文同时发送给一组接收者
						
					
				
			- 传输层：用TCP、UDP、SCTP三个协议表示
				
				- IP是主机到主机协议，可以将分组从一个物理设备传递到另一个物理设备；UDP、TCP是负责将报文从一个进程传递到另一个进程的传输层协议
					
				- 用户数据报协议UDP（User DATa gram Protocol）：是一个进程到进程的协议，仅将端口号、校验和差错控制及信息长度添加到来自上一层的数据中
					
				- 传输控制协议TCP（Transmission Control Protocol）：为应用程序提供了完整的传输层服务，是一个可靠的流传输协议（流表示面向连接的：在传输的两端可以传送数据以前必须先建立连接）
					
				- 流控制传输协议SCTP（Stream Control Transmission Protocol）：用于对较新应用提供支持，如音频传输
					
				
			
		- 对应OSI模型最上面3层（会话层、表示层、应用层）的单一层
			
			- 应用层

### 寻址

采用TCP/IP协议的互联网使用四层地址：

- 物理（链路）地址physical（link） address：
	
	- 对应数据链路层和物理层
		
	- 是局域网或广域网定义的节点地址，包含在数据链路层所用的帧中，是最低级的地址
		
	- 长度和格式可变，与网络有关。大多局域网用48位（6个字节）的物理地址，被写作12个十六进制的数字，每个字节用冒号分割开
		
	- 帧的头部含有物理地址，目的地址在前，源地址在后


- 逻辑地址logical address：
	
	- 对应网络层
		
	- 唯一定义了连接到因特网的一台主机，与下面的物理网络无关，适应全世界互联的网络环境
		
	- 发送方在网络层封装分组并添加源地址和目的地址，源地址在前，目的地址在后
		
	- 帧的物理地址会改变，但源和目的逻辑地址必须保持相同，否则该分组将会被丢失


- 端口地址port address：
	
	- 对应传输层
		
	- 因特网通信的最终目的是进程到进程的通信。为了使不同的进程同时接收数据，用16位端口地址赋予进程标识符，以此标记不同的进程
		
	- 即使两台计算机运行同一个应用程序，但一个是客户进程，另一个是服务进程，其端口地址不同
		
	- 在因特网范围内，从跳到跳物理地址会改变，但从源到目的逻辑地址和端口地址保持不变

- 专用地址：
	
	- 对应应用层
		
	- 面向用户的应用设计为专用地址。如电子邮件的地址 `1821552335@qq.com`，统一资源定位符 URL `www.google.com`，
	- 前者定义邮件的接发者，后者在万维网中寻找一个文档。这些地址由发送计算机转换成对应的端口地址和逻辑地址


## 数据和信号

### 模拟与数字

数据以及表示数据的信号可以使用模拟analog或者数字digital的形式

- 模拟数据与数字数据
	
	- 模拟数据指连续状态的信息，例如人说话时形成模拟形式的声波，通过麦克风采集并转换成模拟信号，或者采样转换成数字信号
		
	- 数字数据指离散状态的信息，例如0/1形式的数据可以转换成数字信号，或调制成模拟信号通过介质进行传输

- 模拟信号与数字信号
	
	信号signal可以是数字信号或模拟信号
	
	- 模拟信号在一段时间内有无穷多个强度等级。当波形振幅由A变为B时，沿着它变化的过程有无穷多个值
		
	- 数字信号只能有有限个已定义的数值，通常是0或1
		
	- 以信号的值或强度为纵轴，时间为横轴建立直角坐标系
		
		- 表示模拟信号的曲线经过了无限多个数值点
			
		- 表示数字信号的竖直线表示了信号值到值的突变

- 周期信号与非周期信号
	
	- 周期信号periodic signal在一个可测量的时间范围内（一个周期period）完成一种模式，并且在后续的相同时间范围内重复这一模式。一个完整模式的实现称为一个循环
		
	- 非周期信号nonperiodic signal的变换则不会随时间的变化出现重复的模式或循环
		
	- 周期模拟信号需要更少的带宽，非周期数字信号可以表示数据的变化

### 周期模拟信号

- 正弦波
	
	​正弦波是不能再被分解的简单模拟信号，由峰值振幅、频率和相位三个参数完全确定；复合型模拟信号是由多个正弦波信号组成的
	
	- 峰值振幅：最高强度的绝对值，与所携带的能量成比例（对电信号，常以伏特为单位计量）
		
	- 周期与频率：周期Period是信号完成一个循环所用时间，单位秒；频率Frequency是1s内完成的周期数，单位赫兹
		
		- 频率既可以看做一秒钟完成的周期数，也可以看作变化速率的计量单位（变化占用的时间短意味着频率高，变化占用的时间长意味着频率低）
			
		- 信号持续不变化，则频率值为0；由一个电平立即跳变到另一电平，频率值为无穷大

- 相位phase
	
	相位指波形相对于时间零的位置

- 波长wavelength
	
	波长是信号通过传输介质传播的另一个特性，将简单正弦波的周期或频率与介质的传播速度propagation speed结合在一起
	
	- 信号的频率与介质无关，但波长取决于频率和介质，波长是任何信号的一个属性
		
	- 在数据通信中，一般用波长来描述光纤中的光传输。波长是简单信号在一个周期能传播的距离
		
	- 波长=传播速度×周期。电磁信号的传播速度取决于介质和信号频率


- 时域time-domain和频域frequency-domain
	
	- 时域图time-domain plot显示了信号振幅随时间的变化情况，相位在其中没有显式的表现出来
		
	- 频域图frequency-domain plot只和峰值、频率相关，不显示一个周期中的振幅变化。通过一个尖峰表示完整的正弦波，其位置表示频率，其高度表示峰值振幅
		
	- 处理多个正弦波时，频域图更简洁有用


- 复合信号composite signal
	
	单一正弦波将电子能量从一个位置传送到另一个位置，但不会携带任何信息；复合信号才能用来通信
	
	- 傅里叶分析指出，任何复合信号都是由具有不同频率、相位和振幅的正弦波信号组合成的
		
	- 复合信号可以是周期性的或非周期的。周期复合信号可以分解成一系列具有离散频率的简单正弦波；非周期复合信号可以分解成具有连续频率的无穷简单正弦波的组合
		
	- 与周期性复合信号频率相同的分解正弦波频率为f，称为基础频率（fundanmental）、第一谐波（harmonic）；其他频率为kf的，称为第k谐波。分解后的信号频率是离散的，k为整数。周期复合信号的频率总是由离散尖峰组成
		
	- 对于非周期复合信号，时域表示有无数个简单正弦频率，但频率的范围是有限的，频域表示是一条连续的曲线


- 带宽bandwidth
	
	- 复合信号包含的频率范围叫带宽，通常是最大频率与最小频率之差


- 非周期复合信号的例子：
	
	- 有调幅AM无线电站传播的信号（美国分配给每个AM无线电站10kHz带宽，总带宽从530kHz到1700kHz）
		
	- 调频FM无线电站传播的信号（美国分配给每个FM无线电站200kHz带宽，总带宽从88MHz到108MHz）
		
	- 黑白电视接收信号，屏幕扫描次数×像素总值即使每秒变化的像素，以最低振幅、最高振幅各表示一种颜色则每周期可发送2像素，故二者之商是每秒所需要周期，由此可以得出需要带宽。大约每个黑白电视频道有4MHz带宽


### 数字信号

如果信号有 L 个电平，则每个电平需要 $\log_{2}L$ 个位。由此，多个电平可以发送多个位。每个电平发送的位数必须是整数且是2的幂，故电平取值为向上取整

- 比特率bit rate：1s中发送的位数，单位是bps（bits per second每秒位）

- 位长bit length：一个位在传输介质上的距离。位长=传播速度×位持续时间

- 数字信号是一种复合模拟信号
	
	基于傅里叶分析，数字信号是复合模拟信号
	
	- 带宽是无穷大的。因为在时域中，数字信号由连接的垂直和水平线段组成，垂直线表示无穷大的频率，水平线表示0频率
		
	- 运用傅里叶分析分解数字信号：
		
		- 如果数字信号是周期性的，分解后的信号可以表示为无穷大带宽和离散频率的频域
			
		- 非周期性的，则是无穷大带宽和连续的频率

#### 数字信号的传输

数字信号是无穷大带宽的复合模拟信号

- 基带传输
	
	- 通过通道发送数字信号，该信号不转换成模拟信号
		
	- 基带baseband传输需要一个带宽下限频率为0的低通通道（low-pass channel），此时带宽只组成一条通道的专用介质。无穷大带宽的低通通道仅是理想情况，现实中不可能存在
		
	- 两种低通通道：
		
		- 宽带宽：只有在无穷大或非常大带宽的低通通道，保持数字信号形状的数字信号基带传输才是可能的
			
			注意例3.21，LAN使用专用通道（介质的整个带宽用于一条单通道）用于两个站之间互相通信。多点连接的总线拓扑结构LAN中，每个时刻只有两个站可以互相通信，其他站限制发送数据；星型拓扑结构中，每个站和集线器之间的整个通道用于这两个实体间通信
			
		- 窄带宽：此中，将数字信号近似成模拟信号，近似程度取决于可用的带宽
			
			- 大致近似：对于比特率为N的数字信号，用频率为f=N/2的模拟信号（每个周期发送两位，以1为正尖峰值，0为负尖峰值）作为最大频率，其他如N/4频率及不同相位可以大致近似表示不同的数字信号。大致近似称为第一谐波N/2频率
				
			- 更好近似：增加频率更多的谐波来使得模拟信号的形状更像数字信号，因此要增加带宽，如增加带宽到3N/2、5N/2、7N/2等
				
			
		
	- 在基带运输中，所需的带宽与比特率成正比；如果需要更快地发送位，就需要更大的带宽
		
	- 应用：
		
		- 如果需要使用基带传输发送1Mbps，则低通通道所需带宽是多少？
			
			取决于所需的准确性
			
			- 最小带宽、大致近似，则B=1Mbps÷2=500kHz
				
			- 使用第一和第三谐波结果更好，所需带宽B=3×500kHz=1.5MHz
				
			- 使用第一、第三、第五谐波仍然更好，则B=5×500kHz=2.5MHz
				
			
		- 有一条带宽为100kHz的低通通道，求其最大比特率：使用第一谐波可以得到最大比特率，比特率是2倍有效带宽，即200kbps

- 宽带传输（使用调制）
	
	即把数字信号转换成模拟信号运输
	
	- 调制允许使用带通通道bandpass channel，即带宽不从0开始的通道，其比低通通道更可用。低通通道可以看作是较低频率从0开始的带通通道
		
	- 数字信号的调制过程：发送方，数字信号转换成复合模拟信号，使用单频率模拟信号（载波）已经改变的载波振幅使其看起来像数字信号（结果不是单频率信号，是复合信号）；接收方，接收到的模拟信号转换成数字信号
		
	- 注意例3.24、例3.25，分别是通过电话用户线传输计算机数据和数字蜂窝电话。对于数字蜂窝电话实例，如果有效带宽是W，且允许1000对用户同时交谈，意味着有效带宽是W/1000，只是整个带宽的一部分


### 传输减损

#### 衰减attenuation

- 意味着能量的损失。当某种简单或者复合的信号通过某种介质传输时，它会失去一些能量用于克服介质的阻抗，信号中的一部分电能转换成热能（为了补偿能量损失，可用放大器放大信号）
	
- 分贝decibel：
	
	用于计算两种信号之间或者同一信号在两个不同位置之间的相对强度
	
	- $dB=10\log_{10} \frac{P_{2}}{P_{1}}$，P1 和 P2 分别是信号在位置 1 和位置 2 的功率；
	- 若以电压定义分贝，则公式为 $dB=20\log_{10} \frac{V_2}{V_1}$
		
	- dB为负值，则信号被衰减了；dB为正值，信号被放大了。-3dB或3dB衰减等价于功率损失了一半
		
	- 当涉及计量多处（级联）而不仅仅是两处的信号强度时，分贝数可以相加（相减）
		
	- 以毫瓦计量信号功率：$dB_{m}=10\log_{10} P_{m}$，$P_m$ 是以毫瓦为单位的功率

#### 失真distortion

- 意味着信号改变了形态或形状，产生在由不同频率成分组成的复合信号当中
	
- 每一种信号成分在通过介质时有自己的传播速度，到达最终目的节点时有各自的延迟。如果延迟与周期时间不完全一致，那么延迟的差异就会产生相位的差异，即接收方的信号成分与发送方的信号成分存在相位差异。由此出现复合信号的失真

#### 噪声noise

- 类型：
	
	- 热噪声：电缆中的电子随机移动产生的额外信号
		
	- 感应噪声：发动机和设备工作时相当于发射天线，而传输介质成为接收天线
		
	- 串扰：电缆之间的相互影响，一条电缆作为发射天线而另一条作为接收天线
		
	- 脉冲噪声：一种尖峰信号，非常短时间内有很高能量的一种信号，来自传输电线、闪电等


- 信噪比SNR（signal-to-noise ratio)
	
	- $SNR=\frac{平均信号功率}{平均噪声功率}$，即所需信号和无用信号的比率。较高的SNR意味着信号较少地被噪声破坏，较低地SNR则意味着信号较多的被噪声破坏
		
	- 用分贝单位描述 SNR，即 $SNR_{dB} = 10\log_{10}SNR$。对于无噪声通道的 SNR 为 $+∞$，SNR（dB）也为 $+∞$


### 数据速率限制

数据通信的一个重要问题：在一个通道中能够以多快的速率发送数据，即每秒钟的比特数

- 取决因素
	
	- 有效带宽
		
	- 使用的信号电平数
		
	- 通道的质量（噪声电平）


#### 奈奎斯特公式Nyquist bit rate

- 用于无噪声通道，定义了理论上的最大比特率：
	- $比特率=2×带宽×\log_{2}L$

- 虽然在理论上由此公式可认为给定特定的带宽可以通过增加信号电平数获得任何我们想要的比特率，但实际上**电平数的增加增大了接收方的负担，对方很难区分多个电平**。增加信号电平数减弱了系统的可靠性

- 奈奎斯特公式可以应用到基带传输和调制，也可以应用到有两个或多个信号电平的情况


#### 香农容量定理Shannon Capacity

- 能够确定噪声通道理论上的最高数据速率：
	- $通道容量=带宽×\log_{2}(1+SNR)$，通道容量是指通道的传输容量，即每秒的比特数

- 公式中没有指出信号电平，意味着无论使用多少个电平，都不能获得比通道容量更高的数据速率。**公式定义了通道的特性，而不是传输方式**

- 对于信噪比 SNR 接近于0的通道，其容量计算也为0，且与带宽无关，通过此通道不能接收到任何数据 

- 要使得数据发送速率更宽，需要更大的线路带宽或更高的信噪比

- SNR 很大时，SNR+1与 SNR 几乎相等，此时可以简化计算：$通道容量 C=\frac{带宽B×SNR_{dB}}{3}$ 

- 二者结合使用，先用香农容量定理确定数据速率的上限，再以确定的数据速率利用奈奎斯特公式计算信号电平的数量（为了获得更好的性能，可选择较低的数据速率）


### 性能

#### - 带宽

- 以赫兹衡量的带宽：复合信号包含的频率范围或通道能通过的频率范围
	
- 以每秒比特数衡量的带宽：指通道、链路或者网络每秒能发送的位数
	
- 两者关系：以赫兹衡量的带宽的增长意味着以每秒位数衡量的带宽的增长。之间的关系取决于是否有基带传输或者调制传输


#### 吞吐量 throughput

用于衡量通过网络发送数据的快慢

- 与以每秒位数衡量的带宽是不同的。带宽是链路的潜在衡量值，而吞吐量是发送速度快慢的实际衡量值，实际永远比潜在小
	
- 吞吐率=位总数÷时间


#### 延迟delay

定义了第一个位从源开始发出到整个报文完全到达目标所经历的时间。延迟=传播时间+传输时间+排队时间+处理延迟

- 传播时间propagation time:衡量一个位从源传输到目标所需的时间。传播时间=距离/传播速度
	
- 传输时间transmission time:传输时间=报文长度/带宽
	
- 排队时间queuing time:每个中间或端设备在处理报文前所需的时间。这个不是固定因素，会随着网络负载而改变。中间设备（如路由器）对到达报文进行排队然后一个个处理，吐过报文过多，每个报文就不得不等待
	
- 处理延迟processing delay

#### 带宽延迟之积

是能充满链路的位的个数。类比于水管的容量，横截面为带宽，长度为延迟

- 为了使用链路的最大容量，需要脉冲长度是宽带和延迟乘积的两倍，需要充满全双工通道
	
- 发送者应该发送一个（2×带宽×延迟）位的数据脉冲，然后发送方在发送下一个脉冲前等待这个脉冲部分的接收方的确认。（2×带宽×延迟）是任何时刻转换的位数


#### 抖动 jitter

如果数据的不同分组碰到不同的延迟并且接收方使用数据的应用是时间敏感的，抖动就可能会产生问题


## 数字传输

### 数字到数字转换

digital- to-digital convertion

数字信号表示数字数据的转换涉及三种技术：线路编码（总是需要的）、块编码（不一定需要）、扰动（不一定需要）

#### 线路编码 line coding

将数字数据转换为数字信号的过程。

线路编码将位序列转换成数字信号，在发送方数字数据被编码成数字信号，接收方则解码数字信号重新生成原数字数据

- 不同线路编码方案的共同特性：
	
	- 信号元素与数据元素：
		
		- 数据元素是表示一块信息的最小实体，即位
			
		- 信号元素是数字信号的最小单元。信号元素承载数据元素
			
		- 比率r（=数据元素数/信号元素数）为每个信号元素承载的数据元素的数量
			
		
	- 数据速率和信号速率：
		
		- **数据速率** data rate 定义1s 发送的数据元素数量，单位是每秒位 bps。有时被称为比特率 bit rate
			
		- **信号速率** signal rate 是1s 发送的信号元素的数量，单位是波特 baud。有时被称为脉冲速率 pulse rate、调制速率 modulation rate、波特率 baud rate
			
		- 数据通信的一个目标是增加数据速率（增加了传输速度）而降低信号速率（降低了带宽需求）
			
		- 数据速率与信号速率关系：
			
			- 取决于 r 值和数据模式
				
			- $S = c×N× \frac{1}{r}$ baud，N 是数据速率 bps，c 是情形因子（有三种情形：最好、最坏、一般，最坏情形是需要最大信号速率，最好情形是需要最小信号速率），S 是每秒信号元素的数量，r 是每个信号元素能够携带的数据元素的数量
			- ![[40-数字传输-r-carried-ratio.png]]
				
			
		
	- 带宽：携带信息的数字信号是非周期性的，其理论（真实）带宽是无限连续的，但实际上有效带宽有限（振幅过小的忽略不计）
		
		- 带宽影响了所需的频率范围。需要带宽的图表等更多信息，而不只是值
			
		- 波特率决定了数字信号的带宽：$B_{min} = c×N× \frac{1}{r}$，带宽（频率范围）与信号速率成正比
			
		- 如果通道带宽给定，则最大数据速率：$N_{max} = \frac{1}{c}×B×r$
			
		
	- 基线偏移baseline wandering：
		
		- 基线baseline：解码数字信号时，接收方计算接收到信号功率的运行平均值
			
		- 输入信号的功率会与基线比较来确定数据元素的值，一个0/1的长字符串会引起基线偏移，使得接收方不能正确地进行解码。一个好的线路编码方案需要防止基线偏移
			
		
	- 直流成分DC component：当数字信号中的电平保持一段时间的恒定时，频谱产生的接近于0的频率
		
		- 直流成分会给不允许通过低频率的系统或者使用电子耦合的系统（变压器）带来问题。此时就需要使用无直流成分的方案
			
		
	- 自同步self-synchronizing：为了正确地解释从发送方接收到的信号，接收方的位间隔必须与发送方的位间隔严格对应。如果不匹配，接收方就可能错误地解码
		
		- 数字信号在传输的数据中包含有定时信息
			
		- 如果信号中包含有提示接收方起始、中间和结束位置的脉冲的跳变就可以完成自同步。如果接收方的时钟不同步，这些提示跳变就会将接收方的时钟复位
			
		
	- 内置差错检测：编码方案产生的代码需要一定程度的内置差错检测能力来检测传输中发生的一些差错
		
	- 抗噪声和抗干扰能力：保证传输过程中受影响较小
		
	- 复杂性：复杂方案需要更高的成本


- 线路编码方案
	
	- 单极编码方案：所有信号电平都在时间轴的一边
		
		- 不归零 NRZ（non-return-to-zero），在位中间信号不会回到零。一般单极编码方案设计成不归零方案。
		- ![[40-数字传输-unipolar-NRZ.png]]
			
		- 特点：成本高，标准功率（每个单元线路阻抗发送1位所需的功率）是极性NRZ方案的两倍
			
		
	- 极性编码方案：电平在时间轴的两边
		
		- 不归零编码NRZ在极性NRZ（polar NRZ）编码中，信号的振幅使用两个电平
			
		- 极性NRZ的两种形式：
			
			- NRZ-L（NRZ电平编码，NRZ-Level）：信号电平决定了位值
				
			- NRZ-I（NRZ 反向编码，NRZ-Invert），信号电平是否反相或跳变决定了位值，如果没有跳变，位值为 0，否则为1
			- ![[40-数字传输-polar-NRZ.png]]
				
			- 二者皆有 r=1，平均信号速率 $S_{avg}=\frac{N}{2}$ baud
				
			- 存在问题：
				
				- 基线偏移问题：NRZ-L比NRZ-I更严重。NRZ-L中有一个全0或全1长序列，则平均信号功率就会变斜，接收方辨别位值较困难；NRZ-I中只有全0长序列会发生，消除全0序列即可避免基线偏移
					
				- 同步问题：NRZ-L比NRZ-I更严重。全0长序列都会引起问题，但全1长序列只在NRZ-L中产生问题
					
				- 系统极性意外改变：NRZ-L会在极性改变时，将所有0解释为1而所有1解释为0，而NRZ-I不会有此问题
					
				- 带宽：频率接近于零时，功率密度值会很高，意味着有携带了高电平能量的DC成分。实际上，大多数能量集中在0~N/2之间的频率，意味着虽然平均信号速率是N/2，但能量被平均在这两个值之间的频率中
					
				
			
		- 归零编码RZ（return-to-zero）：为的是解决发送方和接收方时钟不同步问题，它使用三个值：正值、负值、零。信号在位中间变化而不是两个位之间
			
			- 每个位中间信号变成 0，保持到下一个位开始
			- ![[40-数字传输-polar-RZ.png]]
				
			- 缺点：
				
				- 需要两个信号变化来编码一个位，占用更大的带宽
					
				- 极性意外改变的问题仍然存在，但没有了DC成分的问题
					
				- 复杂，使用了三个电平，生成和识别较困难
					
				- 被性能更好的曼彻斯特编码和差分曼彻斯特编码代替
					
				
			- r=1/2，$S_{avg}=N$
				
			
		- 双相编码：
			
			- 曼彻斯特编码：位的持续时间被二等分，前半部分电平保持一个水平，后半部分变成另一个水平，位中间的跳变提供了同步。组合了RZ和NRZ-L的思想
				
			- 差分曼彻斯特编码：在位中间总有一个跳变，但是位值在位开始时确定，如果下一个位是 0，就有一个跳变，如果是 1，则没有跳变。组合了 RZ 和 NRZ-I 的思想
			- ![[40-数字传输-Polar-biphase.png]]
				
			- 曼彻斯特编码克服了 NRZ-L 的一些问题，差分曼彻斯特编码克服了 NRZ-I 的一些问题。解决了基线偏移问题、DC 成分问题 
				
			- 缺点在于信号速率，曼彻斯特编码和差分曼彻斯特编码的信号速率是NRZ的2倍
				
			- r=1/2，$S_{avg}=N$
				
			
		
	- 双极性方案：双极bipolar编码（又称多电平二进制multilevel binary）中，有三个电平（正值、负值、零），一个数据元素的电平是0，另一个数据元素的电平在正值、负值间交替
		
		- 双极交替传号反转AMI（alternate mark inversion）：传号指1，其表示的含义是交替的1的反换。中值0电平表示二进制的0，交替正负电平表示二进制的1
			
		- 伪三元编码 pseudoternary：AMI 编码的一个变型，位 1 编码成 0 电平，位 0 编码成交替正负电平
		- ![[40-数字传输-Bipolar.png]]
			
		- 双极性方案是NRZ的替代方案，其信号速率与NRZ相同，但没有DC成分，能量集中于频率N/2处（NRZ能量集中于0~N/2区间，如果通道这个频率附近性能较差，这个编码就不适合）
			
		- AMI通常用于长距离通信，但数据中存在0长序列时会有同步问题。可以通过扰动技术解决
			
		- r=1，$S_{avg}=\frac{N}{2}$
			
		
	- 多电平方案：由增加数据速度或者降低所需带宽的需求催生，目标是通过把m个数据元素的模式编码成n个信号元素的模式，增加没波特的位数
		
		- 对于只有两种数据元素0/1，则 m 个数据元素组可以产生 $2^m$ 个数据模式组合；而不同信号元素可用不同的电平表示，如果 L 个不同电平，就会有 $L^n$ 个信号组合 
			
			- 如果$2^m=L^n$，则每个数据模式编码成一个信号模式
				
			- 如果$2^m<L^n$，则数据模式只能占据一个信号模式的子集，多余的部分则可以用来提供同步并检测数据传输中出现的差错、避免基线偏移
				
			- 如果$2^m>L^n$，则无法完成数据编码
				
			
		- mBnL，m是二进制模式的长度，B表示二进制数据，前两个字母定义了数据模式；n是信号模式长度，L是信号中电平数（L=2用B表示，L=3用T表示，L=4用Q表示），后两个字母定义了信号模式
			
			- 2B1Q：两个二元一个四元（two binary, one quaternary），使用长度为2的2位数据模式编码成一个4电平信号元素
				
				- ![[40-数字传输-2b1q.png]]
				- r=1/2，$S_{avg}=\frac{N}{4}$，意味着2B1Q 发送数据比 NRZ-L 快2倍
					
				- 但是用4个不同的信号电平，意味着接收方要辨别4个不同的阈值，降低的带宽需要更高的成本来弥补
					
				- $2^2=4^1$，故此方案没有多余的信号模式
					
				
			- 8B6T：八个二元六个三元（eight binary, six ternary），把8位模式编码成6个信号元素模式，每个信号有3个电平
				
				- ![[40-数字传输-8b6t.png]]
				- 有$2^8=256$个数据模式和$3^6=478$个信号模式，故有222个冗余信号元素用来提供同步和差别检测，还有一部分用于DC平衡
					
				- 每个信号模式有0或+1的DC值得平衡梁，意味着没有平衡量为-1值得模式。为了DC整个流实现DC-平衡，发送方必须关注平衡量，如果两个平衡量为+1的组紧接着，第一个组保持原状发送，第二个组全部取反使得平衡量为-1
					
				- $S_{avg}=\frac{1}{2}×N× \frac{6}{8}$，实际上最小带宽十分接近$\frac{6N}{8}$
					
				
			- 4D-PAM5：4维5级脉冲振幅调制（four-dimensional five-level pulse amplitude modulation）：4D表示数据同时通过4条线路发送，使用5个（-2，-1，0，1，2）电平，其中0只用于发送差错检测
				
				- ![[40-数字传输-4dpam5.png]]
				- 一维版本，4个电平产生类似于8B4Q方案的编码，即一个8位码字转换成一个4电平的信号元素，此时最差信号速率是N/2
					
				- 该技术用来通过4个通道发送数据，意味着数据速率可以降低到N/8，所有8个位同时进入一条线路通过使用1个信号元素发送。关键点在于4个信号元素组成1个信号组，并通过四维环境同时发送
					
				- 这个方案有很大的冗余，额外的信号模式可以用于诸如差错检测等其他目的
					
				
			
		
	- 多线路传输：NRA-I和差分曼彻斯特编码是差分编码，使用两种不同的跳变规则来编码二进制数据（没有反相、有反相）。如果信号电平多于2个，则涉及跳变规则多于2个的差分编码方案出现
		
		- 三电平多线路传输 MLT-3（multiline transmission, three level）方案使用 3 个电平（+V、0、-V）和三个跳变规则在电平间变动
		- ![[40-数字传输-mlt3.png]]
			
		- 三个跳变规则：
			
			- 如果下一个位是0，没有跳变
				
			- 如果下一个位是1，且当前电平不是0，下一个电平是0
				
			- 如果下一个位是1，且当前电平是0，下一个电平是最后一个非零电平的相反值
				
			
		- S(ave)=N/2，该方案中信号形状帮助降低了所需的带宽
			
		- 最坏情形：全1的序列，每4个位就重复信号元素模式+V0-V0，非周期信号变成周期信号，周期等于4倍位持续时间。可以模拟成频率为1/4比特率的模拟信号

![[40-数字传输-line-coding-summary.png]]

#### 块编码 block coding

给出某种冗余来确保同步，并提供一些内在的差错检测，提高线路编码的性能


- 块编码一般涉及三个步骤：分组、置换、组合
	
- mB/nB，把m位的块变成n位的块。块编码称为mB/nB编码技术。n一般大于m，故新形成的流比原始流有更多的位：
	
	- 4B/5B：4个二元/5个二元（four binary/five binary）
		
		- 设计出来于NRZ-I组合使用，在NRZ-I编码前改变位流，解决了NRZ-I连续为0的长序列出现同步问题的缺点。在接收方，NRZ-I编码后的数字信号先解码成位流，再去掉冗余
			
		- 4B/5B编码中，将4位输入置换成5位输出，仅包含不超过一个前导0（左边位）和两个后缀0（右边位），因此最多有三个连续的0。
			
		- 4位组有16个不同的组合，5位组有32个不同的组合。冗余的部分一些用于控制，一些用于差错检测（接收到的5位组属于表中没有使用的成分，则传输中出现了差错）
			
		- 增加了NRZ-I的信号速率，冗余位增加了20%的波特，但仍小于两相方案，其信号速率是NRZ-I的两倍。但是没有解决DC成分的问题，如果DC成分不可接受，须换用两相或双极编码方案
			
		
	- 8B/10B：8个二元/10个二元（eight binary/ten binary）
		
		- 类似于4B/5B方案，有更强的差错检测能力和同步能力（2^10-2^8=768个冗余，可以用于不均等性校验），优于4B/5B。实际上是5B/6B和3B/4B方案的组合
			
		- 高5位送入5B/6B编码器，低3位送入3B/4B编码器。简化映射表，防止连续0或1的长串
			
		- 编码使用不均等性控制器观察0或1的数量。如果当前块中的位产生了不均等性，而该不均等性对上一块的不均等性有影响（任一方向），那么当前块中所有为取反


#### 扰动

Scrambling

不会增长位数并提供同步的技术，以及一种把0电平脉冲置换成其他电平组合来提供同步的解决方法

- 修改了AMI部分规则引入（避免初始流中连续0长序列的方法使得双极AMI可以用于长距离）。相对于块编码，扰动和编码同时完成，系统需要基于定义好的扰动规则插入所需脉冲

- 两种通用扰动技术：
	
	- B8ZS：8零置换的双极编码方案（bipolar with 8-zero substitution），通常用于北美地区，八个连续0电平被替换成000VB0VB
		
		- V表示违反，这个非零电平违反了AMI编码规则（前一极的相反极）；B表示双极，表示与AMI规则相一致的非零电平
			
		- V和B是相对的，V表示与前一个非零脉冲极性相同的极性；B表示与前一个非零脉冲极性相反的极性
			
		- 这里的扰动不会改变比特率，且该技术平衡了正电平和负电平，意味着维持了DC平衡。此处置换可能会改变1的极性，因为置换后AMI需要遵守它的规则
			
		
	- HDB3：高密度双极3零方案（high-density bipolar 3-zero），通常用于北美地区以外，比B8ZS技术更保守。四个连续零电平被置换成000V或B00V
		
		- 不同置换的原因是为维持每次置换后非零脉冲为偶数：
			
			- 如果最后一次置换后的非零脉冲数为奇数，置换模式是000V，使得非零脉冲数为偶数
				
			- 如果最后一次置换后的非零脉冲数为偶数，置换模式是B00V，使得非零脉冲数为偶数
				
			
		- 第一次置换前，非零脉冲数是偶数，所以第一次置换是B00V


### 模拟到数字转换

analog-digital conversion

数字信号优于模拟信号，需要将模拟信号转换成数字信号进行传输

#### 脉冲码调制 PCM

pulse code modulation 三个过程

- 采样：对模拟信号进行采样
	
	- 采样率 sampling rate 或采样频率 sampling frequency：$f_{s}=\frac{1}{T_{s}}$，$T_{s}$ 为对模拟信号进行采样的样本间隔或周期
		
	- 三种采样方法：
		
		- 理想采样：对来自模拟信号的脉冲进行采样
			
		- 自然采样：当采样发生时高速开关开启很短的时间，其样本序列保持了模拟信号的形状
			
		- 方顶采样：通过采样和保持技术sample and hold，在适用电路中产生
			
		
	- 采样过程有时称为脉冲振幅调制PAM（pulse amplitude modulation），其结果仍是非完整的模拟信号
		
	- 采样速率sampling rate：根据奈奎斯特定理Nyquist theorem，为了再生原始模拟信号，一个必要条件是采样速率至少是原始信号中最高频率的两倍
		
		- 约束：
			
			- 只有信号带宽是有限时，才能对它进行采样
				
			- 采样率必须至少是最高频率而不是带宽的两倍
				
			
		- 奈奎斯特定理运用例子：
			
			- 时钟例子：时钟的秒针周期为60s，以奈奎斯特率进行采样无法判断时钟的行进方向，过采样（高于奈奎斯特率）才能显示正确的方向，欠采样（低于奈奎斯特率）则会得到相反的方向。
				
			- 电影车轮转向例子：电影以每秒24帧的速度拍摄，如果车轮以高于每秒12次的速度旋转，欠采样就会产生车轮向后旋转的假象
				
			- 低通信号带宽在0~f之间，其最大频率为f；带通信号带宽确定，但最小频率最大频率不能确定，无法求出最小采样率
				
			
		
	- 采样后的结果：一系列振幅值介于信号最大振幅和最小振幅间的脉冲。振幅集可能是无限个介于两个限制间的非整数值，这些值无法用于编码，需要进行量化


- 量化：对采样后信号进行量化
	
	- 步骤：
		
		- 得到原始模拟信号的振幅 $V_{min}$ 和 $V_{max}$ 区间
			
		- 将范围分成 L 个区间，每个区间高度为Δ，则 $\Delta= \frac{V_{max}-V_{min}}{L}$
			
		- 分配0到L-1的量化值给每个区间的中点
			
		- 样本振幅值近似为量化值
			
		
	- 例子：
		- ![[40-数字传输-quantization.png]]
		- 使用理想采样得到9个样本，样本顶端的值为实际振幅
		
		- 标准化PAM值：实际振幅/Δ
			
		- 标准化量化值：选自每个区间的中点
			
		- 标准化误差：标准化量化值-标准化PAM值
			
		- 量化码：每个划分区间的中点，从0~L-1
			
		- 编码码字：根据量化码转换的最后数字信号结果
			
		
	- 量化等级：L（等级数）的选择取决于模拟信号振幅范围以及需要准确恢复信号的程度。更高的量化等级恢复程度更高，如果信号的幅度变化很大，较低的L值就会增加量化误差
		
	- 量化误差：量化是一个近似过程，量化器的输入值是实际值，输出值是近似值。输出值为区间的中间值，如果输入值也在区间中间，就没有量化误差，否则就会有误差。误差在-Δ/2与Δ/2之间
		
		- 量化误差对信号 SNR（dB）的影响取决于量化级别 L 或每个样本位数 $n_{b}$：$SNR_{dB} = (6.02n_{b}+1.76)dB$
			
		
	- 均匀量化与非均匀量化：
		
		- 上例就是均匀量化
			
		- 而对于其他很多应用，模拟信号中瞬时振幅的贡献不均匀的，振幅的变化一般在低频率中比高频率中发生的更频繁，此时采用非均匀量化更好：Δ的高度不固定，接近低振幅时较大而接近高振幅时较小
			
		- 非均匀量化使用压缩companding和扩展expanding的过程实现。在发送方，信号在转换前先压缩，在接受方，转换前先扩展。压缩表示减小较大瞬时电平振幅值，扩展相反。压缩使得强信号的电平衡量更大，而弱信号的电平衡量更小
			
		- 非均匀量化有效地减小了量化 $SNR_{dB}$


- 编码：量化后的值编码成位流
	
	- 在每个样本量化并且每个样本的位数确定后，每个样本可以转换成 $n_{b}$ 个位的码字，每个样本的位数取决于量化等级数，$n_{b}=\log_{2}L$
		
	- $比特率=采样速率×每个样本位数=f_{s}\times n_{b}$ 
		
	- 原来信号恢复：需要PCM解码器。
		
		- 解码器先使用电路把码字转换成保持下一个脉冲前振幅的脉冲
			
		- 阶梯信号完成后，经过一个低通过滤器把阶梯信号平滑成模拟信号。过滤器有同发送方原来信号一样的阶段频率
			
		- 如果信号是以奈奎斯特采样速率采样的，并且有足够的量化等级，就可以重新生成原来信号
			
		
	- PCM 带宽：给定低通模拟信号的带宽，要数字化这个信号，则通过这个数字化信号的通道的最小带宽 $B_{min} = c×N× \frac{1}{r} = c×n_{b}×f_{s}× \frac{1}{r} = c×n_{b}×2×B_{analog})× \frac{1}{r}$。
		
		- 当 $\frac{1}{r} = 1$（对于 NRZ 或双极信号）和 $c=\frac{1}{2}$（平均情况）时，最小带宽 $B_{min} = n_{b}×B_{ana log}$。这意味着数字信号的最小带宽是模拟信号的 $n_b$ 倍
			
		
	- 通道的最大数据率：$N_{max} = 2×B×\log_{2}L$ bps
		
		- 如何从奈奎斯特采样定理推导出？
			
			- 假定可用通道是带宽为B的低通通道
				
			- 假定要发送的数字信号有 L 个电平，每个电平是一个信号元素，即 $r = 1/\log_{2}L$
				
			- 先把数字信号通过低通过滤器阶段 *B* Hz 以上的频率
				
			- 把结果信号看作模拟信号，并且以每秒 2×B 个样本对它进行采样，使用 L 个电平进行量化。因为信号初始有 L 个电平，所以额外的量化电平是无用的
				
			- 结果比特率是 $N = f_{s}×n_{b} = 2×B×\log_{2}L$，这是最大带宽。如果情形因子 c 变大，数据速率就减小
				
			
		
	- 最小所需带宽：如果数据速率和信号电平数都是固定的，则 $B_{min} = N/(2×\log_{2}L)$ Hz


#### Delta 调制 DM

PCM得到每个样本的信号振幅值，DM从前一个样本中得到变化

- 调制器:用在发送方站点，用来从模拟信号中产生位流
	
	- delta δ记录了处理的正/负改变。delta是正的，就记录1，是负的，记录0。需要一个基准提供模拟信号比较
		
	- 调制器生成一个像梯形的第二个信号，发现变化后变为输入信号与逐步生成的梯形信号进行比较
		
	- 在每个采样区间，调制器将模拟信号的值与梯形信号的最后一个值相比较，如果模拟信号的振幅大，数字数据的下一个位就是1，否则为0
		
	- 比较器（调制器的组成部分：比较器、延迟单元、梯形生成器）的输出能自己生成梯形信号，如果下一个位是1，梯形信号生成器就会把梯形信号的最后一个点向上移动δ，是0就下移δ
		
	- 需要额外的一个延迟单元，在两次比较间保持梯形函数
		
	
- 解调器：得到数字数据，用梯形生成器和延迟单元产生模拟信号，再通过一个低通过滤器来平滑模拟信号
	
- 适配DM：通过适配delta调制（adaptive delta modulation），δ根据模拟信号的振幅而改变，可以获得更好的性能
	
- 量化误差：DM的量化误差远小于PCM的，尽管仍不完美

### 传输模式

通过链路传输二进制数据可采用的传输模式

#### 并行模式

parallel transmission

- 定义：计算机使用和生成以位组（每组由n位的二进制数据组成）为单位的数据。通过位组，一次可以发送n位数据而不是1位
	
- 机制原理：每次使用n条线路传送n位。每位有自己的线路，一个位组中的所有n位能够在一个时钟脉冲从一个设备传输到另一个设备
	
- 优缺点：
	
	- 缺点：高成本。需要n条通信线路，因此通常只用于短距离通信
		
	- 优点：高速度。当其他因素相同时，并行传输比串行传输提高了n倍传输速度


#### 串行模式

serial transmission

位依次传输，只需要一条传输通道，因此成本低，约是并行传输的1/n；又因为设备内部数据是并行的，所以在发送方和线路之间、线路和接收方之间，都需要**串行/并行转换设备**

- 异步传输asynchronous transmission：
	
	- 异步传输特点：信息的接收和转换通过约定的模式进行，传输中信号的时序并不重要。只要遵循约定模式，接收设备就可以不管信息发送的节奏而正确地获取信息
		
		- 约定模式基于将位流组成字节的方式建立的。每一个组作为一个单位沿着链路传送
			
		- 发送系统独立处理每个分组，每处理完一个组就将它转发到链路上而不理会时钟信号
			
		
	- 处理同步机制：
		
		没有同步时钟，接收方就不能通过计时方式预测下一个新组何时到达，所以需要别的方式处理同步
		
		- 在每一个字节的开始处增加一个起始位start bit（通常是0）用于通知接收方有一个新组到达；在字节的结束位置增加一个或多个位作为停止位stop bit（通常是1）用于通知接收方字节已经结束
			
		- 这样，字节长度会增加，并且每发送完一个字节，要跟上一段可变长的时间间隔，这段间隔通过空闲状态或者附加的停止位流表表示
			
		
	- 异步中的同步：
		
		- 起始位、停止位以及时间间隔用于提示接收方每一个字节的开始和结束，使得接收方可以根据数据流进行同步
			
		- 异步机制：在字节这一级，发送方和接收方不需要进行同步，但在每一个字节内部，接收方仍要与输入的位流进行同步
			
		- 异步在这里指的是字节级上的异步，但是每位仍要同步，局限在单个字节内，它们的持续时间相同。每个新字节开始时，接收设备会重新进行同步
			
		- 具体细节：当接收方检测到起始位后，它会启动计时器，随着位的到来开始计数，在接收完n个位后，接收方就等待停止位的到达。一旦检测到停止位，接收方在下一个起始位到达前忽视接收到的所有信号
			
		
	- 异步传输附加了停止位、起始位以及在位流中插入间隙，使得其比没有附加控制信息的传输方式运行较慢，但是优点在于便宜而有效，对于低速通信很有吸引力（如键盘到计算机）


- 同步传输synchronous transmission：
	
	- 特点：同步传输中，位流被组合成更长的“帧”，一帧包含了许多字节，帧内各字节之间没有间隙。数据以一种不间断的1/0位串进行传输，接收方将位流分割成重构信息所需的一个个字节。（即此传输模式中，依次发送位流而不含起始位、停止位和间隙，接收方负责将位进行分组
		
	- 细节：
		
		- 发送方将数据作为一个长的串发送到线路上（如果发送方希望再单独地一段一段地发送数据，则每段数据之间的间隙必须由意味着空闲状态的0/1序列填充
			
		- 接收方将在位到达时计数，并将它们重组为字节形式
			
		- 由于没有时隙和起始位、停止位这样的位流内部的同步机制来帮助接收设备在处理位流时调整位同步，因此接收到的信息的准确性完全取决于接收设备根据接收到的位的准确计数能力，所以计时变得非常重要
			
		
	- 优点：高速。发送方没有引入额外的位或者间隙并且接收方也不需要将它们去掉，通过链路传送的位更少，比异步传输更快。不过要注意，虽然在以同步串行传输的字符间没有间隔，但是帧间可能有不等的间隔
		
	- 例子：计算机之间的数据传输。字节同步在数据链路层完成


- 等时传输isochronous transmission：
	
	- 如果一个图象是用一个或多个帧发送，帧间应该没有延迟，此时字符间的同步是不够的，整个流必须同步。等时传输保证了数据以固定速率到达


## 模拟传输

### 数字到模拟的转换

digital-to-analog conversion：指根据数字数据中的信息而改变模拟信号的某种特性的过程

- 过程：发送方将数字数据通过调制器转换成模拟信号在链路中传输，模拟信号到达接收方，通过解调器转换成数字数据被接收
	
- 正弦波由振幅、频率和相位三个特性唯一定义。通过改变正弦波的某一特性，就可以用来表示数字数据

#### 数模转换问题

- 数据元素和信号元素：数据元素是一块信息的最小实体，即位；信号元素是信号的最小单元
	
- 比特率和波特率：比特率是每秒发送的位数，波特率是每秒发送的信号元素数。在数字数据模拟传输中，波特率小于等于比特率
	
	- $S=N× \frac{1}{r}$ baud，此中 N 是数据速率 bps，r 是一个信号元素携带的数据元素个数。模拟传输中 $r=\log_{2}L$，此处 L 是信号元素类型而不是电平数
		
	
- 带宽：除FSK外，**数字数据的模拟传输所需的带宽与其信号速率成正比**；而在FSK中，还要加上载波信号频率间的差值
	
- 载波信号carrier signal：模拟传输中，发送设备产生的一个来承载信息信号的高频率信号作为基波，此即载波信号（或载波频率）
	
	- 接收设备要将自己的收听频率调整到与所期望的发送设备的载波信号的频率一致
		
	- 数字信息通过改变载波信号的一个或多个特性（振幅、频率或相位）来调制载波信号（形式的改变称为调制或移动键控）

#### 调制数字数据到模拟信号

- 幅移键控ASK（amplitude shift keying）：通过改变载波信号的振幅来生成信号元素，只有振幅变化而频率和相位保持不变
	
	- 二进制 ASK（BASK）：二进制幅移键控或开关键控 OOK，只使用两个电平，一个信号电平的振幅峰值为 0，另一个和载波频率振幅一样
	- ![[50-模拟传输-BASK.png]]
		
	- ASK带宽：承载信号在调制处理后产生一个非周期性复合信号，这个信号有一个连续频谱。
		
		- 带宽与信号速率（波特率）成正比：$B=(1+d)×S$，S是信号速率，B是带宽，d是个相干因子取值在0~1之间
			
		- 由上公式知所需带宽最小为S，最大为2S
			
		- 带宽的位置：载波频率 $f_{c}$ 位于带宽中间。这意味着如果有可用的带通通道，就可以选择 $f_{c}$ 使得调制后的信号能占用该带宽。这就是数模转换最重要的优点，可以把发生的带宽平移到可用带宽
			
		
	- 实现：如果数字数据表示为一个单极 NRZ，具有 1V 高电平和 0V 低电平，那么可以将数字信号乘来自振荡器的载波信号即可
	- ![[50-模拟传输-impl-BASK.png]]
		
	- 全双工链路实例：在数据通信中，若使用全双工链路，需要把带宽分成两部分，每部分各有一个载波频率。即总的带宽分成两个部分，每个方向占用一部分，可用带宽为总带宽的一半
		
	- 多电平 ASK：信号使用4、8、16或更多的振幅，对应使用2、3、4或更多位来调制数据，对应 r=2、3、4。需要结合 QAM 实现
		


- 频移键控FSK（frequency shift keying）：通过改变载波信号的频率来表示数据，而所有的信号元素振幅峰值和相位保持不变
	
	- 二进制FSK（BFSK）：选择两个载波频率f1和f2，分别对应数据元素0和1.通常这两个载波频率很高，差很小
		
		- ![[50-模拟传输-BFSK.png]]
		- 一个带宽中点的频率是f1，另一个带宽中点的频率是f2。f1和f2离这两个带的中点的距离都是Δf，则两个频率之差为2Δf
			
		
	- BFSK的带宽：两个简单正弦波的载波信号调制产生一个具有连续频谱的非周期复合信号
		
		- 可以将 FSK 看作两个 ASK 信号，每一个有自己的频率，若两频率的差为 $2Δ_{f}$，则 BFSK 的带宽为：$B=(1+d)×S+2Δ_{f}$
			
		- 2Δf 的最小值至少应该是 S 
			
		
	- 实现：两种实现方法：非相干和相干
		
		- 非相干
			
			- 非相干BFSK中 ，当一个信号元素结束下一个信号元素开始时相位是不连续
				
			- 非相干BFSK可以通过把BFSK看作两个ASK调制并使用两个载波频率实现
				
			
		- 相干
			
			- 相干BFSK中，两个信号元素的边界处的相位是连续的
				
			- 相干 BFSK 可以通过使用一个压控振荡器 VCO（voltage-controlled oscillator）实现，压控振荡器是根据输入电平改变频率。例如：图 5.7 中，振荡器的输入是单极 NRZ 信号，当 NRZ 振幅为 0 时，振荡器保持它的正常频率；NRZ 振幅为正时，增加频率
			- ![[50-模拟传输-impl-BFSK.png]]
				
			
		
	- 多电平 FSK：使用多个频率发送位。但是，相邻频率需要相隔2Δf，为了调制解调器正常工作需要 $2Δ_f$ 最小值为 S，所以当 d=0 时 $B=(1+d)×S+(L-1)2Δ_f⇨B=L×S$


- 相移键控PSK（phase shift keying）：通过改变载波的相位来表示两个或多个不同的信号元素，峰值振幅和频率保持不变
	
	- 二进制 PSK（BPSK）：一个相位是 0°，另一个相位是 180°
	- ![[50-模拟传输-BPSK.png]]
		
	- **PSK 抗噪声能力优于 ASK**，并且不需要两个载波信号
		
	- 带宽：与二进制ASK相同$B=(1+d)S$，少于BFSK（没有浪费带宽来分离成两个载波信号）
		
	- 实现：相位 180°的信号元素可以看作是相位 0°的信号元素的互补波形（基于时间轴对称），所以可以使用极性 NRZ 信号乘以载波频率。位 1 表示成相位从 0°开始，位 0 表示成相位从 180°开始
		- ![[50-模拟传输-impl-BPSK.png]]
		
	- 正交 PSK（QPSK）：若在每个信号元素中一次使用 2 位，可以减小波特率和所需带宽，即是正交 PSK。
		- ![[50-模拟传输-QPSK.png]]
		
		- 使用两个独立的BPSK调制：一个同相，另一个正交（异相）
			
		- 进入的2个位先经过串行到并行的转换，它发送一个位给一个调制器，发送下一个位给另一个调制器。如果进入信号中的每个位的持续时间是T，发送相应BPSK信号的每个位持续时间就是2T，即每个BPSK信号中位的频率是原始信号的一半
			
		- 由每个乘法器产生各自的复合信号是频率相同但相位不同的正弦波，这两个复合信号相加时结果是另一个正弦波，其相位可能是45°、-45°、135°、-135°之一。输出信号有四种信号元素，使得每个信号元素可以发送2位
			
		
	- 星座图constellation diagram：有助于定义信号元素的振幅和相位，尤其在使用两个载波时
		
		- ![[50-模拟传输-constellation-diagram.png]]
		- 图中，一个信号元素用一个点表示，其携带的位或位组合写在旁边
			
		- 星座图水平X轴与同相载波相关，垂直Y轴与正交载波相关。点在X轴的投影定义了同相成分的峰值振幅，在Y轴的投影定义了正交成分的峰值振幅，点到原点的连线长度是该信号的峰值振幅，连线与X轴之间的角度是信号元素的相位
			



- 正交振幅调制QAM（quadrature amplitude modulation）： PSK受到设备辨别相位细小差别能力的限制，所以潜在的比特率受限。FSK有带宽限制而无法与其他调制方法结合使用，而将ASK和PSK结合就是QAM：
	
	- 使用两个载波，一个同相另一个正交，每个载波都用不同的振幅
		
	- ![[50-模拟传输-QAMs.png]]
	- 图5.14列出了4-QAM（4个不同信号元素类型）以及16-QAM的星座图
		
	- QAM的带宽：需要的最小带宽与ASK和PSK相同。相对于ASK，QAM有更好的抗噪声能力


### 模拟信号调制

通过模拟信号来表示模拟信息

调制模拟信号的必要性：如果介质具有带通特性或者只有带通带宽可用，那么模拟信号就需要进行调制

- 无线电实例：政府为每一个无线电台分配基带带宽，每个电台生成的模拟信号都是低通信号，都在同一频率范围内。为了能够接收不同电台，需要将低通信号平移，是每一个信号对应不同的频率范围


- 模拟到模拟的转换 analog-to-analog conversion：有三种方法实现
	
	- **调幅AM**（amplitude modulation）：对载波信号进行调制，使其振幅随着调制信号的振幅变化而被改变
		
		- 载波的频率和相位保持不变，只有振幅随着信息改变。调制信号变成了载波信号的一个包路线
			
		- AM通常使用简单乘法器实现，使得载波信号的振幅需要根据调制信号的振幅变化
			
		- AM带宽：
			
			- AM 信号的带宽是调制信号带宽的两倍，并且覆盖了以载波频率为中心的频率范围
			- ![[50-模拟传输-AM.png]]
				
			- $B_{AM} = 2B$
				
			- 由于载波频率上边带和下边带的信号成分携带的信息完全相同，所以一些实现丢弃了一半的信号，削减了一半的带宽
				
			
		- AM无线电的标准带宽分配：
			
			- 音频信号（语音和音乐）的带宽通常是5kHz，所以一个调幅的无线电台需要的最小带宽是10kHz
				
			- AM电台可以使用530kHz~1700kHz之间任何一个频率作为载波频率，但每一个调幅电台的载波频率与其他电台的载波频率间隔至少是10kHz，以避免干扰
				
			
		
	- 调频FM（frequency modulation）：载波信号的频率随着调制信号电平（振幅）的改变而调整
		
		- 载波信号的峰值振幅和相位保持不变，只当调制信号的振幅改变时，载波信号的频率相应地改变
			
		- FM通常使用用于FSK的压控振荡器实现。振荡器的频率根据输入电平（调制信号的振幅）变化
			
		- ![[50-模拟传输-FM.png]]
		- FM 带宽：FM 所需的总带宽可以由音频信号的带宽确定：$B_{FM} = 2(1+β)B$，此中 β 取决于调制技术的因子，一般为4
			
		- FM无线电的标准带宽分配：
			
			- 立体声广播里的音频信号（语音和音乐）的带宽接近于15kHz，每一个调频电台使用200kHz的带宽，此时β=4作为额外的防护频带
				
			- FM电台可以采用88MHz~108MHz之间的任何频率作为载波频率，但电台之间必须有至少200kHz的频率差，以保证电台之间的带宽不重叠
				
			- 为了提供更强的专用性，FCC（联邦通信委员会）规定在一个给定的区域内只能交替使用分配的波段，其他波段都被保留，以防止任何两个电台之间的相互干扰
				
			
		
	- 调相PM（phase modulation）：载波信号的相位是根据调制信号的电平（振幅）改变而调整
		
		- 载波信号的峰值振幅和频率都保持不变，但调制信号的振幅改变时，载波的相位也相应地变化
			
		- ![[50-模拟传输-PM.png]]
		- PM通常使用压控振荡器和导数发生器实现，振荡器的频率根据输入电平（调制信号的振幅）的导数变化
			
		- 在数学上证明 PM 和 FM 除一点外都相同:在 FM 中，载波频率的瞬时变化与调制信号的振幅成正比；在 PM 中，载波频率的瞬时变化与调制信号振幅的导数成正比
			
		- PM 带宽：PM 所需的总带宽可以由调制信号的带宽和最大振幅确定：$B_PM = 2(1+β)B$，β 在窄带中大约为1、宽带中大约为3

## 带宽利用

实际中链路都是有限带宽，为了达到特殊目的就需要合理进行带宽利用。
- 通过**复用**，可以将一些低带宽通道组合在一起形成一条高带宽通道，提高效率；
- 通过**扩频**，扩展通道带宽，达到保密、抗干扰的目的


### 复用 multiplexing

允许同时通过一条数据链路传输多个信号的一组技术。把来自源端的信号组合在一起获得带宽的效率，链路的有用贷款在各个源端之间划分

#### 复用技术的背景

- 只要连接两台设备的介质带宽比设备间传输所要求的带宽高时，该链路就可以被共享

- 如果一条链路的带宽比连接在它的上面的设备所需的带宽要大，那么多余的带宽就被浪费，而带宽是数据通信中最为昂贵的资源之一，所以一个高效的系统应该最大限度地使用所有设备的资源


#### 复用原理

n条线路共享一条链路的带宽。

- n 条输入线将其传输流量送到复用器 MUX（multiplexer），复用器将这些流量组成一个单独的传输流

- 在接收端，这个传输流量被分离器 DEMUX（demultiplexer）接收，并分解成原来几个独立的传输流再发送到对应线路上

- MUX 和 DEMUX 之间是链路 link，其中有 n 个通道（ 指在给定一对设备之间传送传输信号的链路的那部分）

#### 频分复用 FDM 

frequency-division multiplexing：**用于模拟信号**。在链路带宽（单位：Hz）大于要传输的信号的带宽之和时采用

- 每个发送设备生成的信号用于调制不同的载波频率，调制后的信号再被合并为一个可以通过链路传输的复合信号

- FDM是模拟复用技术，若在复用之前数字信号转换成模拟信号，就可以实现将源端的数字信号处理

- 原始信号能够重新恢复的条件：
	- 载波频率之间的频率差必须能够容纳调制信号的带宽，这些带宽的范围就是不同信号通过的通道
	- 通道之间由狭长的未使用的带宽作为防护频带（guard band）进行分隔，以防止信号重叠
	- 载波频率必须不会影响原始的数据频率

- 复用过程：每一个源端产生频率范围类似的信号，在复用器中这些类似信号被调制到不同载波频率上，然后将调制后的信号合成为一个复合信号通过具有足够带宽的介质链路发送出去

- 复用分离过程：分离器使用一系列滤波器来将复用信号分解为组成它的各个信号，每个信号随后被传送到解调器，解调器将它们与载波分离并发送给等待的接收端

- 模拟载波系统：电话公司为了最大限度地提高基础设施效率，而把低带宽线路的信号复用到更高带宽的线路上，由此许多交换和专用线路可以合并成更少但是容量更大的通道

- AT&T采用层次结构系统：由群、超群、主群、巨群组成

- 模拟层次结构 analog hierarchy：
	- 12 个语音通道复用到一个更高带宽的线路上构成一个群 group，一个群带宽为48kHz
	- 5 个群复用产生一个超群 supergroup，带宽240kHz
	- 10 个超群复用为一个主群 master group，必须有2.40MHz 带宽。由于超群之间需要防护频带，总带宽上升至2.52MHz
	- 6 个主群复用为一个巨群 jumbo group，必须有15.12MHz 带宽，由于主群之间的防护频带，总带宽上升至16.984MHz



- FDM应用：
	- AM/FM 广播：无线电使用空气作为传输介质，将一个特定波段分配给 AM 无线电广播（530~1700kHz，FM 广播为88~108MHz），所有无线电台共享这一波段
		- 每个 AM 电台都需要10kHz 带宽（FM 电台为200kHz），每个电台使用不同的载波频率，这需要对它的信号平移并复用
		- 空气中传播的信号是所有信号的组合，接收机会接受所有信号，但能够滤波想要接收的信号
		- 如果没有复用，就只会有一个 AM 电台可以向公共链路即空气广播信号
		- 实现：只要所有电台使用不同的载波频率向空气中传播，就可以实现多路复用
	- 电视广播：每一个电视频道的带宽是6MHz
	- 第一代移动电话：每一用户分配两个30kHz 的通道，一个用于发送语音另一个用于接收



#### 波分复用 WDM

wave-division multiplexing：用于模拟信号。用于具有高数据速率传输能力的光缆

- 概念原理与FDM相同，都是将不同频率的信号合并，但**WDM的频率很高**

- 过程：来自不同源端的*窄波段的光合并生成一种波段更宽的光*，在接受器端，信号通过信号分离器进行分离

- 实现：在复用器上将多个光源组成单一光信号，而在分离器上做相反的处理。光源的组合与分离由棱镜完成

- 应用：同步光纤网络SONET，其中多条光纤线路进行复用和信号分离

- 密集波分复用DWDM（dense WDM）：通过使相邻通道之间的频率更接近的办法来复用大量通道，从而获得非常高的效率


#### 时分复用 TDM
time-division multiplexing：**用于数字信号**。允许多个连接在时间上（FDM 是在空间上）共享一条高带宽链路，每个连接占用链路的一个时间段（称为时隙）

- TDM是数字复用技术，将不同源端的数字数据合并到一个时间共享的链路上。源端也可以产生模拟数据，只要被采样改变成数字数据即可

- TDM 是组合多个低速的通道为一个高速通道数据的复用技术，换言之，将一个高速通道拆分为多个低速通道以提高利用率的复用技术

- 两种方案：**同步时分复用**和**统计时分复用**
	- 同步时分复用synchronous TDM：
		- 时隙和帧：同步 TDM 中，每个输入连接的数据流被划分为多个单元，每个输入占用一个输入间隙。
			- ![[第6章-带宽利用-sync-TDM.png]]
			- 一个单元可以是一位、一个字符或一个数据块，每个输入单元成为一个输出单元的，占用一个输出时隙
			- ==每个输出单元的持续时间是输入单元持续时间的n分之一==。如果输入时隙是T秒，则输出时隙是T/n秒
			- 每个输入连接的全部数据单元组成一个帧。如果有n条连接线，则一帧分为n个时隙，一个时隙分配给一个单元。如果输入单元持续T秒，则每个时隙持续时间是T/n，每个帧持续时间是T。每个单元在复用之前的持续时间是复用后的n倍
			- ==输出的链路的数据速率必须是单个连接的数据速率的n倍，以保证数据流动==。
			- 时隙分组为多个帧，帧由多个时隙组成的一个完整的循环构成，每个时隙专用于一个发送设备。在具有n条输入线路的系统中，每个帧有n个时隙，分配每个时隙用于传送来自特定输入线路的数据
			
		- 交替interleaving：将TDM看作两个开关，一个位于复用一侧，另一个位于信号分离一侧。两个开关同步以相同的速度旋转，但是方向相反
			- 复用一侧，当开关在一个连接前打开时，==连接有机会向通路上发送一个单元==。这就是交替
			- 信号分离一侧，当开关在某个连接前打开时，==连接有机会从通路中接收一个单元==
			
		- 空时隙：同步TDM的频率不高。当某一源端没有数据发送时，输出帧中对应的时隙是空的。统计TDM可以通过除去帧中空时隙来提高效率
			
		- 数据速率管理：当**输入数据速率有差异**时，上述以相同速率的分析就需要做出改变。有三种策略：
			- ==多级复用==：当一条输入数据线的数据速率是其他一些输入数据线数据速率的整数倍时，采用多级复用技术将几条输入线复用以达到其他输入线的数据速率
			- ==多时隙分配==：多级复用的反向操作，不过对于高倍数据速率输入需要插入穿并行转换来使原输入线分成几个输入线，进而与其他线路匹配
			- ==脉冲填充==：源输入线的比特率不是其他每个输入线比特率的整数倍，此时需要选取输入线最高速率为主要速率，然后将所有低速率的输入线添加虚位，此即脉冲填充或位填充
			
		- 帧同步：如果复用器和分离器失去同步，则属于某一个通道的位可能会被错误的通道所接收
			- 因此，需要在每帧的开始增加一个或者多个**同步位**作为帧指示位framing bit
			- 帧指示位按照某种模式逐帧发生变化，使分离器与输入流同步，以准确地分离时隙。==一般每帧的同步信息由1位构成，0/1交替变化==
			
		- 数字信号服务：电话公司通过一种数字信号的层次结构实现TDM，又称数字层次结构digital hierarchy
			- 层次：
				- DS-0服务：64kbps的单一数字通道
				- DS-1服务：1.544Mbps（24×64kbps+8kbps开销）服务，可以用作单一的1.544Mbps传输服务，或作为24个64kbps通道的多路复用，或其他服务类型的组合形式
				- DS-2服务：6.312Mbps（96×64kbps+168kbps开销）服务，可以用作单一的6.312Mbps传输服务，或4个DS-1通道的多路复用，或96个DS-0通道，或其他
				- DS-3服务：44.376Mbps（672×64kbps+1.368Mbps开销）服务，单一、7个DS-2、28个DS-1、672个DS-0、或其他
				- DS-4服务：274.176Mbps（4032×64kbps+16.128Mbps开销）服务，、单一、6个DS-3、42个DS-2、168个DS-1、4032个DS-0、或其他
				
			- T线路（T lines）：为了实现DS-0、DS-1等服务，使用T线路，这些线路的容量与DS-1到DS-4的数据速率是精确匹配的（就是各级服务对DS-0的语音通道包含数）
				- T-1线路用于实现DS-1，T-2线路用于实现DS-2等等。DS-0实际上没有作为服务提供，但是被定义为用于参考的基础
				- 用于模拟传输的T线路：T线路是为数字数据、音频、视频设计的数字线路，模拟传输（电话连接）需要先对模拟信号采样然后使用TDM
				- T-1帧：DS-1有8kbps的开销，如何理解？
					- 用于T-1线路的帧通常是193位，分为24个9位的时隙，每帧附加1位用于同步。换言之，每个时隙包含来自每个通道的信号片段，24个片段在帧中交替排列
					- 如果一条T-1线路传送8000帧，则数据速率为1.544Mbps，其中有8000位同步位
				
			- E线路：欧洲使用的T线路，概念相同而容量不相同
			
		- 同步 TDM 的其他应用：第二代移动电话
		
	- 统计时分复用 statistical TDM：
		- 对于有些输入线没有数据发送导致效率不高的情况，统计时分复用**动态地分配时隙以提高带宽的利用率**，仅当输入线有发送数据，时隙才有意义并在输出帧中给予一个时隙。
		
		- 统计复用中，每个帧中时隙的个数小于输入线的条数。复用器循环顺序地检测每条输入线，如果输入线有数据发送，则对输入线分配一个时隙，否则跳过这条线检测下一条线
		
		- 寻址：同步TDM中，输出时隙全部由数据占用；统计TDM中，**输出时隙需要携带数据和目的地址**
			- 同步 TDM 中不需要寻址，作为输入和输出的地址之间的关系的同步的和指定的
			- 统计 TDM 中，由于输入和输出之间不存在指定或预定的时隙，它们之间没有固定关系，需要在每个时隙中包含接收方地址以表明将要传送的地方
		
		- 时隙大小：统计 TDM 中时隙携带数据和地址，为了传送效率，数据长度与地址长度之比应合理（数据长而地址短）
		
		- **没有同步位**：统计 TDM 处于帧级，不需要同步
		
		- **带宽：通常小于每个通道容量之和**。统计TDM按照每条通道负载的统计确定链路的容量，如果输入时隙平均百分之x即认为满了，那么链路的容量反映了这一情况，高峰时某些时隙需要等待



### 扩频 SS（spread spectrum）
也是把来自某些源端的信号组合在一起形成一个更宽的带宽，但**目的为了无线应用（wireless LAN）而设计**。

#### 目的
- 无线应用中，==所有站点都以空气（真空）为传输介质，共享该介质需要没有窃听者拦截或恶意者干扰==

#### 方法
- 扩频技术增加了冗余部分，扩展原始信号的频带满足各个站的需要。如果每个站要求的带宽是 B，扩频将带宽扩展到 $B_{ss}$，$B_{ss}>>B$。**扩大的带宽允许源端用有防护的封装将它的报文进行更安全的传输**

#### 原则

- 对每个站点需要分配的带宽显然要比它所需要的带宽更大
- 原来的带宽 B 扩大到 $B_{ss}$ 必须由一个与原来的信号无关的过程来做，即**信号由源端生成后，扩频过程才能发生**。
- 信号由源端生成后，扩频过程利用扩频代码并扩大带宽。扩频代码是伪随机二进制数据流。

#### 跳频扩频 FHSS

frequency hopping spread spectrum：用源信号调制 M 个不同的载波频率，在某一时刻使用信号调制1个载波频率，在下一时刻信号跳至另一个频率，最终使用 M 个频率。源信号扩展后占用的带宽是 $B_{FHSS}>>B$

- 过程：
	- 伪随机代码生成器 pseudorandom code generator（又称为伪随机噪声 pseudorandom noise，PN）对每个跳周期 $T_{h}$（hopping period）生成一个 k 位模式
	- 频率表使用这个模式查找频率作为这个跳周期的频率，再通过它发送到频率合成器
	- 频率合成器生成该频率的载波信号，同时源信号调制这个载波

![[第6章-带宽利用-FHSS.png]]
- 如图，模式是伪随机的。这个方案实现了扩频的目的：当有许多个k位组模式而跳周期是短的，那么发送方和接收方具有保密性。入侵者窃听传输信号，只能获得很少一部分，不知道扩频序列就不能适应下一跳变。而干扰者发送的噪声只会到达一个跳周期，而不是全部周期，所以抗干扰能力强

- 宽带共享：如果跳频数是 M，则可将 M 个通道复用为使用同一带宽 $B_{ss}$ 的一个通道。一个站点在每跳周期中只用一个频率，其他 M-1个站点使用 M-1个频率，如果使用合适的调制技术，如 FSK（MFSK），M 个不同站点可用同一带宽 Bss

- FDM 中，每个站点用带宽的1/M，但是固定分配；FHSS 中，每个站点占用带宽的1/M，但跳到跳改变分配 


#### 直接序列扩频 DSSS

direct sequence spread spectrum:也是扩大源信号的带宽

- 方法：每个数据位用扩展编码的 n 位代替。即每一位被编码的 n 个码片，此处码片的速率是数据比特率的 n倍

- 巴克序列 Barker sequence：n=11，假定源信号与码片生成器中的码片使用极性 NRZ 编码，例图 6.33 复用源信号和扩频信号的结果。扩频信号是源信号的 11 倍，扩频信号提供保密，若每个站点使用不同的编码，可以获得抗干扰能力
- ![[第6章-带宽利用-DSSS.png]]

- 宽带共享：
	- 如果使用一个扩频代码去扩频不能组合和分离的信号（来自不同的站），就不能共享带宽
	- 如果使用一个允许组合和分离的扩频信号的特殊类型的序列代码，则可以共享带宽

## 传输介质

### 背景知识

- 传输介质实际上位于物理层以下并直接由物理层控制，可以将其视作第0层
	
- 传输介质transmission medium广义的定义为能从源端传送信息到目的端的任何东西。数据通信中，传输介质通常是自由的空间、金属电缆或光纤等，信息通常是一种信号
	
- 计算机和其他电信设备用信号表示数据，这些信号以电磁能的形式在设备之间传输，电磁能通过传输介质传播
	
- 电磁能是电场和磁场相互震荡的组合形式，包括电力、无线电波、红外线、可见光、紫外线、X射线、伽马射线、宇宙射线。每一种都对应于电磁频谱electromagnetic spectrum的一部分。并非所有频谱都可以用于电子通信，可利用频谱的介质也只限于有限的几类


### 有向介质

指在设备之间提供通路的介质，沿着这类介质传输的信号，其传输方向和传播范围受介质的物理边界限制

- 双绞线 twisted-pair cable：有两根导线（铜线）构成，每一根都有自己的塑料绝缘层，二者绞在一起 
	
	- 线路中一条用于将信号发送到接收方，另一条仅用作接地参考点。接收方使用两条线路的电平之间的差值
		
	- 干扰（噪声）和串扰可能会影响两条线路并产生有害信号。如果两条导线是平行的，这些有害信号的影响在两条线路中就会不同，因为它们相对于噪声或者串扰所处的位置是不同的，这样会在接收方产生差值。而通过将两条线绞合在一起，可以保持平衡，接收方不会通过计算两者之间的差值接收到有害信号
		
	- 单位长度的**绞合数决定了电缆的质量**，绞合数越多意味着质量更高
		
	- 两类双绞线：
		
		- 非屏蔽双绞线UTP（unshielded twisted-pair）：
			
			- 分类：电子工业协会EIA制定了一个将非屏蔽双绞线根据质量分为七类的标准，第1类最低，第7类最高。每一种EIA分类适用于特定的用途
				
			- 连接器：RJ45（RJ表示注册插头），是一种有插槽的连接器，只能以一个方向插入
				
			
		- 屏蔽双绞线STP（shielded twisted-pair）：有一层金属薄片或者织成网状的包覆材料将每一对带有绝缘层的导体包裹起来，尽管这样可以通过防止噪声或串扰而提高电缆的质量，但是更加笨重昂贵，使用范围较小
			
		
	- 性能：对比频率和距离的衰减曲线
		
		- 双绞线允许通过的频率范围比较宽。以每英里的分贝数测量，随着频率的升高超过100kHz时，衰减数值会突然升高
			
		- 规格gauge：电线粗细的标准计量单位。规格数越大，直径越小
			
		
	- 应用：
		
		- 电话线路，提供语音和数据的通道
			
		- 电话公司使用DSL线路提供高数据速率连接，这种线路使用具有高带宽容量的非屏蔽双绞线
			
		- 局域网，如10Base-T和100Base-T，也用双绞线


- 同轴电缆coaxial cable：较双绞线，可以传输更高频率范围的信号，部分原因在于两种介质的构造有很大不同
	
	- 构造：同轴电缆是用一根位于中央的实心或多股绞合的核心金属丝导体，导体封装在绝缘护套中，然后封装在金属箔、金属网或者两者组合的外部导体中，外部金属包装既可以屏蔽噪声又可以作为第二导体构成回路，最后是绝缘层、塑料外套
		
	- 同轴电缆标准：按照无线电管理RG（radio government）等级进行分类。每一个RG号表示单独的一组物理规范，包括内部导体的电线规格、内部绝缘体的粗细和类型、屏蔽层的结构以及外部封套的尺寸和类型。每一种电缆适用于特定的功能
		
	- 同轴电缆连接器：最常见的是BNC连接器（Bayonet-Neil-Concelman），有三种常用类型：
		
		- BNC连接器：用于将电缆的一端连接到设备如电视机上
			
		- BNC T连接器：用于以太网，从主线路引出分支以连接计算机或其它设备
			
		- BNC终接器：用于电缆的末端以防止信号反射，接地线
			
		
	- 性能：同轴电缆有更高的带宽，但信号减弱很快，经常需要使用中继器
		
	- 应用：
		
		- 模拟电话网络，单个同轴电缆网络能够传送10000路语音信号。后来用于数字电话网络，单个同轴电缆能够以600Mbps速率传送数据
			
		- 有线电视网络，使用RG-50同轴电缆。后来光缆取代了大部分同轴电缆，只在网络边界、靠近消费者房屋的地方使用同轴电缆
			
		- 传统以太局域网中



- 光缆fiber-optic cable：由玻璃或者塑料构成，能够传输光信号
	
	- 光学原理：临界角是物质的一种特性，不同物质的临界角的值是不同的
		
		- 如果入射角angle of incidence小于临界角critical angle，光线会沿着较接近于表面的方向发生折射refract；
			
		- 如果入射角等于临界角，光线会沿着表面弯曲；
			
		- 如果反射角大于临界角，光线会发生反射reflect并再次在高密度物质中传输
			
		
	- 光线使用反射来引导光通过通道。玻璃芯或塑料芯外面环绕着低密度的玻璃或塑料的包层cladding，二者密度差值必须满足——通过纤芯传播的一束光必须完全被包层反射而不发生折射
		
	- 传播模式：
		
		- 多模：来自光源的多个光束沿着不同的路径通过纤芯，这些光束如何在光缆内部通过取决于纤芯的结构：
			
			- 多模阶跃折射率光纤multimode step-index fiber中，纤芯的密度从中心到边缘保持不变。光束到达纤芯与包层交界处之前，以直线形式通过等密度的纤芯，在交界处遇到低密度的包层而光束传输角度变化
				
			- 多模渐变折射率光纤multimode graded-index fiber，可以减少失真。其密度是不均匀的，在纤芯的中心处最高，从中心到边缘逐渐降低
				
			
		- 单模：使用阶跃折射率光纤并使用聚焦效果更好的光源，这样光束被限制在很小的角度范围，几乎接近于水平
			
			- 单模光纤single-mode fiber在生产时使用直径比多模光纤小得多且密度非常低的光纤维，低密度使得临界角几乎接近90°，以致光线几乎沿水平传播
				
			- 由此，不同光束的传播几乎相同，从而可以忽略延迟，所有的光束同时到达目的端，再重组为失真很小的信号
				
			
		
	- 光纤规格：通过纤芯的直径与光纤包层的直径的比率定义的
		
	- 光缆组成：外部封套由PVC或特氟隆制成，封套里面用能提高光缆强度的Kevlar纤维，接着一层塑料薄层用于缓冲光纤的受力，光纤位于光缆中心，由包层和纤芯构成
		
	- 光缆连接器：
		
		- 用户通道SC（subscriber channel）连接器：用于有线电视，采用推拉式固定方法
			
		- 直插式ST（straight-tip）连接器：用于将光缆连接到网络设备上，使用卡扣式固定方法，比SC更可靠
			
		- MT-RJ 连接器：与 RJ45规格相同 
			
		
	- 性能：光缆的衰减相对于波长的变化曲线较双绞线和同轴电缆的更平坦，因此只需要很少的中继器即可
		
	- 应用：
		
		- 用于主干网络，提供了很高的带宽
			
		- 有线电视公司结合使用光纤和同轴电缆，构建混合网络。光纤提供主干结构，同轴电缆提供到用户住所的连接
			
		- 局域网，100Base-FX网和1000Base-FX网（快速以太网）
			
		
	- 优缺点：
		
		- 优点：
			
			- 高带宽：目前数据速率受到的是信号生成和接收速率的限制而不是介质的限制
				
			- 信号衰减小：不需要再生的情况下可以传输50km
				
			- 无电磁干扰
				
			- 抗腐蚀材料：玻璃比铜抗腐蚀能力强
				
			- 重量轻
				
			- 不易被窃听
				
			
		- 缺点：
			
			- 安装/维护：需要专门技能
				
			- 单向性：光的传播是单向的，如果要双向通信，需要两根光纤
				
			- 成本：光缆和接口较昂贵


### 无向介质

unguided media：不使用物理导体传输电磁波。通常指无线通信，信号通过空气传播，能够被任何人接收，只要拥有接收信号的设备

- 无线通信wireless communication：占用的电磁频谱范围约在3kHz~900THz

- 传播途径：
	
	- 地表传播ground propagation：低于2MHz
		
		- 无线电波通过地球的大气层的最底层部分紧绕地表传播
			
		- 低频率信号通过发射天线沿着地球表面向各个方向发射
			
		- 传输距离取决于信号功率的大小，功率越强 ，传输距离越远
			
		
	- 天空传播sky propagation：2MHz~30MHz
		
		- 较高频率的无线电波向上传播到电离层（大气层之一，该层中粒子以离子形式存在），从电离层再反射回地球
			
		- 可以使用较低的输出功率而传输更远的距离
			
		
	- 视线传播line-of-sight propagation：30MHz以上
		
		- 非常高频率的信号沿着直线直接在天线之间传输
			
		- 天线必须是有向的，互相正对的，而且必须足够高或距离足够近，以免受地球曲率的影响
			
		- 由于无线电传输不能完全聚焦，因此很难处理



- 电磁频谱中，定义为无线电波和微波的部分被分成八个区域，称为**波段band**，每一个波段都受政府机构的管制
	
	- 波段从甚低频率VLF（very low frequency）到低频LF、中频MF、高频HF、甚高频VHF、超高频UHF、特高频SHF、极高频EHF（extremely high frequency）依次排列


- 分类：
	
	- 无线电波radio wave：频率范围为3kHz~1GHz的电磁波
		
		- 特点：
			
			- 大部分是全方向的。天线发射无线电波时，会向各个方向传播，意味着发射天线和接收天线不必对准。缺点在于一个天线发射的无线电波，容易受到另一只使用相同频率或波段的天线所发射的信号的干扰
				
			- 可以传输很长的距离，尤其是以天空模式传输的电波
				
			- 无线电波特别是中低频率的电波，可以穿透墙体，使得如AM收音机可以在建筑物内部接收信号
				
			- 无线电波的波段较窄，仅在1GHz以下，当其被划分为多个子波段时，子频带也很窄，导致数据通信中的数据速率很低
				
			- 几乎整个波段都受政府机构的管制，使用波段的任何部分都必须得到这些机构的许可
				
			
		- 全向天线omnidirectional antennas：向所有方向发送信号。根据波长、强度和传输目的的不同，可以有多种类型的天线
			
		- 应用：在多播（一个发送方多个接收方）很常见，如AM和FM收音机、电视、航海无线电、无绳电话
			
		
	- 微波microwave：频率范围为1~300GHz的电磁波
		
		- 特点：
			
			- 单向，优势在于一对对准的天线不受另一对天线的干扰。天线发射微波时它们可以聚集在很窄的范围内，因此发射天线和接收天线需要对准
				
			- 属于视线传播，安装天线的塔必须相互可见，距离过远就要增加高度。地球的曲率和障碍物不允许两座很低的天线塔使用微波进行通信，长距离通信时，通常需要中继站
				
			- 甚高频微波不能穿透墙体，接收机位于建筑物内部时无法接收信号
				
			- 微波波段相对较宽，接近于299GHz，所以能够分配更高带宽的子波段，获得更高的数据速率
				
			- 要使用波段中的某个部分，就必须得到政府机构的许可
				
			
		- 单向天线unidirectional antennas：在一个方向发射信号
			
			- 抛物面碟形天线parabolic dish antenna：基于抛物面的几何形状：平行于对称线的光线在曲面上以不同角度反射回来，使得所有光线相交于一个公共点（焦点）
				
				- 抛物面碟形天线的原理如同一个漏斗，接收到较宽范围的微波后，将它们导向一个公共点。与单点接收机相比，这种方式可以恢复更多的信号
					
				- 外发的传输：通过对准抛物面碟形天线的喇叭天线广播出去。微波遇到抛物面碟形天线时，会以与接收路径相反的方向偏转出去
					
				
			- 喇叭天线horn antenna：类似勺子
				
				- 外发的传输沿着主干（勺柄部位）广播，通过弯曲的头部以一系列范围较窄的平行波束的形式偏转出去
					
				- 接收到的传输由勺型的喇叭天线采用与抛物面碟形天线类似的方式汇聚起来，偏转入主干中
					
				
			
		- 应用：微波具有单向性，在发送方与接收方单播通信（一对一）时非常有用。如移动电话、卫星网络、无线局域网
			
		
	- 红外波infrared wave：频率范围为300GHz~400THz（波长1mm~770nm）
		
		- 特点：
			
			- 用于封闭区域的短距离通信，使用视线传播
				
			- 频率很高，不能穿透墙体。可以防止系统之间相互干扰
				
			- 在建筑外不能使用红外波，因为太阳射线中包含的红外波会造成干扰
				
			
		- 应用：红外波的高带宽特性能以高数据速率传输数字数据。红外数据联盟IrDA（Infrared Data Association）负责红外波的使用




## 交换

### 背景

- 网络：是连接设备的一组集合。而为了解决如何将多台设备连接起来实现一对一的通信，有两种解决方案：
	
- 一种解决方案是：
	
	- 每对设备之间建立点到点连接（网状拓扑），一台中心设备与其他所有设备之间建立点到点连接（星型拓扑）。但在应用于大规模网络时，该方法不切实际且浪费，链路的数量和长度需要太多的基础设施从而使成本效益很低，而多数链路再大多数时间内是空闲的
		
	- 其他拓扑结构如总线拓扑，由于设备之间距离和设备总数的增长会超出介质和设备的容量的原因也被排除
		
	
- 更好的方案是：交换switching
	
	- 交换网络由一系列互联的节点（称为交换机）构成，交换机能够在连接到交换机的两台或多台设备之间建立临时连接
		
	- 交换网络中，一些节点连接到端系统end system，另一些只是用于路由选择
		
	- 传统有三种交换方式：电路交换、分组交换、报文交换（前两种目前普遍使用，这种在一般通信中已经被淘汰，只是存在于网络应用中）
		
	- 由三种交换方式衍生出三种网络：
		
		- 电路交换网
			
		- 分组交换网：趋向是结合数据报网和虚电路网。网络根据数据报寻址的思想对第一个分组进行路由选择，然后为同一个源端和目的端的所有其余的分组建立一个虚电路网
			
			- 数据报网
				
			- 虚电路网：具有与电路交换网和数据报网的一些特性
				
			
		- 报文交换网：每个交换机储存整个报文，并转发到下一个交换机




### 电路交换网络

circuit-switched network：是由物理链路连接的一组交换机组成的。两个站点的连接是由一条或多条链路组成的专用路径来实现，每次连接仅使用每条链路上的一条专用通道，每条链路用 FDM 或 TDM 划分成 n 个通道

- 四个注意点：
	
	- **电路交换是在物理层**
		
	- 通信开始前，站点必须对通信时间所用的资源给以预留。这些资源包括通道（FDM的带宽和TDM的时隙）、交换机的缓冲器、交换机处理时间、交换机输入/输出端口，在整个数据传输期间必须保留直至拆除阶段
		
	- **两个站点之间数据传输不打包**（物理层传输信号）。源站点发送连续的数据流，目的站接收这些数据流，尽管可能会存在间隙
		
	- **数据传输期间没有寻址**，交换机基于它们占有频带 FDM 或时隙 TDM 发送数据。==只有在建立阶段，存在端到端的寻址==

- 三个阶段：
	
	- 建立阶段 setup phase：
		- ![[80-交换-circuit-switched.png]]
		
		- 双方（或电话会议中多方）通信之前，需要建立一条专用电路（链路中的通道的组合）
			
		- 当端系统需要连接到另一个端系统时，向其发送一个连接请求，这个请求必须被所有交换机接收。端系统通常通过专用线路连接到交换机，因此在交换机之间建立专用通道
			
		- 开始建立时，从一方端系统发送含有另一端地址的连接请求给交换机，交换机以此发现与另一交换机的专用通道，接着发送请求，如此反复直到到达目的端系统
			
		- 通道建立前，目的端系统必须反方向发送一个确认给源端系统，仅当源端系统接收到确认之后，连接才建立
			
		- 端到端系统的寻址要求建立两个端系统之间的连接。计算机的地址是由TDM网络管理者给定的，电话号码是由FDM网络管理者给定的
			
		
	- 数据传输data transfer：专用电路（通道）建立之后，双方可以传输数据
		
	- 拆除阶段 teardown phase：任何一方要撤销连接，就向每台交换机发送一个释放资源的信号
	- ![[80-交换-circuit-switched-network.png]]
		
	
- 效率：
	
	- 资源在整个连接期间都被占用，这些资源不能被其他连接所用，所以电路交换网的效率不及其他两类网络类型的效率
		
	- 电话网中，人们结束对话就终止通信。但是，计算机网络中，即使长时间没有通信，一台计算机也可能与另一台计算机相连，此时允许拥有专用资源的意思是不能用于其他连接
		
	
- 延迟：尽管效率低，**但延迟却是最小**。连接期间，资源被分配给该连接，每个交换机没有延迟，整个延迟时间取决于以下三个部分：
	
	- 建立连接需要的时间：
		- ![[80-交换-circuit-switched-delay.png]]
		
		- 源计算机请求的传播时间
			
		- 请求信号的传输时间
			
		- 目的计算机确认的传播时间
			
		- 确认信号的传输时间
			
		
	- 数据传输延迟：
		
		- 传播时间
			
		- 数据传输时间
			
		
	- 拆除电路所需时间
		
	
- 电话网中的电路交换技术：电话公司传统电话网物理层的交换技术采用电路交换方法，目前趋向转用其他交换技术


### 数据报网络

datagram network

![[80-交换-datagram-network.png]]

- 分组交换网络特点：
	
	- 经过分组交换网发送的报文，必须划分为一些固定长的分组或可变长的分组，分组长度由网络和控制协议决定
		
	- 分组交换中，对分组不存在资源分配，即链路没有预留的带宽以及对每个分组没有安排预定的处理时间
		
	- 资源按需分配，基于先来先服务的原则。当交换机接收到一个分组时，不管它是源端还是目的端，如果还有其他分组正在处理，该分组就必须等待。没有预留就可能会发生延迟


- 数据报网络中，每个分组独立处理，与其他分组无关。即使某个分组是多分组传输的一个部分，但网络处理它好像是单独存在的一样，这种方法分组称为数据报 datagram 
	
	- 数据报交换通常是在网络层。传统上称数据报网中的交换机为路由器，从源端发出的报文分组，经过不同的链路传送到目的端
		
	- 这种方法可能引起传输的数据报到达目的端时，由于分组之间延迟不同而失序，也可能由于缺乏资源而引起分组丢失。因此多数协议，在传送到应用层之前，由上层负责数据报重新排序或寻找丢失的数据报
		
	- 数据报网有时也称为无连接网络connectionless network，无连接意指交换机不保存有关连接状态的信息，不需要建立连接阶段和拆除阶段，每个分组不管源端和目的端由交换机同样处理


- 路由表
	
	- 数据报网中，每个交换机（或分组交换机）都有一个基于目的地址的路由表
		
	- 路由表是动态的，周期性地修改
		
	- 表中记录目的地址和相应的转发端口。目的地址包含在数据报网络的每个分组的头部中，当交换机接收到分组时，检查目的地址，查阅路由表找到对应的输出端口，通过它转发出去。目的地址在分组传送期间保持不变，与虚电路交换网中的地址不同


- 效率
	
	- 高于电路交换网。仅当有传输的分组时，才分配资源。如果源端发送一个分组，在另一个分组可发送前，存在很少时间的延迟；对于来自其他源端的分组在这段时间需要重新分配资源


- 延迟
	
	- 长于虚电路交换网。虽然没有建立阶段和拆除阶段，但每个分组再转发前交换机会有等待
		
	- 由于报文中所有分组不需要通过同一个交换机发送，因此报文的分组延迟不一致
		
	- 总延迟时间=传输时间+传播延迟+等待时间
	- ![[80-交换-delay-in-datagram.png]]


- 因特网中的数据报网
	
	- 因特网在网络层选用数据报方法进行交换，采用网络层规定的同一地址寻找从源端到目的端的路径



### 虚电路网络virtual-circuit network

- 结合电路交换网络和数据报网络的产物，具有二者的某些特点：
	
	- ![[80-交换-virtual-circuit.png]]
	- 数据传输阶段前后，同电路交换网络一样有建立阶段和拆除阶段
		
	- 同电路交换网络或数据报网络一样，按需要在建立阶段期间分配资源
		
	- 同数据报网络一样，数据被划分为组，每一组的头部含有地址，具有本地的权限（定义下一个交换机和传送分组的通道应该是什么），而不是端到端的权限
		
	- 同电路交换网络一样，所有分组沿着连接期间建立的路径传送
		
	- 虚电路网络通常在数据链路层实现。电路交换网络在物理层实现，数据报网络在网络层实现


- 网络的交换机执行从源端到目的端通信量交换。源端或目的端可以是计算机、分组交换机、网桥或连接网络的任何设备


- 编址：
	
	- 全局编址：源端或目的端需要有一个全局地址，该地址是一个广域网方位内或网际范围内唯一地址。虚电路网络中的全局地址仅用于建立虚电路标识符
		
	- 本地地址（虚电路标识符virtual circuit identifier,VCI）：一个VCI是一个仅在交换机范围内的小数字，由两个交换机之间的帧来使用
		
		- 当一个帧到达一个交换机时，它有一个VCI，当它离开时，有另一个VCI
			
		- 既然每个交换机都可以使用自己唯一的VCI集，因此VCI就不必很大



- 三个阶段：
	
	- 数据传输阶段：
		
		- 交换机为虚电路建立的表项，最见到有4列，包含输入端口、输入VCI、输出端口、输出VCI四个信息
			
		- 图8.12说明了一个数据经过一个交换机时的流程和VCI的变化，图8.13说明了一个帧如何从源端到达目的端以及整个过程中每个交换机都更改VCI并路由该帧
			
		- 数据传输阶段一直保持活动，直到源端向目的端发送完所有的帧。这个过程在源端和目的端之间建立虚电路，而不是实际电路
			
		
	- 建立连接阶段：源端和目的端使用各自的全局地址来帮助交换机为连接建立表项。建立阶段，一个交换机为虚电路生成一个入口
		
		- 连接请求：一个连接请求的帧从源端发送到目的端。细则见图8.14及之后的详解
			
			- 源端向交换机1发送一个建立连接帧
				
			- 交换机1接收这个建立请求帧，担当分组交换机的作用，为这个虚电路在表中建立一个表项并且填写输入端口1、输入VCI14、输出端口3，然后通过输出端口3向交换机2转发该帧
				
			- 交换机2接收这个建立请求帧，同交换机1一样完成表项的三列并发送至交换机3
				
			- 交换机3接收建立请求帧并填写三列表项，发向目的端
				
			- 目的端接收建立请求帧，如果准备好接收源端的帧，就分配一个VCI给从源端发来的帧。这个VCI让目的端知道帧是从特定源端发出的，而不是从其他源端发出的
				
			
		- 确认：确认帧逆向从目的端发送到源端，并完成路径上未填写的表项
			
			- 确认帧携带有全局源端地址和目的端地址
				
			- 源端使用最终交换机发送给源端的确认帧的输入VCI作为准备发送给目的端的数据帧的输出VCI
				
			
		
	- 连接拆除阶段：源端和目的端通知交换机删除对应的表项


- 效率：
	
	- 连接建立阶段虚电路网络要做资源预留，此时每个分组延迟都相同；或在数据传输阶段按需分配资源，此时各分组延迟可能不同
		
	- 虚电路网络最大优点在于资源都按需分配，源端可检测资源可利用的程度，而不必真实预留
		
	- 虚电路交换中，属于相同源端与目的端的所有分组都按同一路径传送；但如果资源按需分配，分组到达目的端可能有不同延迟


- 虚电路网络延迟：总延迟=传输时间+传播时间+建立阶段延迟（包括两个方向的传输和传播）+拆除阶段延迟
	- ![[80-交换-delay-in-virtual-circuit.png]]

- 广域网中的电路交换技术：18章中讨论用于广域网中的虚电路网络，如帧中继网和ATM网。虚电路技术非常适用于链路层


### 交换机结构

- 电路交换机结构
	
	- 空分交换机
		
		- 空分交换space-division switching，电路中的各条通路在空间上是相互分离的。最初用于模拟网络，目前被同时使用在模拟和数字网络中
			
		- 纵横制交换机crossbar switch：在栅格中将n个输入连接到m个输出，连接方法是在每个交叉点crosspoint使用微电子开关（晶体管）
			
			- 主要限制是需要的交叉点数量过于庞大
				
			- 统计表明，在任何时刻只有低于25%的交叉点处于工作状态，而其他交叉点都处于闲置状态
				
			
		- 多级交换机multistage switch：将多台纵横制交换机按多级（通常是3级）结构组合在一起
			
			- 单个纵横交换机中，任何连接仅有一行或一列（一条路径）是激活的，所以需要N×N个交叉点。如果交换机中允许多条路径，则可以降低交叉点数，中间级每一个交叉点可被第一级或第三级交叉点访问
				
			- 设计步骤：
				
				- 将 N 条输线分为组，每组 n 条输入线。对每组用一个 n×k 纵模交换机，其中 k 是中间级纵横交换机的个数。第一级有 $\frac{N}{n}$ 个纵横交换机，每个具有 $n×k$ 个交叉点 
					
				- 中间级，使用 k 个 $(\frac{N}{n})×(\frac{N}{n})$ 纵横交换机 
					
				- 第三级，使用 $\frac{N}{n}$ 个 $k×n$ 纵横交换机 
					
				- 总交叉点个数为$2kN+k(\frac{N}{n})^2$，远小于N2
					
				
			- 缺点：
				
				- 多级交换的思想是共享中间级纵横机的交叉点，如果资源有限，并且同一时刻所有用户都请求连接，那么共享会引起有效性的短缺
					
				- 高通信量时会引起阻塞 blocking 现象，指输入无法连接到输出的情形，因为此时两者之间没有可用路径，所有可用中间交换机都被占用了 
					
				- 大规模系统中，级数的增加能够迅速降低所需交叉点的数量，但随之产生阻塞的可能性增大
					
				
			- **Clos 准则**：在一个没有阻塞的交换机中，中间级交换机的个数必须大于等于2n-1，即 $k\ge2n-1$
				
				- 此时交叉点的个数仍少于单级交换机的个数
					
				- $n=(\frac{N}{2})^{\frac{1}{2}}$, $k>2n-1$, $总的交叉点个数>=4N[(2N)^{\frac{1}{2}}-1]$
					
				- 额外的交叉点是防止阻塞所需的，但使用Clos准则和最小交叉点个数的多级交换仍要求很大的交叉点个数
					
				
			
		
	- 时分交换机time-division switching：采用时分复用TDM在交换机内部来实现交换，最常用方法是时隙互换TSI(time-slot interchange)
		
		- 时隙互换：图 8.19 的 4 条输入线路连接到 4 条输出线路的系统
			- ![[80-交换-time-slot-interchange.png]]
			
			- 组合了TDM复用器、TDM分离器、TSI三个部件，TSI是由具有多个存储单元的随机访问器RAM构成的
				
			- 每个存储单元的大小与单个时隙的大小相同，存储单元的个数与输入端的个数相同，多数情况下输入端与输出端个数相同
				
			- RAM中存储的是顺序接收的时隙数据，随后时隙按照控制单元的决策发送出去
				
			
		
	- 时分交换与空分交换机组合：
		
		- 空分交换优势在于瞬态的，缺点在于其有效性，即拥塞可以忍受的情况是由交叉点数量决定的；时分交换优点在于不需要交叉点，缺点在于使用TSI时，对每个连接的处理会产生延迟，每个时隙必须存储在RAM中，然后被检索和传递
			
		- 二者结合以利用两者优点，可以在物理上（交叉点的个数）和时间上（延迟时间）进行优化，由此设计为时间-空间-时间TST(time-space-time)交换机
			
		- 图 8.20 经典 TST 交换机
			- ![[80-交换-time-space-time-switch.png]]
			
			- 将所有输入分成3组并连接到3台时隙交换机中。这样，平均延迟只是使用单一时隙交换机处理12个输入所产生延迟的1/3
				
			- 中间级是一台纵横制空分交换机，连接到TSI交换机组，使所有可能的输入/输出对之间建立连接
				
			- 最后一级是第一级的镜像



- 分组交换机结构
	
	- 输入端口input port：执行分组交换机的物理层和数据链路层功能
		
		- 将接收信号转换成位，将帧分解成分组，进行差错检测与纠错，准备由网络层发送分组，除物理层处理器和数据链路层处理器之外，在分组转向交换结构之前，输入端口有缓冲器（队列）保存分组
			
		- ![[80-交换-input-port.png]]
			
		
	- 输出端口output port：与输入端口成镜像，功能相同顺序相反
		
		- 首先对输出分组进行排队，然后将分组组装成帧，最后利用物理层功能将帧转换成信号在线路上发送
		- ![[80-交换-output-port.png]]
			
		
	- 路由处理器rounting processor：执行网络层的功能
		
		- 利用目的地址寻找下一跳的地址和输出端口号，通过它发送分组。这个动作称为路由表查询table lookup，因为路由处理器寻找路由表。最新的分组交换机中，为加速和方便该过程，将路由处理器的功能移到输入端口
			
		
	- 交换结构switching fabric：从输入队列将分组传送到输出队列是最难的任务，这一动作的速度影响输入/输出队列的长度和分组总传输延迟
		
		- 纵横交换机：如前所述
			
		- Banyan交换机：是一个多级交换，每一级有微交换并基于表示为二进制串的输出端口来发送分组
			
			- 对于n个输入和n个输出，将有log2(n)级，每级有n/2个微交换。第一级基于二进制串的最高位发送分组，第二级基于二进制串的次最高位发送分组，以此类推
				
			- 图 8.24 典例 8 个输入和 8 个输出的榕树交换机
			- ![[80-交换-banyan.png]]
				
			- 存在问题是即使两个分组不是前往相同的输出端口，也可能存在内部冲突。可以通过对目的端口对到达的分组进行排序来解决
				
			
		- Batcher-banyan交换机：设计了Batcher交换机放在banyan交换机之前，根据输入分组的最终目的对分组进行排序
			
			- 排序交换机采用硬件合并技术
			- ![[80-交换-batcher-banyan.png]]
				
			- 通常还有陷阱trap的硬件模块加在Batcher交换机于banyan交换机之间，陷阱模块防止重复的分组（具有相同输出目的地的分组）同时通过banyan交换机。在每个时间节拍，对每个目的地仅有一个分组；如果存在多于一个分组，它们就应该等待下一个节拍


## 使用电话网和有线电视网进行数据传输

### 电话网络

- 背景：电话网络使用电路交换技术。19世纪末电话网络起源，当时是简易普通传统电话系统POTS(plain old telephone system)，使用模拟信号传输语音的模拟系统。目前电话网络是一种数字和模拟共存的网络

- 主要组成：
	
	- 本地回路local loop：将用户电话机连接到最近本地局或本地中心局的双绞线。用于语音传送时，本地回路的带宽是4kHz
		
	- 干线trunk：处理局间通信的传输介质。一条干线通过多路复用通常可以处理成百上千个连接。传输时通过光纤和卫星链路实现的
		
	- 交换局switching office：
		
		- 为了避免在任何两个用户之间存在一条永久的物理链路，电话公司在交换局内安装交换机
			
		- 一台交换机可以连接多条本地回路或者干线，并且允许不同用户间建立连接



- LATA(local access and transport area)本地接入和传送区域：
	
	- LATA内部服务：LATA内部的公用电信公司common carrier提供的服务
		
		- 处理这些服务的运营商称为本地交换电信公司LEC(local exchange carrier)。1996电信法实施之前，内部服务授权给一个单独的运营商垄断式经营
			
		- 1996年之后，有两种类型的LEC：
			
			- 之前提供服务的运营商占有电缆铺设系统（本地回路），称为责任本地交换电信公司ILEC(incumbent local exchange carrier)
				
			- 提供服务的新运营商称为竞争本地交换电信公司CLEC(competitive local exchange carrier)
				
			
		- 为了避免增加新的电缆铺设费用，一致同意由ILEC继续提供主要服务，而CLEC提供LATA内部的其他服务，如移动电话、收费长途电话等
			
		- LATA内部通信由本地局和中继局处理。只使用一个交换局就能完成的呼叫是免费的，必须通过至少一个中继局的呼叫是收费的
			
		
	- LATA间的服务：由跨区交换电信公司IXC(interexchange carrier)处理，这些公司有时称为长途电话公司long-distance company，为不同LATA的两个客户之间提供通信服务
		
		- IXC是长途电话公司，它们提供包括电话服务在内的通用数据通信服务。通过IXC的电话呼叫通常被数字化处理，电信公司使用多种类型的网络提供这一服务
			
		
	- 服务接入点POP(Points of Presence)：提供电信公司之间的交互
		
		- 所有希望在LATA中提供LATA间服务的IXC，都必须在该LATA内有一个POP
			
		- 在LATA内部提供服务的LEC，必须提供连接以使每个用户都能访问到所有的POP
			
		- 图9.3典例
			
			- 当一个用户需要与另一个用户连接时，首先被连接到本地交换机
				
			- 然后直接连接到一个POP或者通过一台中继交换机连接到POP，这时呼叫从源LATA中的IXC的POP到达目的LATA中的同一IXC的POP
				
			- 呼叫将会通过IXC的长途电话局，并且经过IXC提供的网络进行传送



- 信令
	
	- 带内信令与带外信令：
		
		- 带内信令in-band signaling：信令和通话是同一电路。电路交换网在通信双方之间为了确定与终止路径必须有建立和拆除阶段，回忆早期接线员辅助完成的电话通信
			
		- 后来信令系统成为自动系统，如旋转拨号电话发送数字信号表示多位数字电话机上的每个数字。电话公司的交换机用该数字信号建立呼叫方与被呼叫方之间的连接，同时使用带内信令和带外信令out-of-signaling
			
		- 带内信令中，4-kHz语音通道也用于提供信令；带外信令中，部分语音通道用作信令，语音通道的带宽与信令通道的带宽是分离的
			
		
	- 信令系统随着电话网络发展时增加的功能需求：
		
		- 提供拨号音、振铃和忙音
			
		- 办公室电话号码转移
			
		- 维护和监控呼叫
			
		- 保留账单信息
			
		- 维护和监控电话网络设备
			
		- 提供其他功能，如呼叫方ID和语音信箱等
			
		
	- 复杂的任务需求使得信令成为单独的网络。即目前电话网络可以认为是信令网络和数据传输网络的结合，数据传输和信令任务在现代电话网中是分开的，一个网络用来执行数据传输，另一个用来执行信令任务
		
		- 数据传输网络：目前可携带多媒体信息的数据传输网络最重要部分是电路交换网，也可能是分组交换网。这种网络和其他本书讨论的网络一样遵照同一模型和协议
			
		- 信令网络：信令的特性更适合具有不同层次的分组交换网
			
			- 需要传送电话地址的信息封装在一个具有所有差错控制和寻址信息的分组中。典例图9.4表示了数据传输网络和信令网络的关系：
				
				- 用户电话或计算机被连接到信号点SP(signal point)，电话机与信号点之间链路是两个网络公用的
					
				- 信令网络利用信号传输端口STP(signal transfer port)接收或转发信令报文
					
				- 信令网络包括服务控制点SCP(service control point)控制所有的网络操作，其他系统如数据库中心可包括有关整个信令网络提供的存储信息
					
				
			- 7号信令系统SS7(Signaling System Seven)：信令系统所用协议
				
				- 物理层：MTP1报文传输部分层次1(message transfer part level 1)，使用物理层规范，如T-1线和DC0
					
				- 数据链路层：MTP2报文传输部分层次2，提供典型的数据链路层服务，如用分组头部的源和目的地址以及差错检测的CRC打包
					
				- 网络层：MTP3报文传输部分层次3，提供端到端连接，使用数据报方法进行交换
					
				- 传输层：SCCP信令连接控制点(signaling connection control point)，用于特殊业务，如800呼叫处理
					
				- 高层：有三个协议：
					
					- 电话用户端口协议TUP(telephone user port)，负责建立语音呼叫，它接收拨号数字和按指定路线传送呼叫
						
					- 事务处理能力应用端口协议TCAP(Transaction capabilities application port)，提供远程呼叫，让一台计算机上的应用程序调用另一台计算机的过程
						
					- ISDN用户端口协议ISUP(ISDN user port)，代替TUP提供类似ISDN网络的服务


- 电话网络提供的业务
	
	- 模拟业务analog service：
		
		- 模拟交换业务analog switched service：常见的拨号呼叫业务
			
			- 本地回路中的信号是模拟信号，带宽通常是0~4kHz
				
			- 有包月制收费，或按次计费
				
			- 800业务：一个用户（通常为组织机构）需要为其他用户（客户）提供免费连接，此时呼叫方是免费的，被呼叫方付费，组织机构使用这种服务鼓励客户拨打电话。费用比正常长途电话便宜一些
				
			- 广域电话业务WATS(wide-area telephone service)：与800业务相反。800业务是由组织机构付费的入站呼叫，WATS是由组织机构付费的出站呼叫。价格较低，可代替常规长途电话，费用依据呼叫次数确定。可以指定为出站呼叫到同一个州、到多个州、或者到整个国家并收取相应费用
				
			- 900业务：与800一样是入站呼叫，但其是由呼叫方付费且贵于常规长途电话，因为运营商收取两种费用：长途电话费和付给被呼叫方的费用
				
			
		- 模拟租用业务analog leased service：为客户提供一条租用线路的机会，永久性地连接到另一个客户。尽管仍然通过了电话网络中的交换机，但交换机总是闭合的，不需要拨号
			
		
	- 数字业务digital service：对噪声和其他形式的干扰的敏感度低于模拟业务
		
		- 交换式/56业务：模拟交换线路的数字版本，是一种交换式数字业务，允许数据速率最高到56kbps
			
			- 为了通过这一业务进行通信，通信双方必须先预订这种业务。使用正常电话业务的呼叫方不能使用该业务连接到一部电话或者计算机
				
			- 由于该业务中使用的线路是数字化的，所以用户不需要调制解调器来传输数字数据。但仍需要数字业务单元DSU(digital service unit)的设备
				
			
		- 数字数据业务DDS(digital data service)：模拟租用线路的数字版本，是一条最高数据速率为64kbps的数字租用线路



### 电话调制解调器

- 背景：
	
	- 传统电话线路可以传送频率范围是300~3300Hz的信号，提供给信号的带宽是3000Hz。整个频率范围对于传输语音，在不丢失可识别性的情况下，有一些干扰和失真可以接受。但数据信号需要更高等级的准确度以确保完整性，所以处于安全性考虑，频率范围的边缘不能用与数据通信，即信号带宽小于电缆带宽
		
	- 尽管目前一些电话线路能够处理比传统线路更高的带宽，但调制解调器的设计仍然是基于传统线路容量的
		
	- 调制解调器modem，源于信号调制器modulator（从二进制数据生成带通模拟信号）和信号解调器demodulator（将调制信号中恢复为二进制数据）。典例图9.7及上方解释


- 调制解调器标准：基于ITU-T发布的V系列标准
	
	- V.32和V.32bis：
		
		- V.32调制解调器结合使用调制和编码技术，称为格码调制trellis-coded modulation
			
			- 格式结构本质上是QAM加上一位冗余位。数据流划分为多个4位部分，传输的是五位组pentable而不是四位组quadbit，额外的位值从数据位值中计算得到，用于差错检测
				
			- 需要波特率为2400的32-QAM。每个五位组只有4位表示数据，最终速度为4×2400=9600bps
				
			
		- V.32bis调制解调器是第一个支持14400bps传输的ITU-T标准
			
			- 使用的是2400boud（2400×6=14400）的128-QAM传输（7位/波特，1位用于差错控制）
				
			- 提供的附加增强功能包含了传输速度自动降低和提高等特性，使得调制解调器能够依据线路或者信号的质量调高或者调低速度



	- V.34 bis：此调制解调器为28800的比特率提供了960点的星座图，为33600bps的比特率提供了1664的星座图
		
	- V.90：比特率为56000bps的V90调制解调器（称为56K调制解调器），只有一方使用数字信号（如通过因特网提供商）时才可用
		
		- 下载速率（数据流从因特网提供商到PC）最大是56kbps，上载速率（数据流从PC到因特网提供商）最大是33.6kbps，二者不对称。传统调制解调器的最大速率为33.6kbps，如香农公式确定，但56K modem没有违反香农容量定理，在下行方向没有量化误差，SNR率较高
			
		- 上传uploading中，模拟信号仍然在交换站进行采样。这个方向上，量化噪声引入信号降低了SNR，将上载的数据速率限制在33.6kbps
			
		- 下载downloading中，没有采样，信号不受量化噪声影响，不受香农容量定理限制，56kbps=每秒采样8000次×每个采样使用8位其中1位用于控制目的
			
		
	- V.92：此调制解调器能够自己调整速度。如果噪声允许，上传数据速率可以是48kbps，下载数据速率仍是56kbps
		
		- 有一些附加特性，如，若线路有呼叫等待服务，在有电话拨入时，调制解调器可以中断因特网连接




### - 数字用户线路

- 背景：传统调制解调器达到最高数据速率，数字用户线路DSL(digital subscriber line)技术产生并提供对因特网的告诉访问。目前DSL技术是现有本地回路上支持高速数字通信的最有前途技术之一

- ADSL(asymmertrical DSL)：非对称数字用户线路，其下行速率（比特率）高于上行速率。与56K modem的非对称性不同的是，ADSL专门针对住宅客户设计，将本地回路的可用带宽进行了不均衡的划分，不适合用于在两个传输方向都需要较高带宽的商业客户
	
	- 使用现有本地回路：双绞线本地回路能够处理的带宽实际上达到了1.1MHz，但是电话公司安装在本地交换局的滤波器将带宽限制到4kHz，这样可以允许对大量语音通道进行多路复用
		
	- 自适应技术：在设定某种数据速率之前，会运用该技术测试线路的状况和可用带宽。ADSL的数据速率不是固定的，它根据本地回路电缆的状况和类型而有所变化
		
	- 离散多音频技术DMT(discrete multitone technique)：ADSL的标准调制技术，将QAM和FDM结合在一起
		
		- 系统带宽的划分没有固定的方法，每个通道使用的带宽是4.312kHz。一般情况下，将1.104MHz的可用带宽划分为256个通道，每个通道使用的带宽是4.312kHz。典例图9.10：
			
			- 语音 保留通道0用于语音通信
				
			- 空闲 通道1~5不使用，作为语音和数据通信之间的间隙
				
			- 上行数据与控制 通道6~30用于上行数据传输和控制。1条控制24条数据传输，对于24个通道每个使用4kHz带宽用QAM调制，那么上行方向有24×4000×15=1.44Mbps的传输速率。但由于某些载波在噪声大处被删除，数据速率通常在500kbps以下，即有些通道不可用
				
			- 下行数据与控制 通道31~255用于下行数据传输和控制，1条控制其他数据传输，224条通道可获得224×4000×15=13.4Mbps的传输速率。由于某些载波在噪声大处被删除，数据速率通常在8Mbps以下
			
			
		
	- 客户端：ADSL调制解调器。图9.12
		
		- 本地回路连接到分离语音（低通滤波器）和数据通信（高通滤波器）的滤波器上。ADSL调制解调器使用DMT调制数据并创建上行和下行通道
			
		- 一般分配器由电信公司技术员安装在客户端，语音线可用在房间中已有的电话线，但数据线需要专业人员安装。使得ADSL成本高昂
			
		
	- 电话公司端：DSLAM(digital subscriber line access multiplexer)
		
		- 此端有数字用户线路接入复用器DSLAM(digital subscriber line access multiplexer)来取代ADSL调制解调器。它的功能与ADSL modem相似，还负责将发送到因特网（ISP服务器）的数据进行分组
			
		- 图9.13，逆向的客户端结构



- ADSL Lite：为了应对建筑物边界处安装分配器和新数据线高昂成本的新技术
	
	- 允许ADSL Lite modem直接插入电话机插座而连接计算机。分配工作由电话公司完成，ADSL-Lite使用8位（代替15位）调制256DMT的载波
		
	- 由于语音信号产生的错误可能与他们混合，所以有些载波可能不适用
		
	- 它提供最大下行数据速率为1.5Mbps、上行数据速率为512kbps


- HDSL(high-bit-rate digital subscriber line)高速数字用户线路：为了替代T-1线路（1.544Mbps）而设计
	
	- T-1线路使用AMI编码，由于AMI在高频频段对衰减非常敏感，所以T-1线路的长度限制为1km。如果要传输更长距离，就必须有中继器，意味着成本增加
		
	- HDSL使用2B1Q编码，对衰减的敏感程度很低。不使用中继器传输距离可达3.6km，数据速率可达2Mbps
		
	- HDSL使用双绞线实现全双工传输


- SDSL(symmertric digital subscriber line)对称数字用户线路：HDSL的一种双绞线型，提供全双工对称通信，对每个方向支持速率达768kbps
	
	- ADSL提供非对称通信，下行比特率远高于上行比特率。尽管这种特性满足大多住宅用户需求，但不适用于双向都需要大容量收发数据的商业应用
		
	- SDSL对称通信可以取代ADSL


- VDSL(very-high-bit-rate digital subscriber line)甚高速数字用户线路：与ADSL相似的替代实现技术，适于短距离（300~1800m）通信
	
	- 使用同轴电缆、光纤、双绞线，采用DMT调制
		
	- 对上行通信在距离3000英尺到10000英尺提供比特率的范围是25Mbps到55Mbps，下行比特率通常是3.2Mbps



### 有线电视网cable TV network

- 传统有线网络
	
	- 原来称公共天线电视CATV(community antenna TV)，是位于高山顶或者建筑物顶端的天线从电视台接收信号，通过同轴电缆将这些信号分配给社区公用。
		
	- 图9.14是传统有线电视网络示意图：
		
		- 有线电视局称为前端head end，从广播电台接收视频信号并将信号馈送给同轴电缆。由于信号会逐渐衰弱，所以网络的通路上安装放大器对信号进行放大，多达35个放大器
			
		- 另一端，分配器分离电缆信号，通过分接头和分接电缆与用户住宅建立连接
			
		- 传统有线电视系统使用同轴电缆进行端到端的连接，且通信是单向的，视频下行传输，由前端到用户住宅



- 光纤同轴电缆混合HFC网络
	
	- HFC(hybrid fiber-coaxial)光纤同轴电缆混合，从有线电视局到光纤节点（分线盒）之间的传输介质是光纤；从光纤节点穿过相邻住户并到达房屋内部的线路仍然使用同轴电缆
		
	- 地区有线前端RCH(regional cable head)通常可为400000个用户服务，RCH将信号馈送到分配集线器distribution hub，每一台集线器可以为40000个用户服务。分配集线器负责信号的调制和分配
		
	- 经过处理的信号再通过光纤馈送到光纤节点。光纤节点将模拟信号进行分配，将相同的信号发送到每一条同轴电缆
		
	- 每一条同轴电缆为1000个用户服务，光纤的使用可以将放大器的数量减少到8个或更少
		
	- HFC有线电视网络中的通信可以是双向的


### 有线电视网络用作数据传输

- 带宽：HFC系统中网络的最后一部分即光纤节点到用户住宅之间为同轴电缆，其带宽位于5~750MHz。电缆公司将其划分为三个波段：视频、下行数据和上行数据
	
	- 三个波段
		
		- 下行视频波段downstream video band：占用的频率范围是54~550MHz。由于每个电视频道占用6MHz，因此可以满足80多个频道的需要
			
		- 下行数据波段downstream data band：频率范围是550~750MHz，也是按6MHz划分通道
			
			- 调制：使用64-QAM或256-QAM调制技术进行调制
				
			- 数据速率：64-QAM调制技术中，每一个波特使用 6位，每个波特1位用于前向纠错，5位用于数据，而标准规定每个波特为1Hz。因此理论上，下行数据能以30Mbps（5bit/Hz×6MHz）的速率接收。该标准仅指定27Mbps，而由于有线调制解调器是通过10Base-T电缆连接到计算机上的，因此数据速率限制为10Mbps
				
			
		- 上行数据波段upstream data band：占用低端波段，频率范围是5~42MHz，也是按照6MHz划分通道
			
			- 调制：使用较低的频率，对噪声和干扰更为敏感，故QAM不适合，而使用QPSK调制技术进行调制
				
			- 数据速率：QPSK中，每波特使用2位，每波特1Hz，即理论上下行数据能以12Mbps(2bit/Hz×6MHz)的速率发送，但通常小于12Mbps


- 共享
	
	上行和下行波段可以由用户共享
	
	- 上行波段共享：分时共享，以解决大量用户在仅37MHz的上行数据带宽且6条6MHz的通道上发送数据
		
		- 这一波段使用FDM划分为多条通道，这些通道必须在具有相邻关系的用户间共享
			
		- 有线提供商以静态或者动态方式，将一条通道分配给一组用户。如果某个用户要发送数据，他需要与要访问这一通道的其他用户竞争，即用户必须等待直到通道可用
			
		
	- 下行波段共享：与上行方向类似，33个6MHz下行波段通道，但用户数不止33个，所以每条通道必须在一组用户间共享
		
		- 但是这里存在多播的情况。只要存在用户组中任何一个用户的数据，这些数据就会发送到该通道，数据会发送到该用户组中的每一个用户
			
		- 但是，由于每个用户都具有与提供商提供的地址进行匹配，如果地址匹配，数据就保留下来，否则被抛弃


- CM与CMTS：为了使用有线网络进行数据传输的两种关键设备
	
	- CM(cable modem)有线调制解调器：与ADSL调制解调器类似。连接在滤波器和PC之间，通道用作传输数据
		
	- CMTS(cable modem transmission system)有线调制解调器传输系统：由有线公司安装在分配集线器中，从因特网接收数据并传递给混合器，由混合器发送给用户。也接收来自用户的数据并将其上传到因特网


- 数据传输方案：DOCSIS(Data Over System Interface Specification)有线数据系统接口规范。定义了将数据从CMTS传输到CM所必须的全部协议
	
	- 上行通信：描述了CM必须遵循的步骤：
		
		- CM检查CMTS定期发送的特定分组的下行通道。该分组要求有任何一个新的CM声明自己位于一条特定的上行通道
			
		- CMTS向CM发送一个分组，规定分配给它的下行通道和上行通道
			
		- CM随后启动一个过程，称为测距ranging，以确定CM与CMTS之间的距离。这一过程是必需的，用于所有CM与CMTS之间的同步以获取上行通道分时共享时所使用的微时隙
			
		- CM向ISP发送一个分组，请求因特网地址
			
		- CM向CMTS随后交换一些分组以建立安全参数。公用网络需要使用这些参数
			
		- CM向CMTS发送它的唯一标识符
			
		- 上行通信在所分配的上行通道中开始，CM会竞争微时隙来发送数据
			
		
	- 下行通信：只有一个发送方，没有竞争
		
		- CMTS使用所分配的下行通道，发送包含接收CM地址的分组
