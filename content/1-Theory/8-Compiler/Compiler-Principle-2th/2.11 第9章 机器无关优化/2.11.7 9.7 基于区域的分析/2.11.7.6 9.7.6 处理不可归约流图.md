### 9.7.6　处理不可归约流图

如果预计到需要用编译器或其他程序处理软件进行处理的程序中经常会有不可归约流图，那么我们建议使用迭代算法，而不是基于层次结构的方法来解决数据流分析问题。但是，如果我们只准备偶尔处理一下不可归约流图，那么使用下面的“结点分割”技术就足够了。

首先尽可能依据自然循环构造区域。如果流图是不可归约的，我们会发现得到的流图包含环，但是没有回边，因此我们不能进一步对这个流图进行分析。在图9-53a中显示了一种典型的情形。这个流图和图9-45中的不可归约流图具有同样的结构，但是就像图9-53中的结点内的小结点所显示的，这个流图的结点可能实际上是一个复杂的区域。

我们选取一个具有多个前驱，且不是整个流图的头结点的区域R。如果R有k个前驱，那么建立k个对应于R的整个流图的拷贝，并将R的头结点的k个前驱分别连接到不同的拷贝。请记住，只有一个区域的头才可能具有区域之外的前驱。我们只是给出（而不准备证明）下面的结论：这样的结点分割的结果是，在寻找新的回边并构造出这些回边的区域之后，区域的个数至少减少了一。这样得到的流图可能还是不可归约的，但是我们可以不断交替进行两个步骤：结点分割步骤；寻找新自然循环并将其塌缩为单个结点的步骤。最终我们会得到单个区域，即流图已经被完全归约。

![451-2](../Images/image04759.jpeg)

图9-53　复制一个区域使得一个不可归约流图变成可归约的

例9.55　图9-53b中显示的结点分割把边R2b→R3变成了一个回边，因为现在R3支配R2b。因此这两个区域可以合二为一。得到的三个区域——R1、R2a及新产生的区域——组成了一个新的无环的流图，因此可能被组合到单个循环体区域中。这样我们就把整个流图归约为单个区域。一般来讲，可能还需要更多的分割处理，在最坏的情况下，最后得到的基本块的个数可能和原流图中基本块的个数成指数关系。

我们想要的是针对原流图的答案。因此我们还必须考虑对分割所得流图的数据流分析结果和这个答案之间的关系。我们可以考虑两个方法：

1）分割区域可能有益于优化过程，我们可以简单地修订这个流图使得只有某些基本块被复制。到达每个基本块副本的路径可能只是到达原基本块的路径的一个子集。因此相对于原基本块上的数据流值而言，在这些基本块副本上的数据流值可能包含更加精确的信息。比如，到达每个基本块副本的定值要少于到达原基本块的定值。

2）如果我们希望不是真的分割而是想保留原来的流图，那么在分析完分割所得的流图之后，我们可以查看每个被分割基本块B，以及它对应的拷贝集合B1，B2，…，Bk。我们可以计算IN［B］=IN［B1］∧IN［B2］∧…∧IN［Bk］，并且类似地计算OUT值。