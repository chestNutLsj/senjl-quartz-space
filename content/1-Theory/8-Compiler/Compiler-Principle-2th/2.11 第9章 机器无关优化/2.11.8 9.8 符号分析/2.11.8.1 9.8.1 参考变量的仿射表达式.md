### 9.8.1　参考变量的仿射表达式

因为我们不可能为所有计算得到的值创建一种简洁而又封闭的符号表达式，所以选择了一个抽象域，并且使用域中的最精确的表达式来近似表达计算结果。在此之前我们已经看到了这个策略的一个例子：常量传播。在常量传播中，我们的抽象域由所有常量值和特殊符号UNDEF及NAC组成。其中，UNDEF表示我们尚未决定该值是否为常量，而当已经发现一个变量不是常量的时候使用NAC。

我们在这里给出的符号化分析技术尽可能地把值表示成为参考变量的仿射表达式。如果一个关于变量v1，v2，…，vn的表达式可以被表示为c0+c1v1+…+cnvn，那么这个表达式就是仿射的，其中c0，c1，…，cn都是常量。这样的表达式也被非正式地称为线性表达式。严格地讲，只有当c0=0的时候，仿射表达式才是线性的。我们对仿射表达式感兴趣的原因是循环中的数组下标经常可以表示成仿射表达式——这些信息可用于优化和并行化处理。在第11章中，我们将更详细地讨论这个主题。

归纳变量

一个仿射表达式不一定只能使用程序变量作为参考变量，它也可以使用一个循环的迭代次数作为参考变量。如果一个变量在某个程序点上的值能够被表示为c1i+c0，其中i是包含该程序点的最内层循环的迭代次数，那么这个变量称为归纳变量（induction variable）。

例9.57　考虑代码片断

![453-1](../Images/image04761.jpeg)

假设我们为该循环引入一个变量i来表示已执行的迭代次数。在循环第一次迭代时，i的值是0，第二次迭代的时候i的值是1，以此类推。我们可以把变量m表示成为i的一个仿射表达式，也就是m=i+10。变量x，也就是3m，在循环的连续迭代中的取值是30，33，…，57。因此x具有仿射表达式x=30+3i。我们说m和x都是这个循环的归纳变量。

把变量表示成为循环次数的仿射表达式使得我们可以直接计算该变量在各次迭代中的值，而且能够实现多种代码转换。一个归纳变量在循环的各次迭代中所取的值可以通过加法运算，而不是乘法运算计算得到。这个转换称为“强度消减”。它已经在8.7节和9.1节中介绍过了。比如，我们可以从例9.57的循环中消除乘法运算x=m*3，只要把程序改写为：

![453-2](../Images/image04762.jpeg)

另外，请注意在该循环中被赋予0值的内存位置，即&A+30，&A+33，…，&A+57，也都是循环迭代次数的仿射表达式。实际上，这些整数值是该循环中唯一需要进行计算的值；我们只需要保留m或x中的一个。上面的代码可以直接替换为下面的代码：

![453-3](../Images/image04763.jpeg)

除了加快计算速度，符号化分析对于实现并行化也是有用的。当循环中的数组下标是循环迭代次数的仿射表达式时，我们可以考虑不同迭代中的数据访问的关系。比如，我们可以指出在每次迭代中被写入的内存位置是不同的，因此循环的全部迭代可以在不同的处理器上并行执行。这样的信息在第10章和第11章中被用来从顺序程序中抽取并行性。

其他参考变量

如果一个变量不是我们已选取的参考变量的线性函数，我们还可以选择把它的值当作将来进行的运算的参考变量。比如，考虑下面的代码片段：

![454-1](../Images/image04764.jpeg)

虽然在上面的函数调用之后a的值本身不能被表示成任何参考变量的线性函数，但它仍可以被用作后继语句的参考变量。比如，使用a作为参考变量，我们就可以发现在程序的结尾处c比b大1。

例9.58　本节中多次使用的例子是基于图9-55中显示的源代码的。其中的内层循环和外层循环是很容易理解的，因为除了在for循环的头部，f和g的值都没有被改变。因此有可能把f和g替代为分别对外层和内层循环的迭代次数进行计数的参考变量i和j。也就是说，我们可以令f=i+99和g=j+9，然后把f和g完全替换掉。在翻译成中间代码时，我们可以利用每个循环至少会迭代一次的信息，把对i≤100和j≤10的测试推迟到循环的尾部进行。在图9-55的代码中引入i和j，并把for循环当作repeat循环处理之后，就可以得到如图9-56中显示的流图。

![454-2](../Images/image04765.jpeg)

图9-55　例9.58的源代码

![454-3](../Images/image04766.jpeg)

图9-56　例9.58的流图和它的区域层次结构

可以发现，a、b、c和d都是归纳变量。在代码的每一行上赋给这些变量的值的序列被显示在图9-57中。我们将看到，我们可以找出用参考变量i和j表示的这些变量的仿射表达式。它们是，在第4行的a=i，第7行的d=10i+j-1和第8行的c=j。

![455-1](../Images/image04767.jpeg)

图9-57　例9.58中的各个程序点上看到的值的序列