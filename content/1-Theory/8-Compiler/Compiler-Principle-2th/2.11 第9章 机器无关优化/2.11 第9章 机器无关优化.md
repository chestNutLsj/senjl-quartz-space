   

# 第9章　机器无关优化

如果我们简单地把每个高级语言结构独立地翻译成为机器代码，那么会带来相当大的运行时刻的开销。本章讨论如何消除这样的低效率因素。在目标代码中消除不必要的指令，或者把一个指令序列替换为一个完成同样功能的较快的指令序列，通常被称为“代码改进”或者“代码优化”。

局部代码优化（在一个基本块内改进代码）的相关知识已经在8.5节介绍过了。本章将处理全局代码优化问题。在全局优化中，代码的改进将考虑在多个基本块内发生的事情。我们将在9.1节中讨论一些主要的代码改进机会。

大部分全局优化是基于数据流分析（data-flow analyse）技术实现的。数据流分析技术是一组用以收集程序相关信息的算法。所有数据流分析的结果都具有相同的形式：对于程序中的每个指令，它们描述了该指令每次执行时必然成立的一些性质。不同性质的分析方法各不相同。比如，对于常量传播分析而言，要判断在程序的每个点上，程序使用的各个变量是否在该点上具有唯一的常量值。比如，这个信息可以用于把变量引用替换为常量值。另一个例子是，活跃性分析确定在程序的每个点上，在某个变量中存放的值是否一定会在被读取之前被覆盖掉。如果是，我们就不需要在寄存器或内存位置上保留这个值。

我们将在9.2节介绍数据流分析技术。其中还包括几个重要的例子，说明我们如何使用在全局范围内收集到的信息来改进代码。9.3节将介绍一个数据流框架的总体思想，9.2节中的数据流分析技术是这个框架的特例。我们实际上可以使用同一个算法来解决这些数据流分析的实例。我们还能够度量这些算法的性能，并且证明它们对所有分析技术的实例而言都是正确的。9.4节是总体框架的一个例子，它的分析功能比前面的例子更强大。然后，我们将在9.5节中考虑一个被称为“部分冗余消除”的功能强大的技术。这个技术可用于优化程序中各个表达式求值的位置。这个问题的解决方案由不同的数据流分析问题的解决方案通过组合而得到。

在9.6节，我们将讨论程序中循环的发现和分析。对循环的识别引出了另一个用来解决数据流问题的算法族。这些算法基于一个结构良好的（即可归约的）程序中的循环的层次结构。这个处理数据流分析的方法将在9.7节中讨论。最后，在9.8节中将使用层次化分析来消除归纳变量（归纳变量本质上就是用来对循环的迭代次数进行计数的变量）。这种代码改进是我们能够对那些由常用程序设计语言书写的程序所做的最重要的改进之一。