### 9.5.4　表达式的预期执行

对于被插入的表达式还有一个约束，即保证优化后的程序不会执行额外的运算。一个表达式的各个拷贝所放置的程序点必须预期执行（anticipated）此表达式。如果从程序点p出发的所有路径最终都会计算表达式b+c的值，并且b和c在那时的值就是它们在点p上的值，那么我们说一个表达式b+c在程序点p上被预期执行。

现在让我们研究一下在一个无环路径B1→B2→…→Bn中消除部分冗余时应该做些什么。假设表达式e仅仅在B1和Bn中求值，并且e的运算分量没有在这条路径的基本块中被重新定值。假设有一些边和上面的路径交汇，也有一些边从这条路径离开。我们看到，e在基本块Bi的入口处没有被预期执行当且仅当存在一个从Bj（i≤j<n）发出的边，它通向一条不使用e[^12]的值的执行路径。因此，对执行的预期限制了一个表达式最前可以被插入到哪里。

我们就可以创建一个包含了边Bi-1→Bi的满足下面条件的割集。如果e在Bi的入口处可用或者被预期执行，这个割集就使得e在Bn中冗余。如果e在Bi的入口处被预期执行却不可用，我们必须在这条进入Bi的边上放一个e的拷贝。

我们可以选择放置表达式拷贝的位置，因为流图中通常有多个割集满足所有要求。在上面的讨论中，表达式的计算在进入我们所关心的路径的边上引入。这样做可以在不引入冗余计算的情况下使得表达式的计算尽量靠近对表达式值的使用。请注意，这些被引入的运算本身可能因为程序中同一个表达式的其他实例而体现出部分冗余性。这种部分冗余性可以通过进一步上移计算过程而消除。

总结一下，对表达式的预期执行限制了一个表达式可以被放置得有多靠前。不能把它放置得太靠前，以至于放置它的地方还没有预期执行它。一个表达式被放置得越靠前，能够删除的冗余性就越多。在能够消除同样的冗余性的各个解中，最后一个计算该表达式的位置可以使存放该表达式的寄存器的生命周期最小化。