## 9.5　部分冗余消除

在本节中，我们详细考虑如何尽量减少表达式求值的次数。也就是说，我们希望考虑一个流图中所有可能的执行顺序并检查x+y这样的表达式被求值的次数。通过移动各个对x+y求值的位置，并在必要时把求值结果保存在临时变量中，我们常常可以在很多执行路径中减少这个表达式被求值的次数，并保证不增加任何路径中的求值次数。请注意，在流图中x+y被求值的位置可能增多，但是相对来说这一点并不重要，只要对表达式x+y求值的次数被减少就行了。

应用本节开发的代码转换可以提高所生成的代码的性能。这是因为，正如我们即将看到的，在改进后的代码中，只有在绝对必要时才会进行一次运算。每个优化编译器都或多或少地实现了本节中描述的转换，虽然有些编译器使用的算法没有本节中的算法那么“激进”。但是，还有另一个动机促使我们来讨论这个问题。在流图中寻找（一个或多个）适当的位置来对各个表达式求值需要进行四种不同的数据流分析。因此，对“部分冗余消除”（即尽量减少表达式求值次数的技术）的研究可以帮助我们理解数据流分析技术在编译器中所扮演的角色。

程序中的冗余以多种形式存在。如9.1.4节所讨论的，它可能以公共子表达式的形式存在，即对表达式的多次求值产生同样的结果。它也可能以循环不变表达式的方式存在，这个表达式在循环的每次迭代中都得到相同的值。冗余也可能是部分性的，即只能在部分路径而不是全部路径中找到这个冗余。公共子表达式和循环不变表达式可以被看作是部分冗余的特例。因此可以设计一个部分冗余消除算法来消除不同种类的冗余。

接下来，我们首先讨论冗余的不同形式，以便对这个问题有直观的理解。然后再描述一般性的冗余消除问题，并在最后给出解决问题的算法。这个算法很有意思，因为它涉及多种数据流问题的求解。这些问题中既有前向问题，也有逆向问题。