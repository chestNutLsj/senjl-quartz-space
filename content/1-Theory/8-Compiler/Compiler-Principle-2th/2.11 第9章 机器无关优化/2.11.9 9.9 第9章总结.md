## 9.9　第9章总结

- 全局公共子表达式：一个重要的优化方法是寻找同一个表达式在两个不同基本块中的计算过程。如果一个在另一个前面，我们可以把第一次计算该表达式时得到的结果存放起来，并在再次计算该表达式时使用这个结果。
- 复制传播：一个复制语句u=v把一个变量v赋值给另一个变量u。在有些情况下，我们可以把所有对u的使用替换为对v的使用，从而消除这个赋值语句以及变量u。
- 代码移动：另一种优化方法是把一个计算过程移动到它所在的循环之外。只有当循环的每次迭代中这个计算过程都生成同样的值，这种改变才是正确的。
- 归纳变量：很多循环都有归纳变量。这些变量在循环执行时的不同迭代中的取值是一个线性序列。有些归纳变量仅仅用于对迭代进行计数，它们经常可以被消除，从而降低了循环的一次迭代所需要的时间。
- 数据流分析：一个数据流分析模式在程序的每个点上都定义了一个值。程序的各个语句都有相关联的传递函数。这些函数给出了一个语句之前和之后的数据流值之间的关系。具有多个前驱的语句的值是它的各个前驱的值的组合。这个组合通过交汇（或者说汇流）函数计算得到。
- 基本块的数据流分析：因为数据流值在一个基本块内的传播过程通常很简单，所以数据流方程通常给每个基本块设置两个值，称为IN值和OUT值。这两个值分别表示该基本块在开始处和结尾处的数据流值。把基本块中各个语句的传递函数组合起来就可以得到代表整个基本块的传递函数。
- 到达定值：到达定值数据流框架的数据流值是程序中的语句的集合。这些语句给一个或者多个变量定值。如果一个变量肯定在一个基本块内被重新定值，那么该基本块的传递函数杀死了对这个变量的定值，同时它还加入（“生成”）了在该模块中发生的对变量的定值。只要一个定值到达某个点的任意一个前驱，它就到达了该点，因此交汇运算是并集运算。
- 活跃变量：另一个重要的数据流框架计算了在各个程序点上活跃的（将在重新定值之前被使用的）变量。这个框架和到达定值框架类似，但是传递函数是逆向传递数据流值的。一个变量在某个基本块的开始处活跃的条件是，要么在该基本块中它在定值之前就被使用，要么该基本块中没有对它重新定值且它在该基本块结尾处活跃。
- 可用表达式：为了寻找全局公共子表达式，我们要确定各个程序点上的可用表达式。所谓可用表达式就是之前已经计算过，且在最后一次计算之后它的运算分量都没有被重新定值的表达式。这个问题的数据流框架和到达定值框架类似，但是其交汇运算是交集运算，而不是并集运算。
- 数据流问题的抽象：常见的数据流问题，比如前面提到过的那些，都可以用一个通用的数学结构表达。数据流值是一个半格的成员，这个半格的交汇运算就是数据流问题的交汇（汇流）函数。传递函数把半格元素映射到半格元素。要求传递函数的集合必须对于组合运算封闭，并且包含单元函数。
- 单调框架：每个半格都有一个≤关系a≤b当且仅当a∧b=a。单调框架具有以下性质：每个传递函数都保持了≤关系。也就是说，对于任意的格元素a和b以及传递函数f，a≤b蕴含了f（a）≤f（b）。
- 可分配框架：这种框架满足下面的条件：对于所有的格元素a和b以及传递函数f，f（a∧b）=f（a）∧f（b）。可以证明可分配框架的条件蕴含了单调框架的条件。
- 抽象框架的迭代解法：所有的单调数据流框架可以通过一个迭代算法来解决。在这个解法中，首先（按照不同的框架）适当地初始化各个基本块的IN和OUT值，然后应用传递函数和交汇运算不断地计算这些变量的新值。这个解法总是安全的（即按照它的解对程序进行优化不会改变程序所做的计算）。但是只有当框架是可分配的时，这个解才一定是可能的解中最好的。
- 常量传播框架：虽然诸如到达定值这类的基本框架都是可分配的，但存在一些单调但不可分配的框架。这类框架中的一个例子是关于常量传播的。在常量传播框架使用的半格中，格元素是从程序变量到常量以及两个特殊值的映射。这两个特殊值分别代表“无信息”和“一定不是常量”。
- 部分冗余消除：很多有用的优化，比如代码移动和全局公共子表达式消除，可以被扩展为同一个问题。该问题称为部分冗余消除。如果在某个点上需要计算一个表达式，但是这个表达式只在到达这个点的部分路径上可用，那么我们可以只在该表达式不可用的路径上进行计算。正确地应用这个想法要求解决四个不同的数据流问题，并做一些其他的操作。
- 支配结点：如果在一个流图中所有到达某结点的路径都必须经过另一个结点，那么后一个结点就支配前一个结点。一个真支配结点是不同于被支配结点的支配结点。除了入口结点，每个结点都有一个直接支配结点——被该结点的所有其他真支配结点所支配的真支配结点。
- 流图的深度优先排序：如果我们从一个流图的入口结点开始对它进行深度优先搜索，我们会得到一个深度优先生成树。结点的深度优先排序是这棵树的后序遍历次序的逆序。
- 边的分类：当我们构造一个深度优先生成树之后，相应流图的全部边可以分成三大类：前进边（即从祖先结点到真后代结点的边）、后退边（即从后代结点到祖先结点的边）和交叉边（其他）。生成树的一个重要性质是所有的交叉边都是从树的右边到达左边。另一个重要性质是在这些边中，如果按照深度优先排序（即后序次序的逆序），只有后退边的头比它的尾的排序更靠前。
- 回边：回边就是其头结点支配尾结点的边。不管选择流图的哪一棵深度优先生成树，每条回边都是一条后退边。
- 可归约流图：如果不管选择哪个深度优先生成树，该树的每个后退边都是一条回边，那么这个流图就是可归约的。绝大部分流图都是可归约的，控制流语句都是通常的循环和分支语句的程序的流图一定是可归约的。
- 自然循环：一个自然循环是一个结点的集合。集合中有一个头结点，它支配了该集合中的所有其他结点，并且至少有一条回边进入这个头结点。给定任意的回边，我们可以构造出它的自然循环。循环中包括回边的头结点，以及所有不经过头结点就能够到达此回边的尾结点的其他结点。两个具有不同头结点的自然循环要么互不相交，要么一个循环完全包含在另一个循环里面。这个性质使得我们可以讨论嵌套循环的层次结构，前提是“循环”指的是自然循环。
- 深度优先排序提高了迭代算法的效率：如果沿着无环路径传播信息足以得到正确结果，即环路不会增加信息，那么相应的迭代算法只需要很少几次迭代就可以得到正确结果。如果我们按照深度优先顺序访问结点，那么任何向前传递信息的数据流框架（比如到达定值）都可以在确定次数内收敛。收敛次数不大于所有无环路径中的后退边的最大个数加上2。如果我们用深度优先顺序的逆序（即后序次序）访问结点，上面的结论对于逆向传播的框架（比如活跃变量）也成立。
- 区域：区域是一个结点和边的集合。区域中有一个头结点h支配了其中的所有结点。除了h之外，区域中所有结点的前驱必须也在此区域中。区域的边集包含了区域中的任意两个结点之间的边，但是可能不包含某些或所有到达头结点的边。
- 区域和可归约流图：可归约流图可以被扫描分析成为一个由区域组成的层次结构。这些区域要么是循环区域，要么是循环体区域。循环区域包含了所有进入头结点的边，而循环体区域不包含到达头结点的边。
- 基于区域的数据流分析：不同于迭代方法的另一种数据流分析方法是沿着区域层次结构向上然后再向下扫描，计算从各个区域的头到达该区域中各个结点的传递函数。
- 基于区域的归纳变量检测：基于区域的分析技术的重要应用之一是用以寻找归纳变量的数据流框架。该框架试图找出循环区域中每个满足下面条件的变量的公式。这些变量的值可表示为循环迭代次数的仿射（线性）函数。