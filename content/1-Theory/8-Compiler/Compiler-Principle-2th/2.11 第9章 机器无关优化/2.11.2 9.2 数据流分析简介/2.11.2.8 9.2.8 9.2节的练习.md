### 9.2.8　9.2节的练习

练习9.2.1：对图9-10中的流图（见9.1节的练习），计算下列值：

1）每个基本块的gen和kill集合。

2）每个基本块的IN和OUT集合。

练习9.2.2：对图9-10的流图，计算可用表达式问题中的e_gen、e_kill、IN和OUT集合。

练习9.2.3：对图9-10的流图，计算活跃变量分析中的def、use、IN和OUT集合。

！练习9.2.4[^7]：假设V是复数的集合。下面的哪个运算可以被用作V上的一个半格结构的交汇运算？

1）加法：（a+ib）∧（c+id）=（a+c）+i（b+d）

2）乘法：（a+ib）∧（c+id）=（ac-bd）+i（ad+bc）

3）按分量求最小：（a+ib）∧（c+id）=min（a，c）+i min（b，d）

4）按分量求最大：（a+ib）∧（c+id）=max（a，c）+i max（b，d）

！练习9.2.5：我们曾经说过，如果一个基本块B由n个语句组成，并且第i个语句的gen集合和kill集合分别是geni和killi，那么基本块B的传递函数的gen集合genB和kill集合killB可以由下面的公式给出：

killB=kill1∪kill2∪…∪killn

genB=genn∪（genn-1-killn）∪（genn-2-killn-1-killn）∪

…∪（gen1-kill2-kill3-…-killn）

请通过对n的归纳来证明这个说法。

！练习9.2.6：请通过对算法9.11中第（4）到第（6）行的for循环的迭代次数的归纳，证明IN和OUT的值都不会缩小。也就是说，一但某个定值在某次循环的时候被放到其中的一个集合中，它决不会在以后的某次循环中消失。

！练习9.2.7：证明算法9.11的正确性，也就是证明：

1）如果定值d被放到IN［B］或OUT［B］中，那么相应地必然有一条从d到基本块B的开始处或结尾处的路径。在这条路径中，由d定值的变量不会被重新定值。

2）如果定值d最后没有被放到IN［B］或OUT［B］中，那么相应地必然没有从d到基本块B的开始处或结尾处的路径。在这条路径中，由d定值的变量不会被重新定值。

！练习9.2.8：证明有关算法9.14的下列性质：

1）各个IN和OUT的值不会缩小。

2）如果变量x被放到IN［B］或OUT［B］中，那么相应地有一条从基本块B的开始处或结尾处出发的路径，在这条路径上x可能被使用。

3）如果变量x没有被放到IN［B］或OUT［B］中，那么相应地没有从基本块B的开始处或结尾处出发的路径，使得x在这条路径上被使用。

为什么可用表达式算法是正确的

我们需要解释一下为什么下面的结论成立，即在一开始的时候把入口基本块之外的其他所有基本块的OUT值都设置为U（即所有表达式的集合），最终仍可以得到这些数据流方程的保守解。也就是说，找到的可用表达式确实都是可用的。第一，因为在这个数据流模式中的交汇运算是交集运算，任何发现x+y在某个程序点上不可用的理由都会在流图中沿着所有可能的路径向前传播，直到x+y被重新计算并再次变得可用为止。第二，只有两个理由可能会使x+y变成不可用的。

1）因为x或y在基本块B中被定值且其后没有计算x+y，因此x+y被杀死。在这种情况下，我们第一次应用传递函数fB的时候，x+y就会从OUT［B］中被删除。

2）在某些路径中，x+y一直没有被计算。因为x+y肯定不会在OUT［ENTRY］中，并且它也不会在上面说的那条路径中被生成。我们可以通过对路径长度的归纳来证明x+y最终会从这条路径的所有基本块的IN和OUT值中删除。

因此，当各个IN和OUT值不再改变的时候，图9-20中提到的迭代算法给出的解将只包含真正的可用表达式。

！练习9.2.9：证明有关算法9.17的下列特性：

1）各个IN和OUT的值决不会增长。也就是说，这些集合在后来的取值总是它们前面取值的子集（不一定是真子集）。

2）如果表达式e从IN［B］或OUT［B］中被删除，那么必然相应地存在一条从流图入口到达B的开始处或结尾处的路径，要么e在这条路径上从没有被计算过，要么在最后一次对e计算之后，e的某个参数被重新定值了。

3）如果表达式最终保留在IN［B］或OUT［B］中，那么相应地从流图入口到基本块B开始处或结尾处的所有路径中，e都被计算，且在最后一次计算e之后，e的参数都没有被重新定值。

！练习9.2.10：细心的读者可能注意到在算法9.11中，我们可以把各个基本块B的genB初始化为OUT［B］，这样可以减少一些运行时间。类似地，我们还可以在算法9.14中把useB初始化为IN［B］。我们没有这么做的原因是为了用统一的方法来处理这个主题。我们将在算法9.25中再次看到这一点。但是，可以在算法9.17中把e_genB初始化为OUT［B］吗？为什么可以或不可以？

！练习9.2.11：至今为止，我们的数据流分析没有利用条件跳转的语义。假设我们在一个基本块的结尾处找到一个如下的测试：

![410-1](../Images/image04686.jpeg)

我们如何利用对测试表达式x<10的理解来改进有关到达定值的知识？请记住，在这里“改进”意味着我们要消除某些实际上永远不可能达到某个程序点的到达定值。