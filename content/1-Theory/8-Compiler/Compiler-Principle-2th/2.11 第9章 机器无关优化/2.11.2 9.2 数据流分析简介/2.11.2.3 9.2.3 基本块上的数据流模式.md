### 9.2.3　基本块上的数据流模式

从技术上讲，数据流模式涉及程序中每个点上的数据流值。但是如果我们认识到基本块内部的数据流处理通常很简单，就可以节约数据流分析所需的时间和空间。控制流从基本块的开始流动到结尾，中间没有中断或者分支。这样，我们就可以用进入和离开基本块的数据流值的方式来重新描述这个模式。对于每个基本块B，我们把紧靠其前和紧随其后的数据流值分别记为IN［B］和OUT［B］。关于IN［B］和OUT［B］的约束可以按照下面的方法，根据关于B中的各个语句s的IN［s］和OUT［s］的约束得到。

假设基本块由语句s1，s2，…，sn顺序组成。如果s1是基本块B的第一个语句，那么IN［B］=IN［s］。类似地，如果sn是基本块B的最后一个语句，那么OUT［B］=OUT［sn］。基本块B的传递函数记为fB，它可以通过将该基本块中各语句的传递函数组合起来获得该传递函数。也就是说，设fs是语句si的传递函数，那么![399-1](../Images/image04655.jpeg)。该基本块的开头和结尾处的数据流值的关系是

OUT［B］=fB（IN［B］）

因基本块之间的控制流而产生的约束可以很容易地通过重写得到，把原来约束中的IN［s1］和OUT［sn］分别替换为IN［B］和OUT［B］即可。比如，如果一个数据流值表示的是可能被赋予某个变量的常量集合，那么我们就得到一个前向流问题，其中

![400-1](../Images/image04656.jpeg)

我们很快就会在处理活跃变量分析时看到逆向数据流问题。逆向数据流问题的方程是类似的，但是IN和OUT值的角色被调换了。也就是说：

IN［B］=fB（OUT［B］）

![400-2](../Images/image04657.jpeg)

和线性算术方程不同，数据流方程通常没有唯一解。我们的目标是寻找一个最“精确的”满足这两组约束（即控制流和传递的约束）的解。也就是说，我们需要一个解，它能够支持有效的代码改进，但是又不会导致不安全的转换。这些不安全的转换改变了程序计算的内容。在后面数据流分析中的“保守主义”部分对这个问题进行了简短的讨论，在9.3.4节中给出了更加深入的讨论。在下面的小节中，我们将讨论可通过数据流分析解决的问题的某些最重要的例子。