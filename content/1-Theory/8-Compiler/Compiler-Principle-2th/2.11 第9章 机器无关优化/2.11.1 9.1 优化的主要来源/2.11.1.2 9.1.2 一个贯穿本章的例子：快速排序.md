### 9.1.2　一个贯穿本章的例子：快速排序

接下来，我们将使用被称为快速排序（quicksort）的排序程序的片断来说明几个重要的可以改进代码的转换。在图9-1中的C程序是从Sedgewick[^1]那里拿来的，它讨论了如何对这样一个程序进行手工优化。我们将不会在这里讨论这个程序在算法方面的所有精妙细节，比如，a［0］必然存放着已经排好序的元素的最小者，而a［max］则存放最大的元素。

![390-1](../Images/image04632.jpeg)

图9-1　快速排序算法的C代码

在我们可以优化掉地址计算中的冗余之前，程序中的地址运算首先必须被分解成为低层次的算术运算，这样才能暴露出冗余之处。在本章的其余部分，我们假设中间表示形式由三地址语句组成，其中所有的中间表达式的结果都由临时变量来存放。在图9-1中标记出的程序片断的中间代码显示在图9-2中。

![391-1](../Images/image04633.jpeg)

图9-2　图9-1中程序片断的三地址代码

在这个例子中，我们假设整数占用4个字节。赋值运算`x=a［i］`按照6.4.4节中的方法被翻译成为图9-2中（14）、（15）步所示的两个三地址语句，即

![390-2](../Images/image04634.jpeg)

类似地，`a［j］=x`变成了第（20）和（21）步，即

![390-3](../Images/image04635.jpeg)

请注意，在原程序中的每个数组访问都被翻译成为一对语句，其中包含一个乘法和一个数组下标运算。结果，这个短短的程序片断被翻译成为一个相当长的三地址运算序列。

图9-3是图9-2中的程序的流图。基本块B1是其入口结点。8.4节介绍过，图9-2中所有的条件和无条件跳转语句的目标在图9-3中都被替换为以它们的目标语句为首语句的基本块。在图9-3中有三个循环。基本块B2和B3本身就是循环。基本块B2、B3、B4、B5一起组成了一个循环，其中B2是唯一的入口结点。

![391-2](../Images/image04636.jpeg)

图9-3　快速排序代码片断的流图