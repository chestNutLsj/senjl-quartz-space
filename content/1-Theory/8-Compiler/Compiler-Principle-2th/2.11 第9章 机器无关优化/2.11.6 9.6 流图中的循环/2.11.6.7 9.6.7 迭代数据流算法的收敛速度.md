### 9.6.7　迭代数据流算法的收敛速度

我们现在可以讨论迭代算法的收敛速度了。如9.3.3节中所讨论的，算法的最大迭代次数可能是格的高度和流图结点数的乘积。对于很多数据流分析而言，我们可以对求值过程进行适当排序，使算法经过很少的迭代就能收敛。我们感兴趣的性质是是否所有影响一个结点的重要事件都可以通过一个无环的路径到达该点。在至今已经讨论过的数据流分析问题中，到达定值、可用表达式和活跃变量问题具有这个性质，而常量传递则不具有这个性质。更加明确地说：

- 如果一个定值d在IN［B］中，那么必然有一条从包含d的基本块到达B的无环路径使得d在该路径上的所有IN和OUT值中。
- 如果表达式x+y在基本块B的入口处不可用，那么必然有一条具有下列性质的无环路径：要么该路径从程序的入口结点出发并且不包含任何杀死或产生x+y的语句；要么该路径从一个杀死了x+y的基本块出发，并且从此之后该路径中没有产生表达式x+y。
- 如果x在基本块B的出口处活跃，那么必然有一个从B开始到达对x的某次使用的无环路径，在此路径上没有对x的定值。

我们可以检验出在上述各个情况中，带有环的路径不会增加任何内容。比如，如果可以通过一个带环的路径从基本块B的结尾到达x的使用点，那么我们可以消除这个环，得到一个更短的路径。沿着这个较短路径依然可以从B到达x的这个使用点。

反过来，常量传播就没有这个性质。考虑如下一个简单程序，它仅包含一个由单个基本块组成的循环，基本块中的代码为

![441-1](../Images/image04728.jpeg)

当第一次访问这个基本块时，我们发现c具有常量值1，但是a和b没有定值。第二次访问该基本块时，我们发现b和c都有常量值1。经过对该基本块的三次访问之后，赋给c的常量值1才到达a。

如果所有有用的信息都通过无环路径传播，我们就有可能调整迭代数据流算法中访问结点的顺序，以便经过几轮结点访问就可以保证这些信息已经沿着所有的无环路径传递完毕。

回顾一下9.6.3节中说过，如果a→b是一条边，那么只有当该边是后退边的时候b的深度优先编号才会小于a的编号。对于前向的数据流问题，按照深度优先顺序来访问结点是很合适的。明确地说，我们对图9-23a中的算法进行修改，把算法中访问流图中各个基本块的第（4）行代码替换为：

for（按照深度优先顺序，对所有不同于ENTRY的各个基本块B）｛

例9.49　假设一个定值d在如下路径上传播，

3→5→19→35→16→23→45→4→10→17

其中的整数表示该路径上的各个基本块的深度优先编号。那么，图9-23a中算法的第（4）到（6）行的循环第一次运行时，d将从OUT［3］传播到IN［5］再传播到OUT［5］，…，最后到达OUT［35］。因为16排在35之前，d不会在这一轮中到达IN［16］。在d被放进OUT［35］的时候，我们已经计算了IN［16］。但是下次我们运行第（4）到（6）行的循环时，因为此时d已经在OUT［35］中，它将在计算IN［16］的时候被加入进去。定值d同时会被传播到OUT［16］，IN［23］，…，最后到达OUT［45］。它必须在这里等待下一轮计算，因为这一轮中已经计算过IN［4］了。在第三轮中，d将传播到IN［4］，OUT［4］，IN［10］和IN［17］。因此在三轮之后我们使得定值d到达了基本块17。

从这个例子中不难抽取出一般规律。如果我们在图9-23a中使用深度优先排序，那么把任何到达定值沿着一条无环路径传播所需要的迭代轮次不会大于路径中从高编号基本块到低编号基本块的边的个数加一。这些边恰好就是后退边，因此，所需轮次就是流图的深度加一。当然，算法9.11还需要再做一次不改变任何值的迭代，才能检测出所有定值都已经被传播到了所有它能够到达的地方。因此，使用了深度优先基本块排序的这个算法所执行的迭代轮次的上限实际上是深度加二。一项研究[^13]表明，常见流图的平均深度大约是2.75。因此这个算法的收敛速度很快。

产生不可归约数据流图的一个原因

在一种情况下我们通常不能指望一个流图是可归约的。如果像我们在算法9.46中寻找自然循环所做的那样，把一个程序的流图的边反向，那么我们不大可能得到一个可归约流图。直观的理由是，虽然典型程序的循环只有一个入口，但这些循环有时会有几个出口。当我们把流图的边反向时，这些出口就变成了入口。

在类似于活跃变量这样的逆向数据流问题中，我们以深度优先排序的逆序来访问结点。这样，我们可以沿着路径

3→5→19→35→16→23→45→4→10→17

经过一个轮次把基本块17中对某个变量的一次使用逆向传播到IN［4］。然后在这里等待下一次迭代，以便把它传播到OUT［45］。在第二轮迭代中，它到达IN［16］，在第三轮中它从OUT［35］到达OUT［3］。

总的来说，深度加一次迭代足以把一个变量的使用沿着任何无环路径逆向传递完毕。但是，我们必须在每次迭代中按照深度优先排序的逆序来访问各个结点，因为这样才能在一次迭代中把变量的使用沿着任意长的下降结点序列传递。

在一些数据流分析问题中，环形路径不会给分析增加任何信息。至今为止讨论的界限是所有此类问题的上界。在一些特殊的问题中，比如对于支配结点问题，迭代算法的收敛速度更快。在输入流图是可归约的情况下，如果以深度优先顺序访问各个结点，那么数据流算法的第一轮迭代就可以得到各个结点的支配结点集合。如果我们之前不知道输入流图是可归约的，那么我们需要一次额外的迭代来确定算法已经收敛了。