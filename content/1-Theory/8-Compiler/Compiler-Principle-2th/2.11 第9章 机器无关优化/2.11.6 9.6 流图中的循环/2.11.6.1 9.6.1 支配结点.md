### 9.6.1　支配结点

如果每一条从流图的入口结点到结点n的路径都经过结点d，我们就说d支配（dominate）n，记为d dom n。请注意，在这个定义下每个结点支配它自己。

例9.37　考虑图9-38中的以结点1作为入口结点的流图。入口结点支配所有结点（这个结论对所有的流图都成立）。结点2只能支配它自己，因为控制流可以通过以1→3开头的路径到达所有其他结点，所以结点3支配除1、2之外的所有结点。结点4支配除1、2、3之外的所有其他结点，因为所有从1开始的路径的开头要么是1→2→3→4，要么是1→3→4。结点5和6都只支配它们自身，因为控制流可以选择从它们中的某一个结点通过，从而绕过另一个结点。最后，结点7支配结点7、8、9、10；结点8支配结点8、9、10；9和10只支配它们自身。

![434-1](../Images/image04719.jpeg)

图9-38　一个流图

一种有用的表示支配结点信息的方法是用所谓的支配结点树（dominator tree）来表示。在树中，入口结点就是根结点，并且每个结点d只支配它在树中的后代结点。比如，图9-39显示了图9-38中流图的支配结点树。

![434-2](../Images/image04720.jpeg)

图9-39　图9-38中流图的支配结点树

支配结点的一个性质决定了一定存在支配结点树：每个结点n具有唯一的直接支配结点（immediate dominator）m。在从入口结点到达结点n的任何路径中，它是n的最后一个支配结点。用dom关系来表示，n的直接支配结点m具有以下性质：如果d≠n且d dom n，那么d dom m。

我们将给出一个简单的算法来计算流图中各个结点n的所有支配结点。这个算法基于如下原理：如果p1，p2，…，pk是n的所有前驱并且d≠n，那么d dom n当且仅当对于每个i，d dom pi。这个问题可以写成一个前向数据流分析问题。数据流的值域是基本块的集合。一个结点的支配结点集合（它自己除外）是它的所有前驱的支配结点的交集；因此这个问题的交汇运算是交集运算。基本块B的传递函数直接把B自身加入到输入结点集合中。问题的边界条件是ENTRY结点支配它自身。最后，内部结点的初始值是全集，也就是所有结点的集合。

算法9.38　寻找支配结点。

输入：一个流图G，G的结点集是N，边集是E，而入口结点是ENTRY。

输出：对于N中的各个结点n，给出D（n），即支配n的所有结点的集合。

方法：求出由图9-40给定参数的数据流问题的解。输入流图的基本块就是结点。对于N中的所有结点n，D（n）=OUT［n］。

![435-1](../Images/image04721.jpeg)

图9-40　一个计算支配结点的数据流算法

使用这个数据流算法来寻找支配结点很高效。我们将在9.6.7节看到，只要对流图中的结点进行几次访问就可以得到问题的解。

关系dom的性质

有关支配结点的一个关键性质是如果我们从入口结点沿着一个无环路径到达结点n，那么n的所有支配结点都出现在这条路径中，并且它们总是以相同顺序出现在所有这样的路径中。为了说明原因，假设在一个到达n的无环路径P1中支配结点a和b的顺序为先a后b，而在另一条路径P2中b在a之前。那么我们可以沿着P1到达a然后再沿着P2到达n，从而避开了b。因此，b实际上不支配n。

通过这个推理过程，我们可以证明dom是传递的：如果a dom b并且b dom c，那么a dom c。关系dom也是反对称的：如果a≠b，那么a dom b和b dom a不可能同时成立。而且，如果a和b是n的两个支配结点，那么a dom b或b dom a中必然有一个成立。最后可以推出除了入口结点之外的每个结点n必然有一个唯一的直接支配结点，即在从入口结点到n的任何无环路径中出现的离n最近的支配结点。

例9.39　让我们回顾一下图9-38中的流图，并假设图9-23中第（4）到（6）行的for循环依照数字顺序访问其结点。令D（n）为OUT［n］中的结点的集合。因为1是入口结点，算法的第一行首先把｛1｝赋给D（1）。结点2的前驱只有1，因此D（2）=｛2｝∪D（1）。这样D（2）就被设置为｛1，2｝。然后考虑结点3，它的前驱是1、2、4和8。因为所有内部结点的值都被初始化为结点的全集N，

D（3）=｛3｝∪（｛1｝∩｛1，2｝∩｛1，2，…，10｝∩｛1，2，…，10｝）=｛1，3｝

其余的计算过程如图9-41所示。因为在图9-23a中，第（3）到（6）行的外层循环的第二次迭代中这些值不再改变，它们就是这个支配结点问题的最终答案。

![436-1](../Images/image04722.jpeg)

图9-41　例9.39中支配结点计算的最终结果