## 8.6　一个简单的代码生成器

在本节中，我们将考虑一个为单个基本块生成代码的算法。它依次考虑各个三地址指令，并跟踪记录哪个值存放在哪个寄存器中。这样可以避免生成不必要的加载和保存指令。

在代码生成中的主要问题之一是决定如何最大限度地利用寄存器。寄存器有如下四种主要使用方法：

- 在大部分机器的体系结构中，执行一个运算时该运算的部分或全部运算分量必须存放在寄存器中。
- 寄存器很适合做临时变量，即在计算一个大表达式时存放其子表达式的值。或者更一般地讲，寄存器适合用于存放只在单个基本块内使用的变量的值。
- 寄存器用来存放在一个基本块中计算而在另一个基本块中使用的（全局）值。比如，循环下标的值，每次循环都对该值作增量运算，并在循环体中多次被使用。
- 寄存器经常用来帮助进行运行时刻的存储管理。比如，管理运行时刻栈包括栈指针的维护，栈顶元素也可能被存放在寄存器中。

因为可用寄存器的数量是有限的，这些需求之间有相互竞争的关系。

本节的算法假设有一组寄存器可以用来存放在基本块内使用的值。通常情况下，这个寄存器集合不包括机器的所有寄存器，因为有些寄存器专门用于存放全局变量或者用于对栈进行管理。我们假设基本块已经通过诸如公共子表达式合并这样的转换而变成了我们希望的三地址指令序列。我们进一步假设对每个运算符有且只有一个对应的机器指令。这个指令对存放在寄存器中的所需的运算分量进行运算，并把结果存放在一个寄存器中。机器指令的形式如下：

- `LD` reg，mem
- `ST` mem，reg
- `OP` reg，reg，reg