## 8.7　窥孔优化

虽然大部分编译器产品通过仔细的指令选择和寄存器分配来生成优质代码，但还有一些编译器使用另一种策略：它们先生成原始的代码，然后对目标代码进行“优化”转换，提高目标代码的质量。这里使用术语“优化”具有一定的误导性，因为不能保证得到的代码在任何数学度量之下都是最优的。不管怎么说，很多简单的转换可以有效地改善目标程序的运行时间和空间需求。

一个简单却有效的、用于局部改进目标代码的技术是窥孔优化（peephole optimization）。它在优化的时候检查目标指令的一个滑动窗口（即窥孔），并且只要有可能就在窥孔内用更快或更短的指令来替换窗口中的指令序列。也可以在中间代码生成之后直接应用窥孔优化来提高中间表示形式的质量。

窥孔是程序上的一个小的滑动窗口。窥孔优化技术并不要求在窥孔中的代码一定是连续的，尽管有些实现要求代码连续。窥孔优化的特点是每一次改进又可能产生出新的优化机会。一般来说，为了获得最大的好处就需要多次扫描目标代码。在本节中，我们将给出下列具有窥孔优化特点的程序变换的例子。

- 冗余指令消除
- 控制流优化
- 代数化简
- 机器特有指令的使用