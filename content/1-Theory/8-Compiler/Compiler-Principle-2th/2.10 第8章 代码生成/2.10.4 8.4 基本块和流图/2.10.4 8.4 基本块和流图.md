## 8.4　基本块和流图

本节介绍一种用图来表示中间代码的方法。即使这个图没有显式地被代码生成算法生成，它对于讨论代码生成也是有帮助的。上下文信息有助于更好地生成代码。正如我们将在8.8节看到的，如果我们知道程序中的值是如何被定值和使用的，我们就可以更好地分配寄存器。我们还将在8.9节看到，通过检查三地址语句序列，我们可以更好地完成指令选择工作。

这个表示方法可以按照如下方法构造：

1）把中间代码划分成为基本块（basic block）。每个基本块是满足下列条件的最大的连续三地址指令序列。

① 控制流只能从基本块中的第一个指令进入该块。也就是说，没有跳转到基本块中间的转移指令。

② 除了基本块的最后一个指令，控制流在离开基本块之前不会停机或者跳转。

2）基本块形成了流图（flow graph）的结点。而流图的边指明了哪些基本块可能紧随一个基本块之后运行。

从第9章开始，我们将讨论在流图上的多种转换。这些转换把原有的中间代码转换成为“优化后”的中间代码，而从“优化后”的中间代码可以生成更好的目标代码。将“优化后”的中间代码转换为目标机器代码的工作将使用本章中的代码生成技术完成。

中断的影响

有人认为，只要控制流到达基本块的开始处就必然会继续执行到基本块结束处，但是这个说法需要一些仔细的考虑。有很多原因会导致一个中断使得控制流离开基本块，甚至可能不再返回，但这些中断并没有在代码中显式地反映出来。比如，一个像`x=y/z`这样的指令看起来不影响控制流。但是如果z是0，此指令实际上可能使程序异常中止。

我们用不着担心这种可能性。理由如下：构造基本块的目的是优化代码。一般来说，当一个中断发生时，它要么被适当处理然后将控制返回到引起中断的指令，就好像控制流从来没有离开过；要么程序会中止并报错。在后一种情况下，即使我们在优化时假设控制流会一直到达基本块的结尾，优化的结果也不会有错，因为程序本来就不会给出预计的结果。