### 8.4.2　后续使用信息

知道一个变量的值接下来会在什么时候使用对于生成良好的代码是非常重要的。如果一个变量的值当前存放在一个寄存器中，且之后一直不会被使用，那么这个寄存器就可以被分派给另一个变量。

在一个三地址语句中对一个名字的使用（use）的定义如下。假设三地址语句i给x赋了一个值。如果语句j的一个运算分量为x，并且从语句i开始可以通过未对x进行赋值的路径到达语句j，那么我们说语句j使用了在语句i处计算得到的x的值。我们可以进一步说x在语句i处活跃（live）。

对每个类似于x=y+z的三地址语句，我们希望确定对x、y和z的下一次使用是什么。当前我们不考虑在包含本三地址语句的基本块之外的使用。

我们用来确定活跃性和后续使用信息的算法对每个基本块进行一次反向的遍历。我们把得到的信息存放到符号表中。使用算法8.5中给出的方法，我们可以很容易地通过扫描一个三地址语句流找到各个基本块的结尾。因为过程可能有副作用，为方便起见，我们假设每一个过程调用指令是一个新的基本块的开始。

算法8.7　对一个基本块中的每一个语句确定活跃性与后续使用信息。

输入：一个三地址语句的基本块B，我们假设在开始的时候符号表显示B中的所有非临时变量都是活跃的。

输出：对于B的每一个语句i：x=y+z，我们将x、y及z的活跃性信息及后续使用信息关联到i。

方法：我们从B的最后一个语句开始，反向扫描到B的开始处。对于每个语句i：x=y+z，我们做下面的处理：

1）把在符号表中找到的有关x、y和z的当前后续使用和活跃性信息与语句i关联起来。

2）在符号表中，设置x为“不活跃”和“无后续使用”。

3）在符号表中，设置y与z为“活跃”，并把它们的下一次使用设置为语句i。

在这里，我们使用+作为代表任意运算符的符号。如果三地址语句i形如x=+y或者x=y，那么处理步骤依然和上面相同，只是忽略了对z的处理。注意，步骤（2）和步骤（3）的顺序不能颠倒，因为x可能就是y或者z。