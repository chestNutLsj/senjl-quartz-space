### 8.8.1　全局寄存器分配

8.6节中的代码生成算法在单个基本块的运行期间使用寄存器来存放值。但是，在每个基本块的结尾处，所有活跃变量的值都被保存到内存中。为了省略一部分这样的保存及相应的加载指令，我们可以把一些寄存器指派给频繁使用的变量，并且使得这些寄存器在不同基本块中的（即全局的）指派保持一致。因为程序的大部分时间花在它的内部循环上，所以一个自然的全局寄存器指派方法是试图在整个循环中把频繁使用的值存放在固定的寄存器中。从现在开始，假设我们知道一个流图的循环结构，并且我们知道在一个基本块中计算的哪些值会在该基本块外使用。下一个章将介绍用于计算这些信息的技术。

全局寄存器分配的策略之一是分配固定多个寄存器来存放每个内部循环中最活跃的值。在不同的循环中所选择的值也有所不同。没有被分配的寄存器可以如8.6节中说的那样用于存放一个基本块的局部值。这个方法的缺点是固定的寄存器个数并不总是恰好等于用于全局寄存器分配的最佳数量。但是这个方法实现起来很简单，它曾经被用在Fortran H中。这是IBM在20世纪60年代后期为360系列计算机开发的Fortran优化编译器。

在早期的C编译器中，程序员可以明确地参与某些寄存器分配过程。他们使用寄存器声明来使得某些值在一个过程运行期间都保存在寄存器中。明智地使用寄存器声明确实可以提高很多程序的运行速度，但是应该鼓励程序员在分配寄存器之前先获取程序的运行时刻特征并确定程序运行的热点代码。