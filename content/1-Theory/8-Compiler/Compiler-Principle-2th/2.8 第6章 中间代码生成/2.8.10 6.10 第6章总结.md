## 6.10　第6章总结

本章中介绍的技术可以被综合起来，构造一个简单的编译器前端，比如附录A中的那个编译器前端。编译器的前端可以增量式地进行构造：

- 选择一个中间表示形式：中间表示形式通常是一个图形表示方法和三地址代码的组合。比如在语法树中，图中的结点表示一个程序构造；而各个子结点表示其子构造。三地址代码的名字源于它的x=y op z的形式。每条指令至多有一个运算符。另外还有一些用于控制流的三地址指令。
- 翻译表达式：通过在各个形如E→E1 op E2的产生式中加入语义动作，带有复杂运算的表达式可以被分解成一个由单一运算组成的序列。这些动作或者创建一个E的结点，此结点的子结点为E1和E2；或者生成一条三地址指令，该指令对E1和E2的地址应用运算符op，并将其运算结果放入一个临时变量中。这个临时变量就成了E的地址。
- 检查类型：一个表达式E1 op E2的类型是由运算符op以及E1和E2的类型决定的。自动类型转换（coercion）是指隐式的类型转换，例如从integer转换到float。中间代码中还包含了显式的类型转换，以保证运算分量的类型和运算符的期待类型精确匹配。
- 使用符号表来实现声明：一个声明指定了一个名字的类型。一个类型的宽度是指存放该类型的变量所需要的存储空间。使用宽度，一个变量在运行时刻的相对地址可以计算为相对于某个数据区域的开始地址的偏移量。每个声明都会将一个名字的类型和相对地址放入符号表，这样当这个名字后来出现在一个表达式中时，翻译器就可以获取这些信息。
- 将数组扁平化：为实现快速访问，数组元素被存放在一段连续的空间内。数组的数组可以被扁平化，当作各个元素的一维数组进行处理。数组的类型用于计算一个数组元素相对于数组基地址的偏移量。
- 为布尔表达式产生跳转代码：在短路（或者说跳转）代码中，布尔表达式的值被隐含在代码所到达的位置中。因为布尔表达式B常常被用于决定控制流，例如在if（B）S中就是这样，因此跳转指令是有用的。只要使得程序正确地跳转到代码`t=true`或`t=flase`处，就可以计算出布尔值，其中的t是一个临时变量。使用跳转标号，通过继承对应于一个布尔表达式的真假出口的标号，就可以对布尔表达式进行翻译。常量true和false分别被翻译成跳转到真值出口和假值出口的指令。
- 用控制流实现语句：通过继承next标号就可以实现语句的翻译，其中next标记了这个语句的代码之后的第一条指令。翻译条件语句S→if（B）S1时，只需要将一个标记了S1的代码起始位置的新标号和S.next分别作为B的真值出口和假值出口传递给其他处理程序。
- 可以选择使用回填技术：回填是一种为布尔表达式和语句进行一趟式代码生成的技术。其基本思想是维护多个由不完整跳转指令组成的列表，在同一列表中的指令具有同样的跳转目标。当目标位置已知时，将为相应列表中的所有指令填入这个目标。
- 实现记录：记录或类中的字段名可以当作声明序列进行处理。一个记录类型包含了关于它的各个域的类型和相对地址的信息。可以使用一个符号表对象来实现这个目的。