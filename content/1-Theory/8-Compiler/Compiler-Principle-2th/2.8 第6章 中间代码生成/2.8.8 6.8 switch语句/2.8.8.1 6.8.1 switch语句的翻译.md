### 6.8.1　switch语句的翻译

一个switch语句的预期翻译结果是完成如下工作的代码：

1）计算表达式E的值。

2）在case列表中寻找与表达式值相同的值Vj。回顾一下，当在case列表中明确列出的值都不和表达式匹配时，就用默认值和表达式匹配。

3）执行和匹配值关联的语句Sj。

步骤（2）是一个n路分支，它可以采取多种方法实现。如果case的数目较少，比如不多于10个，那么可以使用一个条件跳转指令序列来实现。每一个条件跳转指令都测试一个常量值，并跳转到这个值对应的语句的代码。

实现这个条件跳转指令序列的一个简洁的方法是创建一个对照关系表。表中的每一个关系都包含了一个常量值和相应语句代码的标号。在运行时刻，表达式自身的值以及默认语句的标号被放在对照表的末端。编译器生成一个简单循环，把表达式的值和表中的每个值进行比较。我们已经保证了当找不到其他匹配时，最后一个条目（默认值条目）一定会匹配。

如果值的个数超过10个或更多，那么更高效的方式是为这些值构造一个散列表。这个表的条目是各个分支语句的标号。如果没有找到对应于switch表达式的值的条目，就会有一条跳转指令转到默认语句。

还有一种常见的特殊情况，它的实现可以比n路分支更加高效。如果表达式的值位于某个较小的范围内，比如从min到max，并且不同常量值的总数接近max-min。那么我们可以构造一个包含max-min个“桶”的数组，其中桶j-min包含了对应于值j的语句的标号；任何没有被填入对应标号的“桶”中包含了默认标号。

执行switch语句时，首先计算表达式并获得值j；检查它是否在min到max的范围之内，如是则间接跳转到偏移量为j-min的条目中的标号。例如，如果表达式的类型是字符型，我们可以创建一个包含128个条目（根据具体的字符集，条目个数可有不同）的表，并且不进行范围检查直接进行控制流跳转。