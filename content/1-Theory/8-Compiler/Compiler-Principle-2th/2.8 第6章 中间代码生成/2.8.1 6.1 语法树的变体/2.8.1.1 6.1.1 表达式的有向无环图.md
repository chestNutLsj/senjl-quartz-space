### 6.1.1　表达式的有向无环图

和表达式的语法树类似，一个DAG的叶子结点对应于原子运算分量，而内部结点对应于运算符。与语法树不同的是，如果DAG中的一个结点N表示一个公共子表达式，则N可能有多个父结点。在语法树中，公共子表达式每出现一次，代表该公共子表达式的子树就会被复制一次。因此，DAG不仅更简洁地表示了表达式，而且可以为最终生成表达式的高效代码提供重要的信息。

例6.1　图6-3给出了下面的表达式的DAG

![245-1](../Images/image04377.jpeg)

![245-2](../Images/image04378.jpeg)

图6-3　表达式`a+a*（b-c）+（b-c）*d`的DAG

叶子结点a在表达式中出现了两次，因此a有两个父结点。值得注意的是，结点“-”代表公共子表达式`b-c`的两次出现。该结点同样有两个父结点，表明该子表达式在子表达式`a*（b-c）`和`（b-c）*d`中两次被使用。尽管`b`和`c`在整个表达式中出现了两次，但它们对应的结点只有一个父结点，因为对它们的使用都出现在同样的公共子表达式`b-c`中。

图6-4给出的SDD（语法制导定义）既可以用来构造语法树，也可以用来构造DAG。它在例5.11中曾用于构造语法树。在那里，函数Leaf和Node每次被调用都会构造出一个新结点。要构造得到DAG，这些函数就要在每次构造新结点之前首先检查是否已存在这样的结点。如果存在一个已被创建的结点，就返回这个已有的结点。例如，在构造一个新结点Node（op，left，right）之前，我们首先检查是否已存在一个结点，该结点的标号为op，且其两个子结点为left和right。如果存在这样的结点，Node 函数返回这个已存在的结点，否则它创建一个新结点。

![245-3](../Images/image04379.jpeg)

图6-4　生成语法树或DAG的语法制导定义

例6.2　图6-5给出了构造图6-3所示DAG的各个步骤。如上所述，函数Node和Leaf尽可能地返回已存在的结点。我们假设entry-a指向符号表中与a对应的项，其他标识符的处理方式与此类似。

![246-1](../Images/image04380.jpeg)

图6-5　图6-3所示的DAG的构造过程

当在第2步再次调用Leaf（id，entry-a）时，函数返回的是之前调用生成的结点，因此p2=p1。类似地，第8步和第9步返回的结点分别和第3步及第4步返回的结果相同（即p8=p3，p9=p4）。同样，第10步返回的结点必然和第5步中返回的结点相同，即p10=p5。