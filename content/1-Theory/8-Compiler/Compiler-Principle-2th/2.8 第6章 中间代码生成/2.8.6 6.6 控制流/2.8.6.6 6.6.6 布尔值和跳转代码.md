### 6.6.6　布尔值和跳转代码

本节讨论的重点是用于改变语句中控制流的布尔表达式。一个布尔表达式的目的可能就是要求出它的值，如`x=true`；或`x=a<b`；的语句中的布尔表达式就是这样。

处理布尔表达式的这两种角色的一种简单思路是首先建立表达式的抽象语法树，可以使用下面的两种方法之一：

1）使用两趟处理的方法。为输入构造出完整的抽象语法树，然后以深度优先顺序遍历这棵抽象语法树，依据语义规则的描述计算得到翻译结果。

2）对语句进行一趟处理，但对表达式进行两趟处理。使用这种方法时，我们将首先翻译语句while（E）S1中的E，然后再处理S1。然而，要对E进行翻译，需要首先建立它的抽象语法树，然后再遍历它。

在下列文法中，用单个非终结符号E来代表表达式：

S→id =E；| if（E）S | while（E）S | S S

E→E‖E | E&&E | E rel E | E+E |（E）|id | true | false

非终结符号E支配了S→while（E）S1的控制流。同一个非终结符号E在S→id=E和E→E+E中则表示一个值。

我们可以使用不同的代码生成函数处理表达式的这两种角色。假定属性E.n表示对应于表达式E的抽象语法树结点，并且抽象语法树中的结点都是对象。令方法jump产生一个表达式结点的跳转代码，并令方法rvalue产生计算结点的值的代码，该代码还把得到的值存储在一个临时变量中。

对于出现在S→while（E）S1中的E，在结点E.n上调用方法jump。方法jump的实现是基于图6-37给出的关于布尔表达式的语义规则。确切地说，跳转代码是通过调用E.n.jump（t，f）生成的，其中t是指向S1.code的第一条指令的新标号，而f就是标号S.next。

对于出现在S→id=E；中的E，在结点E.n上调用方法rvalue。如果E形如E1+E2，方法调用E.n.rvalue()按照6.4节中讨论的方法生成代码。如果E形如E1&&E2，我们首先为E生成跳转代码，然后在跳转代码的真假出口分别将true和false赋给一个新的临时变量t。

例如，赋值语句`x=a<b && c<d`可以用图6-42中的代码来实现。

![277-2](../Images/image04443.jpeg)

图6-42　通过计算一个临时变量的值来翻译一个布尔类型的赋值语句