### 6.7.1　使用回填技术的一趟式目标代码生成

回填技术可以用来在一趟扫描中完成对布尔表达式或控制流语句的目标代码生成。我们生成的目标代码的形式和6.6节中的代码的形式相同，但是处理标号的方法不同。

在本节中，非终结符号B的综合属性truelist和falselist将用来管理布尔表达式的跳转代码中的标号。特别的，B.truelist将是一个包含跳转或条件跳转指令的列表，我们必须向这些指令中插入适当的标号，也就是当B为真时控制流应该转向的标号。类似地，B.falselist也是一个包含跳转指令的列表，这些指令最终获得的标号就是当B为假时控制流应该转向的标号。在生成B的代码时，跳转到真或假出口的跳转指令是不完整的，标号字段尚未填写。这些不完整的跳转指令被保存在B.truelist和B.falselist所指的列表中。类似地，语句S的综合属性S.nextlist也是一个跳转指令列表，这些指令应该跳转到紧跟在S的代码之后的指令。

更明确地讲，我们将生成的指令放入一个指令数组中，而标号就是这个数组的下标。为了处理跳转指令的列表，我们使用下面三个函数：

1）makelist（i）创建一个只包含i的列表。这里i是指令数组的下标。函数makelist返回一个指向新创建的列表的指针。

2）merge（p1，p2）将p1和p2指向的列表进行合并，它返回的指针指向合并后的列表。

3）backpatch（p，i）将i作为目标标号插入到p所指列表中的各指令中。