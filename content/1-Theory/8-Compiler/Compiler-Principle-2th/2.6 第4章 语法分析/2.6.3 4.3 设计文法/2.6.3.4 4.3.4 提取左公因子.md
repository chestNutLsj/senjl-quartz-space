### 4.3.4　提取左公因子

提取左公因子是一种文法转换方法，它可以产生适用于预测分析技术或自顶向下分析技术的文法。当不清楚应该在两个A产生式中如何选择时，我们可以通过改写产生式来推后这个决定，等我们读入了足够多的输入，获得足够信息后再做出正确选择。

比如，如果我们有两个产生式

![150-3](../Images/image04174.jpeg)

在看到输入if的时候，我们不能立刻指出应该选择哪个产生式来展开stmt。一般来说，如果A→αβ1 | αβ2是两个A产生式，并且输入的开头是从α推导得到的一个非空串，那么我们就不知道应该将A展开为αβ1还是αβ2。然而，我们可以将A展开为αA′，从而将做出决定的时间往后延。在读入了从α推导得到的输入前缀之后，我们再决定将A′展开为β1或β2。也就是说，经过提取左公因子，原来的产生式变成了

A→αA′

A′→β1 | β2

算法4.21　对一个文法提取左公因子。

输入：文法G。

输出：一个等价的提取了左公因子的文法。

方法：对于每个非终结符号A，找出它的两个或多个选项之间的最长公共前缀α。如果α≠∈，即存在一个非平凡的公共前缀，那么将所有A产生式A→αβ1 |αβ2 |…|αβn | γ，替换为

A→αA′ | γ

A′→β1 | β2 |…| βn

其中，γ表示所有不以α开头的产生式体；A′是一个新的非终结符号。不断应用这个转换，直到每个非终结符号的任意两个产生式体都没有公共前缀为止。

例4.22　下面的文法抽象表达了“悬空-else”问题：

S→ i E t S | i E t S e S | a　（4.23）

E→b

这里i、t和e代表if、then和else；E和S表示“条件表达式”和“语句”。提取左公因子后，这个文法变为：

S→ i E t S S′ | a

S′→e S | ∈　（4.24）

E→b

这样，我们可以在输入为i时将S展开为iEtSS′，并在处理iEtS之后才决定将S′展开为eS还是∈。当然，上面的两个文法都是二义性的，当输入为e时不能够确定应该选择S′的哪个产生式。例子4.33将讨论一个可以摆脱这个困境的方法。