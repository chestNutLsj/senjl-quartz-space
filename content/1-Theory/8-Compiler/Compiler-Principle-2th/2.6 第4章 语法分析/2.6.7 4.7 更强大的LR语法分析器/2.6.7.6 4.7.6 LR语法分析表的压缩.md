### 4.7.6　LR语法分析表的压缩

一个典型的具有50～100个终结符号和100个产生式的程序设计语言文法的LALR语法分析表中可能包含几百个状态。分析表的动作函数常常包含20000多个条目，每个条目至少需要8个二进制位进行编码。对于小型设备，有一个比二维数组更加高效的编码方法是很重要的。我们将简短地描述一些可以用于压缩LR语法分析表中的ACTION字段和GOTO字段的技术。

一个可用于压缩动作字段的技术所基于的原理是动作表中通常有很多相同的行。比如，图4-42中的状态0和3就有相同的动作条目，状态2和6也是这样。因此，如果我们为每个状态创建一个指向一维数组的指针，我们就可以节省可观的空间，而付出的时间代价却很小。具有相同动作的状态的指针指向相同的位置。为了从这个数组获取信息，我们给各个终结符号赋予一个编号，编号范围为从零开始到终结符号总数减一。对于每个状态，这个整数编号将作为从指针值开始的偏移量。在一个给定的状态中，第i个终结符号对应的语法分析动作可以在该状态的指针值之后的第i个位置上找到。

如果为每个状态创建一个动作列表，我们可以获得更高的空间效率，但语法分析器会变慢。这个列表由（终结符号，动作）对组成。一个状态的最频繁的动作可以放在列表的结尾处，并且我们可以在这个对中原本放终结符号的地方放上符号“any”，表示如果没有在列表中找到当前输入，那么不管这个输入是什么，我们都选择这个动作。不仅如此，为了使得一行中的内容更加一致，我们可以把报错条目安全地替换为规约动作。对错误的检测会稍有延后，但仍可以在执行下一个移入动作之前发现错误。

例4.65　考虑图4-37的语法分析表。首先，请注意状态0、4、6和7的动作是相同的。我们可以用下面的列表来表示它们：

![191-1](../Images/image04253.jpeg)

状态1有一个类似的列表：

![191-2](../Images/image04254.jpeg)

在状态2中，我们可以把报错条目替换为r2，因此对于除*之外的输入都按照产生式2进行归约。因此状态2的列表是

![191-3](../Images/image04255.jpeg)

状态3只有报错和r4条目。我们可以把前者替换为后者，因此状态3的列表只有一个对（any，r4）。状态5、10和11也可以做类似处理。状态8的列表是

![191-4](../Images/image04256.jpeg)

而状态9的列表是

![192-1](../Images/image04257.jpeg)

我们也可以把GOTO表编码为一个列表，但这里更加高效的方法是为每个非终结符号A构造一个数对的列表。A的列表中的每个对形如（当前状态，下一状态），表示

GOTO［当前状态，A］= 下一状态

这个技术很有用，因为GOTO表的一列中常常只有很少几个状态。原因是对于某个非终结符号A上的GOTO目标状态的项集中必然存在某些项，这些项中A紧靠在点的左边。对于任意两个不同的文法符号X、Y，没有哪个GOTO目标项集既有点左边为X的项，又有点左边为Y的项。因此，每个状态最多只出现在GOTO表的一列中。

为了进一步减少使用的空间，我们注意到GOTO表中的报错条目从来都不会被查询到。因此，我们可以把每个报错条目替换为该列中最常用的非报错条目。这个条目变成了默认选择。在每一列的列表中，它被表示为一个“当前状态”字段为any的对。

例4.66　再次考虑图4-37。F对应的列中与状态7对应的条目是10，所有其他的条目所对应的要么是3要么报错。我们可以用3来替换报错条目，为F列创建列表

![192-2](../Images/image04258.jpeg)

类似地，T列的列表可以是

![192-3](../Images/image04259.jpeg)

对于E列，我们可以选择1或8作为默认选择。这两种选择都需要两个列表条目。比如，我们可以为E列创建如下列表

![192-4](../Images/image04260.jpeg)

这些小例子中体现出来的空间节省效果可能具有误导性。因为在这个例子和前一个例子中创建的列表中的条目数量，再加上从状态到动作列表的指针以及从非终结符号到后继状态表的指针，它们需要的空间和图4-37中的矩阵实现方法相比，并没有令人印象深刻的空间节省效果。但是对于现实中的文法，列表表示法所需要的空间通常比矩阵表示法所需空间少10%。在3.9.8节中讨论的用于有穷自动机的表压缩方法也可以用来表示LR语法分析表。