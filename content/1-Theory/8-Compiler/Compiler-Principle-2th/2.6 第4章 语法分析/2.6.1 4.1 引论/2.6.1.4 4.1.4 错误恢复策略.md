### 4.1.4　错误恢复策略

当检测到一个错误时，语法分析器应该如何恢复？虽然还没有哪个策略能够证明自己是被普遍接受的，但有一些方法的适用范围很广。最简单的方法是让语法分析器在检测到第一个错误时给出错误提示信息，然后退出。如果语法分析器能够把自己恢复到某个状态，且有理由预期从那里开始继续处理输入将提供有意义的诊断信息，那么它通常会发现更多的错误。如果错误太多，那么最好让编译器在超过某个错误数量上界之后停止分析。这样做要比让编译器产生大量恼人的“可疑”错误信息更好。

恐慌模式的恢复

使用这个方法时，语法分析器一旦发现错误就不断丢弃输入中的符号，一次丢弃一个符号，直到找到同步词法单元（synchronizing token）集合中的某个元素为止。同步词法单元通常是界限符，比如分号或者}。它们在源程序中的作用是清晰、无二义的。编译器的设计者必须为源语言选择适当的同步词法单元。恐慌模式的错误纠正方法常常会跳过大量输入，不检查被跳过部分的其他错误。但是它很简单，并且能够保证不会进入无限循环。我们稍后考虑的某些方法则不一定能保证不进入无限循环。

短语层次的恢复

当发现一个错误时，语法分析器可以在余下的输入上进行局部性纠正。也就是说，它可能将余下输入的某个前缀替换为另一个串，使语法分析器可以继续分析。常用的局部纠正方法包括将一个逗号替换为分号、删除一个多余的分号或者插入一个遗漏的分号。如何选择局部纠正方法是由编译器设计者决定的。当然，我们必须小心选择替换方法，以避免进入无限循环。比如，如果我们总是在当前输入符号之前插入符号，就会出现无限循环。

短语层次替换方法已经在多个错误修复型编译器中使用，它可以纠正任何输入串。它主要的不足在于它难以处理实际错误发生在被检测位置之前的情况。

错误产生式

通过预测可能遇到的常见错误，我们可以在当前语言的文法中加入特殊的产生式。这些产生式能够产生含有错误的构造，从而基于增加了错误产生式的文法构造得到一个语法分析器。如果语法分析过程中使用了某个错误产生式，语法分析器就检测到了一个预期的错误。语法分析器能够据此生成适当的错误诊断信息，指出在输入中识别出的错误构造。

全局纠正

在理想情况下，我们希望编译器在处理一个错误输入串时通过最少的改动将其转化为语法正确的串。有些算法可以选择一个最小的改动序列，得到开销最低的全局性纠正方法。给定一个不正确的输入x和文法G，这些算法将找出一个相关串y的语法分析树，使得将x转换为y所需要的插入、删除和改变的词法单元的数量最少。遗憾的是，从时间和空间的角度看，实现这些方法一般来说开销太大，因此这些技术当前仅具有理论价值。

请注意，一个最接近正确的程序可能并不是程序员想要的程序。不管怎样，最低开销纠正的概念仍然提供了一个可用于评价错误恢复技术的指标，并已经用于为短语层次的恢复寻找最佳替换串。