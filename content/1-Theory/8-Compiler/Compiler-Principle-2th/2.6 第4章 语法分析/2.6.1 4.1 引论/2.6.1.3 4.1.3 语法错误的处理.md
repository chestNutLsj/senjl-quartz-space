### 4.1.3　语法错误的处理

本节的其余部分将考虑语法错误的本质以及错误恢复的一般策略。其中的两种策略分别称为恐慌模式和短语层次恢复。它们将和特定的语法分析方法一起详细讨论。

如果编译器只处理正确的程序，那么它的设计和实现将会大大简化。但是，人们还期望编译器能够帮助程序员定位和跟踪错误。因为不管程序员如何努力，程序中难免会有错误。令人惊奇的是，虽然错误如此常见，但很少有语言在设计的时候就考虑到错误处理问题。如果我们的口语也像计算机语言那样对语法精确性有要求，那么我们的文明就会大不相同。大部分程序设计语言的规范没有规定编译器应该如果处理错误；错误处理方法由编译器的设计者决定。从一开始就计划好如何进行错误处理不仅可以简化编译器的结构，还可以改进错误处理方法。

程序可能有不同层次的错误。

- 词法错误，包括标识符、关键字或运算符拼写错误（比如把标识符`ellipseSize`写成`elipseSize`）和没有在字符串文本上正确地加上引号。
- 语法错误，包括分号放错地方、花括号，即“{”或“}”，多余或缺失。另一个C语言或Java语言中的语法错误的例子是一个`case`语句的外围没有相应的`switch`语句（然而，语法分析器通常允许这种情况出现，当编译器在之后要生成代码时才会发现这个错误）。
- 语义错误，包括运算符和运算分量之间的类型不匹配。例如，返回类型为`void`的某个Java方法中出现了一个返回某个值的`return`语句。
- 逻辑错误，可以是因程序员的错误推理而引起的任何错误。比如在一个C程序中应该使用比较运算符==的地方使用了赋值运算符=。这样的程序可能是良构的，但是却没有正确反映出程序员的意图。

语法分析方法的精确性使得我们可以非常高效地检测出语法错误。有些语法分析方法，比如LL和LR方法，能够在第一时间发现错误。也就是说，当来自词法分析器的词法单元流不能根据该语言的文法进一步分析时就会发现错误。更精确地讲，它们具有可行前缀特性（viable-prefix property），也就是说，一旦它们发现输入的某个前缀不能够通过添加一些符号而形成这个语言的串，就可以立刻检测到语法错误。

要重视错误恢复的另一个原因是，不管产生错误的原因是什么，很多错误都以语法错误的方式出现，并且在不能继续进行语法分析时暴露出来。有些语义错误（比如类型不匹配）也可以被高效地检测到。然而，总的来说，在编译时精确地检测出语义错误和逻辑错误是很困难的。

语法分析器中的错误处理程序的目标说起来很简单，但实现起来却很有挑战性：

- 清晰精确地报告出现的错误。
- 能很快地从各个错误中恢复，以继续检测后面的错误。
- 尽可能少地增加处理正确程序时的开销。

幸运的是，常见的错误都很简单，使用相对直接的错误处理机制就足以达到目标。

一个错误处理程序应该如何报告出现的错误？至少，它必须报告在源程序的什么位置检测到错误，因为实际的错误很可能就出现在这个位置之前的几个词法单元处。一个常用的策略是打印出有问题的那一行，然后用一个指针指向检测到错误的地方。