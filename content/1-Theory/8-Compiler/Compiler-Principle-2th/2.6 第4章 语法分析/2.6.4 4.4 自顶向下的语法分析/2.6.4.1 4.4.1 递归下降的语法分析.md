### 4.4.1　递归下降的语法分析

一个递归下降语法分析程序由一组过程组成，每个非终结符号有一个对应的过程。程序的执行从开始符号对应的过程开始，如果这个过程的过程体扫描了整个输入串，它就停止执行并宣布语法分析成功完成。图4-13显示了对应于某个非终结符号的典型过程的伪代码。请注意，这个伪代码是不确定的，因为它没有描述如何在开始时刻选择A产生式。

通用的递归下降分析技术可能需要回溯。也就是说，它可能需要重复扫描输入。然而，在对程序设计语言的构造进行语法分析时很少需要回溯，因此需要回溯的语法分析器并不常见。即使在自然语言语法分析这样的场合，回溯也不是很高效，因此人们更加倾向于基于表格的方法，比如练习4.4.9中的动态程序规划算法或者Earley方法（参见参考文献）。

要支持回溯，就需要修改图4-13的代码。首先，因为我们不能在第1行选定唯一的A产生式，我们必须按照某个顺序逐个尝试这些产生式。那么，第7行上的失败并不意味着最终失败，而仅仅是建议我们返回到第1行并尝试另一个A产生式。只有当再也没有A产生式可尝试时，我们才会宣称找到了一个输入错误。为了尝试另一个A产生式，我们需要把输入指针重新设置到我们第一次到达第1行时的位置。因此，需要一个局部变量来保存这个输入指针，以供将来回溯时使用。

![154-1](../Images/image04178.jpeg)

图4-13　在自顶向下语法分析器中一个非终结符号对应的典型过程

例4.29　考虑文法

S→c A d

A→a b | a

在自顶向下地构造输入串w=cad的语法分析树时，初始的语法分析树只包含一个标号为S的结点，输入指针指向c，即w的第一个符号。S只有一个产生式，因此我们用它来展开S，得到图4-14a中的树。最左边的叶子结点的标号为c，它和输入w的第一个符号匹配，因此我们将输入指针推进到a，即w的第二个符号，并考虑下一个标号为A的叶子结点。

![154-2](../Images/image04179.jpeg)

图4-14　一个自顶向下语法分析过程的步骤

现在我们使用第一个A产生式A→ab来展开A，得到图4-14b所示的树。第二个输入符号a得到匹配，因此我们将输入指针推进到d，即第三个输入符号，并将d和下一个叶子结点（标号为b）比较。因为b和d不匹配，我们报告失败，并回到A，查看是否还有尚未尝试过、但有可能匹配的其他A产生式。

在回到A时，我们必须把输入指针重新设置到位置2，即我们第一次尝试展开A时该指针指向的位置。这意味着A的过程必须将输入指针存放在一个局部变量中。

A的第二个选项产生了图4-11c所示的树。叶子结点a和w的第二个符号匹配，叶子结点d和第三个符号相匹配。因为我们已经产生了一棵w的语法分析树，所以我们停止分析并宣称已成功完成了语法分析。

一个左递归的文法会使它的递归下降语法分析器进入一个无限循环。即使是带回溯的语法分析器也是如此。也就是说，当我们试图展开一个非终结符号A的时候，我们可能会没有读入任何输入符号就再次试图展开A。