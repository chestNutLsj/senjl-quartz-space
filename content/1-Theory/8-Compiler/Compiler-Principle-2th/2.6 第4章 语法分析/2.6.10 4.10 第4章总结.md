## 4.10　第4章总结

● 语法分析器。语法分析器的输入是来自词法分析器的词法单元序列。它将词法单元的名字作为一个上下文无关文法的终结符号。然后，语法分析器为它的词法单元输入序列构造出一棵语法分析树。可以象征性地构造这棵语法分析树（即仅仅遍历相应的推导步骤），也可以显式生成分析树。

● 上下文无关文法。一个文法描述了一个终结符号集合（输入），另一个非终结符号集合（表示语法构造的符号）和一组产生式。每个产生式说明了如何从一些部件构造出某个非终结符号所代表的符号串。这些部件可以是终结符号，也可以是另外一些非终结符号所代表的串。一个产生式由头部（将被替换的非终结符号）和产生式体（用来替换的文法符号串）组成。

● 推导。从文法的开始非终结符号出发，不断将某个非终结符号替换为它的某个产生式体的过程称为推导。如果总是替换最左（最右）的非终结符号，那么这个推导就称为最左推导（最右推导）。

● 语法分析树。一棵语法分析树是一个推导的图形表示。在推导中出现的每一个非终结符号都在树中有一个对应结点。一个结点的子结点就是在推导中用来替换该结点对应的非终结符号的文法符号串。在同一终结符号串的语法分析树、最左推导、最右推导之间存在一一对应关系。

● 二义性。如果一个文法的某些终结符号串有两棵或多棵语法分析树，或者等价地说有两个或多个最左推导/最右推导，那么这个文法就称为二义性文法。在实践中的大多数情况下，我们可以对一个二义性文法进行重新设计，使它变成一个描述相同语言的无二义性文法。然而，有时使用二义性文法并应用一些技巧可以得到更加高效的语法分析器。

● 自顶向下和自底向上语法分析。语法分析器通常可以按照它们的工作方式分为自顶向下的（从文法的开始符号出发，从顶部开始构造语法分析树）和自底向上的（从构成语法分析树叶子结点的终结符号串开始，从底部开始构造语法分析树）。自顶向下的语法分析器包括递归下降语法分析器和LL语法分析器，而最常见的自底向上语法分析器是LR语法分析器。

● 文法的设计。和自底向上语法分析器使用的文法相比，适合进行自顶向下语法分析的文法通常较难设计。我们必须要消除文法的左递归，即一个非终结符号推导出以这个非终结符号开头的符号串的情况。我们还必须提取左公因子——也就是对同一个非终结符号的具有相同的产生式体前缀的多个产生式进行分组。

● 递归下降语法分析器。这些分析器对每个非终结符号使用一个过程。这个过程查看它的输入并确定应该对它的非终结符号应用哪个产生式。相应产生式体中的终结符号在适当的时候和输入中的符号进行匹配，而产生式体中的非终结符号则引发对它们的过程的调用。当选择了错误的产生式时，有可能需要进行回溯。

● LL（1）语法分析器。对于一个文法，如果只需要查看下一个输入符号就可以选择正确的产生式来扩展一个给定的非终结符号，那么这个文法就称为是LL（1）的。这类文法允许我们构造出一个预测语法分析表。对于每个非终结符号和每个向前看符号，这个表指明了应该选择哪个产生式。在某些或所有没有合法产生式的空条目中放置错误处理例程有助于实现错误恢复。

● 移入-归约语法分析技术。自底向上语法分析器一般按照如下方式运行：根据下一个输入符号（向前看符号）和栈中的内容，选择是将下一个输入移入栈中，还是将栈顶部的某些符号进行归约。归约步骤将栈顶部的一个产生式体替换为这个产生式的头。

● 可行前缀。在移入-归约语法分析过程中，栈中的内容总是一个可行前缀——也就是某个最右句型的前缀，且这个前缀的结尾不会比这个句型的句柄的结尾更靠右。句柄是在这个句型的最右推导过程中在最后一步加入此句型中的子串。

● 有效项。在一个产生式的体中某处加上一个点就得到一个项。一个项对某个可行前缀有效的条件是该项的产生式被用来生成该可行前缀对应的句型的句柄，且这个可行前缀中包括项中位于点左边的所有符号，但是不包含点右边的任何符号。

● LR语法分析器。每一种LR语法分析器都首先构造出各个可行前缀的有效项的项集（称为LR状态），并且在栈中跟踪每个可行前缀的状态。有效项集合引导语法分析器做出移入-归约决定。如果项集中某个有效项的点在产生式体的最右端，那么我们就进行归约；如果下一个输入符号出现在某个有效项的点的右边，我们就会把向前看符号移入栈中。

● 简单LR语法分析器。在一个SLR语法分析器中，我们按照某个点在最右端的有效项进行归约的条件是：向前看符号能够在某个句型中跟在该有效项对应的产生式的头符号的后面。如果没有语法分析动作冲突，那么这个文法就是SLR的，就可以应用这个方法。所谓没有语法分析动作冲突，就是说对于任意项集和任意向前看符号，都不存在两个要归约的产生式，也不会同时存在归约或移入的可选动作。

● 规范LR语法分析器。这是一种更复杂的LR语法分析器。它使用的项中增加了一个向前看符号集合。当应用这个产生式进行归约时，下一个输入符号必须在这个集合中。只有当存在一个点在最右端的有效项，并且当前的向前看符号是这个项允许的向前看符号之一时，我们才可以决定按照这个项的产生式进行归约。一个规范LR语法分析器可以避免某些在SLR语法分析器中出现的分析动作冲突，但是它的状态常常会比同一个文法的SLR语法分析器的状态更多。

● 向前看LR语法分析器。LALR语法分析器同时具有SLR语法分析器和规范LR语法分析器的很多优点。它将具有相同核心（忽略了相关向前看符号集合之后的项的集合）的状态合并到一起。因此，它的状态数量和SLR语法分析器的状态数量相同，但是在SLR语法分析器中出现的某些语法分析动作冲突不会出现在LALR语法分析器中。LALR语法分析器是实践中经常选择的方法。

● 二义性文法的自底向上语法分析。在很多重要的场合下，比如对算术表达式进行语法分析时，我们可以使用二义性文法，并利用一些附加的信息，比如运算符的优先级，来解决移入和归约之间的冲突，或者两个不同产生式之间的归约冲突。这样，LR语法分析技术就被扩展应用于很多二义性文法中。

● Yacc。语法分析器生成工具Yacc以一个（可能的）二义性文法以及冲突解决信息作为输入，构造出LALR状态集合。然后，它生成一个使用这些状态来进行自底向上语法分析的函数。该函数在执行每一个归约动作时都会调用和相应产生式关联的函数。