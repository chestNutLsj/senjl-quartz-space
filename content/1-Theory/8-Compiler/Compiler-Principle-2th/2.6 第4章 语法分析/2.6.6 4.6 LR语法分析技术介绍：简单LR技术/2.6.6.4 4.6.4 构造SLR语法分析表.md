### 4.6.4　构造SLR语法分析表

构造语法分析表的SLR构造方法是研究LR语法分析技术的很好的起点。我们把使用这种方法构造得到的语法分析表称为SLR语法分析表，并把使用SLR语法分析表的LR语法分析器称为SLR语法分析器。另外两种SLR方法通过向前看信息来增强分析能力。

SLR方法以4.5节介绍的LR（0）项和LR（0）自动机为基础。也就是说，给定一个文法G，我们通过添加新的开始符号S′得到增广文法G′。我们根据G′构造出G′的规范项集族C以及GOTO函数。

然后，使用下面的算法就可以构造出这个语法分析表中的ACTION和GOTO条目。它要求我们知道输入文法的每个非终结符号A的FOLLOW（A）（见4.4节）。

算法4.46　构造一个SLR语法分析表。

输入：一个增广文法G′。

输出：G′的SLR语法分析表函数ACTION和GOTO。

方法：

1）构造G′的规范LR（0）项集族C={I0，I1，…，In}。

2）根据Ii构造得到状态i。状态i的语法分析动作按照下面的方法决定：

① 如果［A→α·aβ］在Ii中并且GOTO（Ii，a）=Ij，那么将ACTION［i，a］设置为“移入j”。这里a必须是一个终结符号。

② 如果［A→α·］在Ii中，那么对于FOLLOW（A）中的所有a，将ACTION［i，a］设置为“归约A→α”。这里A不等于S′。

③ 如果［S′→S·］在Ii中，那么将ACTION［i，$］设置为“接受”。

如果根据上面的规则生成了任何冲突动作，我们就说这个文法不是SLR（1）的。在这种情况下，这个算法无法生成一个语法分析器。

3）状态i对于各个非终结符号A的GOTO转换使用下面的规则构造得到：如果GOTO（Ii，A）=Ij，那么GOTO［i，A］=j。

4）规则（2）和（3）没有定义的所有条目都设置为“报错”。

5）语法分析器的初始状态就是根据［S′→·S］所在项集构造得到的状态。

由算法4.46得到的由ACTION函数和GOTO函数组成的语法分析表被称为文法G的SLR（1）分析表。使用G的SLR（1）分析表的LR语法分析器称为G的SLR（1）语法分析器。一个具有SLR（1）语法分析表的文法被称为是SLR（1）的。我们常常省略“SLR”后面的“（1）”，因为我们不会在这里处理向前看多个符号的语法分析器。

例4.47　让我们为增广表达式文法构造SLR分析表。这个文法的规范LR（0）项集族如图4-31所示。首先考虑项集I0：

E′→·E

E→·E + T

E→·T

T→·T * F

T→·F

F→·（E）

F→· id

其中的项F→·（E）使得条目ACTION［0，（］=移入4，项F→·id使得条目ACTION［0，id］=移入5。I0中的其他项没有生成动作。现在考虑I1：

E′→E·

E→E· + T

第一个项使得ACTION［1，$］=接受，第二个项使得ACTION［1，+］=移入6。下一步考虑I2：

E→T·

T→T· * F

因为FOLLOW（E）= {$，+，）}，第一个项使得

ACTION［2，$］= ACTION［2，+］= ACTION［2，）］= 归约E→T

第二个项使得ACTION［2，*］= 移入7。按照这个方式继续推导，我们就得到了图4-37所示的ACTION和GOTO表。在该图中，归约动作中的产生式编号和它们在原文法（4.1）中的出现顺序相同。也就是说，E→E+T的编号为1，E→T的编号为2，依此类推。

例4.48　每个SLR（1）文法都是无二义性的，但是存在很多不是SLR（1）的无二义性文法。考虑包含下列产生式的文法：

S→L = R | R

L→* R | id　（4.49）

R→L

将L和R分别看作代表左值和右值的文法符号，将*看作是代表“左值所指向的内容”的运算符[^5]。文法4.49对应的规范LR（0）项集族显示在图4-39中。

![177-1](../Images/image04232.jpeg)

图4-39　文法（4.49）对应的规范LR（0）项集族

考虑项集I2。这个项集中的第一个项使得ACTION［2，=］是“移入6”。因为FOLLOW（R）包含=（考虑推导过程S⇒L=R⇒*R=R即可知原因），第二个项将ACTION［2，=］设置为“归约R→L”。因为在ACTION［2，=］中既存在移入条目又存在归约条目，所以状态2在输入符号=上存在移入/归约冲突。

文法（4.49）不是二义性的。产生移入/归约冲突的原因是构造SLR分析器的方法功能不够强大，不能记住足够多的上下文信息。因此当它看到一个可归约为L的串时，不能确定语法分析器应该对输入=采取什么动作。接下来讨论的规范LR方法和LALR方法将可以成功地处理更大的文法类型，包括文法（4.49）。然而请注意，存在一些无二义性的文法使得每种LR语法分析器构造方法都会产生带有语法分析动作冲突的语法分析动作表。幸运的是，在处理程序设计语言时，一般都可以避免使用这样的文法。