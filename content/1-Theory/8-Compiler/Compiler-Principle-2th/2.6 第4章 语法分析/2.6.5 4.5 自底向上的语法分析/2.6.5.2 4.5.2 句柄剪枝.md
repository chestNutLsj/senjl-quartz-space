   

### 4.5.2　句柄剪枝

对输入进行从左到右的扫描，并在扫描过程中进行自底向上语法分析，就可以反向构造出一个最右推导。非正式地讲，“句柄”是和某个产生式体匹配的子串，对它的归约代表了相应的最右推导中的一个反向步骤。

比如，在按照表达式文法（4.1）对id1 * id2进行语法分析时，各个句柄如图4-26所示。为了表示得更清楚，我们为其中的词法单元id加上了下标。虽然T是产生式E→T的体，但符号T并不是句型T*id2的一个句柄。假如T真的被替换为E，我们将得到串E*id2，而这个串不能从开始符号E推导得到。因此，和某个产生式体匹配的最左子串不一定是句柄。

![164-2](../Images/image04205.jpeg)

正式地讲，如果有![164-1](../Images/image04206.jpeg)（如图4-27所示），那么紧跟α的产生式A→β是αβw的一个句柄（handle）。换句话说，最右句型γ的一个句柄是满足下述条件的产生式A→β及串β在γ中出现的位置：将这个位置上的β替换为A之后得到的串是γ的某个最右推导序列中出现在位于γ之前的最右句型。

![165-2](../Images/image04207.jpeg)

图4-27　αβw的语法分析树中的一个句柄A→β

请注意，句柄右边的串w一定只包含终结符号。为方便起见，我们把产生式体β（而不是A→β）称为一个句柄。注意，我们说的是“一个句柄”，而不是“唯一句柄”。这是因为文法可能是二义性的，αβw可能存在多个最右推导。如果一个文法是无二义性的，那么该文法的每个右句型都有且只有一个句柄。

通过“句柄剪枝”可以得到一个反向的最右推导。也就是说，我们从被分析的终结符号串w开始。如果w是当前文法的句子，那么令w=γn，其中γn是某个未知最右推导的第n个最右句型。

![165-1](../Images/image04208.jpeg)

为了以相反顺序重构这个推导，我们在γn中寻找句柄βn，并将βn替换为相关产生式An→βn的头部，得到前一个最右句型γn-1。请注意，我们现在还不知道如何发现句柄，但是我们很快就会介绍多个寻找句柄的方法。

然后我们重复这个过程。也就是说，我们在γn-1中寻找句柄βn-1，并对这个句柄进行归约，得到最右句型γn-2。如果我们按照这个过程得到了一个只包含开始符号S的最右句型，那么就可以停止分析并宣称语法分析过程成功完成。将归约过程中用到的产生式反向排序，就得到了输入串的一个最右推导过程。