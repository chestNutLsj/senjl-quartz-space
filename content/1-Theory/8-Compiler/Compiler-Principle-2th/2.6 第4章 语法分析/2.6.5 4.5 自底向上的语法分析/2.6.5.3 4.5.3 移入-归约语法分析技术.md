### 4.5.3　移入-归约语法分析技术

移入-归约语法分析是自底向上语法分析的一种形式。它使用一个栈来保存文法符号，并用一个输入缓冲区来存放将要进行语法分析的其余符号。我们将看到，句柄在被识别之前，总是出现在栈的顶部。

我们使用$来标记栈的底部以及输入的右端。按照惯例，在讨论自底向上语法分析的时候，我们将栈顶显示在右侧，而不是像在自顶向下语法分析中那样显示在左侧。如下所示，开始的时候栈是空的，并且输入串w存放在输入缓冲区中。

![165-3](../Images/image04209.jpeg)

在对输入串的一次从左到右扫描过程中，语法分析器将零个或多个输入符号移到栈的顶端，直到它可以对栈顶的一个文法符号串β进行归约为止。它将β归约为某个产生式的头。语法分析器不断地重复这个循环，直到它检测到一个语法错误，或者栈中包含了开始符号且输入缓冲区为空为止：

![165-4](../Images/image04210.jpeg)

当进入这样的格局时，语法分析器停止运行，并宣称成功完成了语法分析。图4-28显示了一个移入-归约语法分析器在按照表达式文法（4.1）对输入串id1 *id2进行语法分析时可能采取的动作。

![165-5](../Images/image04211.jpeg)

图4-28　一个移入-归约语法分析器在处理输入id1*id2时经历的格局

虽然主要的语法分析操作是移入和归约，但实际上一个移入-归约语法分析器可采取如下四种可能的动作：①移入，②归约，③接受，④报错。

1）移入（shift）：将下一个输入符号移到栈的顶端。

2）归约（reduce）：被归约的符号串的右端必然是栈顶。语法分析器在栈中确定这个串的左端，并决定用哪个非终结符号来替换这个串。

3）接受（accept）：宣布语法分析过程成功完成。

4）报错（error）：发现一个语法错误，并调用一个错误恢复子例程。

我们之所以能够在移入-归约语法分析中使用栈，是因为这个分析过程具有如下重要性质：句柄总是出现在栈的顶端，绝不会出现在栈的中间。要证明这个性质，我们只需要考虑任意最右推导中的两个连续步骤可能具有的形式。图4-29演示了两种可能的情况。在情况（1）中，A被替换为βBy，然后产生式体βBy中最右非终结符号B被替换为γ。在情况（2）中，A仍然首先被展开，但这次使用的产生式体y中只包含终结符号。下一个最右非终结符号B将位于y左侧的某个地方。

![166-1](../Images/image04212.jpeg)

图4-29　一个最右推导中两个连续步骤的两种情况

换句话说：

![166-2](../Images/image04213.jpeg)

反向考虑情况（1），即一个移入-归约语法分析器刚刚到达如下格局的情况：

![166-3](../Images/image04214.jpeg)

语法分析器将句柄γ归约为B，从而到达如下格局：

![166-4](../Images/image04215.jpeg)

现在，语法分析器可以通过零次或多次移入动作，把串y移入到栈的上方，得到如下格局：

![166-5](../Images/image04216.jpeg)

其中，句柄βBy位于栈顶，它将被归约为A。

现在考虑情况（2）。在格局

![166-6](../Images/image04217.jpeg)

中，句柄γ位于栈顶。将句柄γ归约为B之后，语法分析器可以把串xy移入栈中，得到位于栈顶的下一个句柄y。该句柄可以被归约为A：

![166-7](../Images/image04218.jpeg)

在这两种情况下，语法分析器在进行一次归约之后，都必须接着移入零个或多个符号才能在栈顶找到下一个句柄。因此它从不需要到栈中间去寻找句柄。