### 3.4.3　完成我们的例子

我们在图3-14中看到，id的状态转换图有一个简单的结构。由状态9开始，它检查被识别的词素是否以一个字母开头，如果是的话进入状态10。只要接下来的输入包含字母或数位，我们就一直停留在状态10。当我们第一次遇到不是字母或数位的其他任何字符时，便转入状态11并接受刚刚找到的词素。因为最后一个字符并不是标识符的一部分，我们必须将输入回退一个位置，并且如3.4.2节所讨论的那样，我们将已经找到的标识符加入到符号表中，并判断我们得到的究竟是一个关键字还是一个真正的标识符。

图3-16显示了词法单元number的状态转换图，它是我们至今为止看到的最复杂的状态转换图。从状态12开始，如果我们看到一个数位，就转入状态13。在该状态，我们可以读入任意数量的其他数位。然而，如果我们看到了一个不是数位、不是小数点，也不是E的其他字符，就得到了一个整数形式的数字，如`123`。这种情形在进入状态20时进行处理，我们在该状态返回词法单元number以及一个指向常量表条目的指针，刚刚找到的词素便放在这个常量表条目中。这些机制并没有在这个转换图中显示出来，但它们和我们处理标识符的方法相似。

![099-1](../Images/image04071.jpeg)

图3-16　无符号数字的状态转换图

如果我们在状态13看到的是一个小数点，那么我们就看到一个“可选的小数部分”。于是，进入状态14，并寻找一个或多个更多的数位，状态15就被用于此目的。如果我们看到一个E，那么我们就看到了一个“可选的指数部分”，它的识别任务由状态16～19完成。如果我们在状态15看到的是不同于`E`和数位的其他字符，那么我们就到达了小数部分的结尾，这个数字没有指数部分，我们将通过状态21返回刚刚找到的词素。

最后一个状态转换图显示在图3-17中，它用于识别空白符。在该图中，我们寻找一个或多个空白字符，在图中用delim表示。典型的空白字符有空格、制表符、换行符，有可能包括那些根据语言设计不可能出现在任何词法单元中的字符。

![099-2](../Images/image04072.jpeg)

图3-17　空白符的状态转换图

注意，我们在状态24中找到了一个连续的空白字符组成的块，且后面还跟随一个非空白字符。我们将输入回退到这个非空白符的开头，但我们并不向语法分析器返回任何词法单元。相反，我们必须在这个空白符之后再次启动词法分析过程。