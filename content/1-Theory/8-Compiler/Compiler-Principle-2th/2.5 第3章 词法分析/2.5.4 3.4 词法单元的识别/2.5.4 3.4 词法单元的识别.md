## 3.4　词法单元的识别

上一节介绍了如何使用正则表达式来表示一个模式。现在，我们必须学习如何根据各个需要识别的词法单元的模式来构造出一段代码。这段代码能够检查输入字符串，并在输入的前缀中找出一个和某个模式匹配的词素。我们的讨论将围绕下面的例子展开。

例3.8　图3-10的文法片段描述了分支语句和条件表达式的一种简单形式。这个语法和Pascal语言的语法类似，它的then关键字显式地出现在条件表达式的后面。对于relop，我们使用Pascal或SQL语言中的比较运算符，其中＝表示“相等”，<>表示“不相等”，因为它们呈现了一种有意思的词素结构。

![096-1](../Images/image04064.jpeg)

图3-10　分支语句的文法

在考虑词法分析器时，文法的终结符号，包括if、then、else、relop、id及number，都是词法单元的名字。这些词法单元的模式使用图3-11中的正则定义来描述。其中id和number的模式和我们之前在例3.7中看到的模式类似。

![096-2](../Images/image04065.jpeg)

图3-11　例3.8中词法单元的模式

对这个语言，词法分析器将识别关键字if、then、else以及和relop、id和num的模式匹配的词素。为了简化问题，我们做出如下的常见假设：关键字也是保留字。也就是说，它们不是标识符，虽然它们的词素和标识符的模式匹配。

此外，我们还让词法分析器负责消除空白符，方法是让它识别如下定义的“词法单元”ws。

![096-4](../Images/image04066.jpeg)

这里，blank、tab及newline是用于表示具有同样名字的ASCII字符的抽象符号。词法单元ws同其他的词法单元的不同之处在于：当我们识别到ws时，我们并不将它返回给语法分析器，而是从这个空白之后的字符开始继续进行词法分析。返回给语法分析器的是下一个词法单元。

图3-12总结了词法分析器的目标。对于各个词素或词素的集合，该表显示了应该将哪个词法单元名返回给语法分析器，以及按照3.1.3节中的介绍，应该返回什么属性值。请注意，对于其中的6个关系运算符，符号常量`LT、LE`等被当作属性值返回，其目的是指明我们发现的是词法单元relop的哪个实例。找到的运算符将影响编译器输出的代码。

![096-3](../Images/image04067.jpeg)

图3-12　词法单元、它们的模式以及属性值