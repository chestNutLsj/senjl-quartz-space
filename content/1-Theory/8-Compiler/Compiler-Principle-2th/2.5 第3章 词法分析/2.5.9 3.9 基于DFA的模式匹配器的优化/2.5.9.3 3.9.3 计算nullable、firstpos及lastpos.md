### 3.9.3　计算nullable、firstpos及lastpos

我们可以使用一个对树的高度直接进行递归的过程来计算nullable、firstpos和lastpos。在图3-58中总结了计算nullable和firstpos的基本规则和归纳规则。计算lastpos的规则在本质上和计算firstpos的规则相同，但是在针对cat结点的规则中，子结点c1和c2的角色需要对调。

![126-1](../Images/image04126.jpeg)

图3-58　计算nullable和firstpos的规则

例3.34　在图3-56的语法树的所有结点中，只有星号结点是可为空的。由图3-58可知，图中的所有叶子结点都是不可为空的，因为它们都对应于非∈运算分量。图3-56中的or结点是不可为空的，因为它的子结点都不可为空。图中的star-结点是可空的，因为这是star结点的特征之一。最后，图3-56中的所有cat结点（至少包含一个不可为空的子结点）都是不可为空的。

对各个结点的firstpos和lastpos的计算结果显示在图3-59中，其中，firstpos（n）显示在结点n的左边，lastpos（n）显示在结点右边。每个叶子结点的firstpos和lastpos只包含它自身，这是由图3-58中关于非∈叶子结点的规则决定的。图3-56中的or结点的firstpos和lastpos分别是它的所有子结点的firstpos和lastpos的并集。针对star结点的规则是，它的firstpos及lastpos分别是它的唯一子结点的firstpos和lastpos。

![127-1](../Images/image04127.jpeg)

图3-59　（a|b）*abb#的语法分析树的结点的firstpos和lastpos

最后考虑最下面的cat-结点，我们将把这个结点称为n。要计算firstpos（n），我们首先考虑其左边的运算分量是否可为空。在这个例子里面，左运算分量可以为空，因此，n的firstpos是它的各个子结点的firstpos的并集，也就是{1，2}∪{3}={1，2，3}。图3-58中没有明确说明lastpos的运算规则，但是前面提到过，它的规则和firstpos的规则相同，只是需要互换子结点的角色。也就是说，要计算lastpos（n），我们需要知道它的右子结点（位置为3的叶子结点）是否可为空。它不可为空，因此lastpos（n）就是它的右子结点的lastpos，即{3}。