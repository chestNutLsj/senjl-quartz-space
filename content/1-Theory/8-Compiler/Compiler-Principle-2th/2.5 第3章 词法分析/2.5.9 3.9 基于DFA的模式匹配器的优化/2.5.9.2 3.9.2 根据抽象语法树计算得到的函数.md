### 3.9.2　根据抽象语法树计算得到的函数

要从一个正则表达式直接构造出DFA，我们要首先构造它的抽象语法树，然后计算如下四个函数：nullable、firstpos、lastpos和followpos。每个函数的定义都用到了一个特定增广正则表达式（r）#的抽象语法树。

1）nullable（n）对于一个抽象语法树结点n为真当且仅当此结点代表的子表达式的语言中包含空串∈。也就是说，这个子表达式可以“生成空串”或者本身就是空串，即使它也可能表示一些其他的串。

2）firstpos（n）定义了以结点n为根的子树中的位置集合。这些位置对应于以n为根的子表达式的语言中某个串的第一个符号。

3）lastpos（n）定义了以结点n为根的子树中的位置集合。这些位置对应于以n为根的子表达式的语言中某个串的最后一个符号。

4）followpos（p）定义了一个和位置p相关的、抽象语法树中的某些位置的集合。一个位置q在followpos（p）中当且仅当存在L（（r）#）中的某个串x=a1a2…an，使得我们在解释为什么x属于L（（r）#）时，可以将x中的某个ai和抽象语法树中的位置p匹配，且将位置ai+1和位置q匹配。

例3.33　考虑图3-56中对应于表达式（a|b）*a的cat结点n。我们说nullable（n）= false，因为这个结点生成所有以a结尾的由a、b组成的串；它不生成空串∈。而另一方面，它下面的star结点是可以为空，它的正则表达式生成∈以及所有由a、b组成的串。

firstpos（n）={1，2，3}。在由n对应的正则表达式生成的像aa这样的串中，该串的第一个位置对应于树中的位置1；在像ba这样的串中，串的第一个位置来自于树中的位置2。然而，当由n代表的正则表达式生成的串仅包含a时，这个a来自于位置3。

lastpos（n）={3}。也就是说，不管结点n的表达式生成什么串，该串的最后一个位置总是来自位置3上的a。

followpos的计算要困难一些，但是我们很快会给出计算这个函数的规则。下面是推导得到followpos值的一个例子：followpos（1）={1，2，3}。考虑一个串…ac…，其中c代表a或b，且a来自位置1。也就是说，这个a是由表达式（a|b）*中的a生成的多个a之一。这个a后面可以跟随由同一表达式（a|b）*生成的a或b，此时c来自位置1或位置2。也有可能这个a是表达式（a|b）*生成的串的最后一个字符，那么c一定是来自位置3的a。因此，1、2、3就是可以跟在位置1后的位置。