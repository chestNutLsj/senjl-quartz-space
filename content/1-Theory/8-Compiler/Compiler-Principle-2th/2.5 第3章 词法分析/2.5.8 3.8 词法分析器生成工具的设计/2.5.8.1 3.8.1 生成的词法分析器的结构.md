### 3.8.1　生成的词法分析器的结构

图3-49概括了由Lex生成的词法分析器的体系结构。作为词法分析器的程序包含一个固定的模拟自动机的程序。现在我们暂时不规定这个自动机是确定的还是不确定的。词法分析器的其他部分是由Lex根据Lex程序创建的组件组成的。

![120-1](../Images/image04117.jpeg)

图3-49　一个Lex程序被转变成由有限自动机模拟器使用的转换表和动作

这些组件包括：

1）表示自动机的一个转换表。

2）由Lex编译器从Lex程序中直接拷贝到输出文件的函数（见3.5.2节的讨论）。

3）输入程序定义的动作。这些动作是一些代码片段，将在适当的时候由自动机模拟器调用。

在构建自动机时，我们首先用算法3.23把Lex程序中的每个正则表达式模式转换为一个NFA。我们需要使用一个自动机来识别所有与Lex程序中的模式相匹配的词素，因此我们将这些NFA合并为一个NFA。合并的方法是引入一个新的开始状态，从这个新开始状态到各个对应于模式pi的NFA Ni的开始状态各有一个∈转换。构造方法如图3-50所示。

例3.26　我们将使用如下所述的简单、抽象的例子来说明本节所要说明的思想：

a　{模式p1的动作A1}

abb　{模式p2的动作A2}

a*b+　{模式p3的动作A3}

请注意，上述三个模式之间存在我们在3.5.3节中讨论过的冲突。更明确地说，字符串abb同时满足第二个和第三个模式，但是我们将把它看作模式p2的词素，因为在上面的Lex程序中首先列出的是模式p2。像aabbb…这样的输入串有很多前缀都满足第三个模式，Lex的规则是接受最长的前缀，因此我们不断读入b，直到另一个a出现为止。此时我们报告识别的词素就是从第一个a开始的、包含了其后所有b的符号串。

![121-1](../Images/image04118.jpeg)

图3-50　根据Lex程序构造得到的一个NFA

图3-51列出了分别识别这三个模式的NFA。其中第三个NFA是根据算法3.23的转换结果经简化得到的。然后，图3-52显示了通过加入一个新开始状态0和3个∈转换将这三个NFA合并后得到的单个NFA。

![121-2](../Images/image04119.jpeg)

图3-51　a、abb和a*b+的NFA

![121-3](../Images/image04120.jpeg)

图3-52　合并后的NFA