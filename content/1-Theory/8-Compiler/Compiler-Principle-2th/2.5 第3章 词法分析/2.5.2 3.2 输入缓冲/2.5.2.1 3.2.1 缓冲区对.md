### 3.2.1　缓冲区对

由于在编译一个大型源程序时需要处理大量的字符，处理这些字符需要很多的时间，因此开发了一些特殊的缓冲技术来减少用于处理单个输入字符的时间开销。一种重要的机制就是利用两个交替读入的缓冲区，如图3-3所示。

![087-1](../Images/image04052.jpeg)

图3-3　使用一对输入缓冲区

每个缓冲区的容量都是N个字符，通常N是一个磁盘块的大小，如4096字节。我们可以使用系统读取命令一次将N个字符读入到缓冲区中，而不是每读入一个字符调用一次系统读取命令。如果输入文件中的剩余字符不足N个，那么就会有一个特殊字符（用eof表示）来标记源文件的结束。这个特殊字符不同于任何可能出现在源程序中的字符。

程序为输入维护了两个指针：

1）`lexemeBegin`指针：该指针指向当前词素的开始处。当前我们正试图确定这个词素的结尾。

2）`forward`指针：它一直向前扫描，直到发现某个模式被匹配为止。做出这个决定所依据的策略将在本章的其余部分中讨论。

一旦确定了下一个词素，`forward`指针将指向该词素结尾的字符。词法分析器将这个词素作为某个返回给语法分析器的词法单元的属性值记录下来。然后使`lexemeBegin`指针指向刚刚找到的词素之后的第一个字符。在图3-3中，我们看到，`forward`指针已经越过下一个词素**（Fortran的指数运算符）。在处理完这个词素后，它将会被左移一个位置。

将`forward`指针前移要求我们首先检查是否已经到达某个缓冲区的末尾。如果是，我们必须将N个新字符读到另一个缓冲区中，且将`forward`指针指向这个新载入字符的缓冲区的头部。只要我们从不需要越过实际的词素向前看很远，以至于这个词素的长度加上我们向前看的距离大于N，我们就决不会在识别这个词素之前覆盖掉这个尚在缓冲区中的词素。