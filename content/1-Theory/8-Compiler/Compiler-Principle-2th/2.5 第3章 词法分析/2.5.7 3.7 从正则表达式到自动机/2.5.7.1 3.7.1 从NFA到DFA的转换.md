### 3.7.1　从NFA到DFA的转换

子集构造法的基本思想是让构造得到的DFA的每个状态对应于NFA的一个状态集合。DFA在读入输入a1a2…an之后到达的状态对应于相应NFA从开始状态出发，沿着以a1a2…an为标号的路径能够到达的状态的集合。

DFA的状态数有可能是NFA状态数的指数，在这种情况下，我们在试图实现这个DFA时会遇到困难。然而，基于自动机的词法分析方法的处理能力部分源于如下事实：对于一个真实的语言，它的NFA和DFA的状态数量大致相同，状态数量呈指数关系的情形尚未在实践中出现过。

算法3.20　由NFA构造DFA的子集构造（subset construction）算法。

输入：一个NFA N。

输出：一个接受同样语言的DFA D。

方法：我们的算法为D构造一个转换表 Dtran。D 的每个状态是一个NFA状态集合，我们将构造Dtran，使得D“并行地”模拟N在遇到一个给定输入串时可能执行的所有动作。我们面对的第一个问题是正确处理N的∈转换。在图3-31中我们可以看到一些函数的定义。这些函数描述了一些需要在这个算法中执行的N的状态集上的基本操作。请注意，s表示N的单个状态，而T代表N的一个状态集。

![112-1](../Images/image04092.jpeg)

图3-31　NFA状态集上的操作

我们必须找出当N读入了某个输入串之后可能位于的所有状态集合。首先，在读入第一个输入符号之前，N可以位于集合∈-closure（s0）中的任何状态上，其中s0是N的开始状态。下面进行归纳。假定N在读入输入串x之后可以位于集合T中的状态上。如果下一个输入符号是a，那么N可以立即移动到集合move（T，a）中的任何状态。然而，N可以在读入a后再执行几个∈转换，因此N在读入xa之后可位于∈-closure（move（T，a））中的任何状态上。根据这些思想，我们可以得到图3-32中显示的方法，该方法构造了D的状态集合Dstates 和D的转换函数Dtran。

![112-2](../Images/image04093.jpeg)

图3-32　子集构造法

D的开始状态是∈-closure（s0），D的接受状态是所有至少包含了N的一个接受状态的状态集合。我们只需要说明如何对NFA的任何状态集合T计算∈-closure（T），就可以完整地描述子集构造法。这个计算过程显示在图3-33中。它是从一个状态集合开始的一次简单的图搜索过程，不过此时假设这个图中只存在标号为∈的边。

![113-1](../Images/image04094.jpeg)

图3-33　计算∈-closure（T）

例3.21　图3-34给出了另一个接受语言（a|b）*abb的NFA。它正好是我们将在3.7节中根据这个正则表达式直接构造得到的NFA。我们现在把算法3.20应用到图3-34中。

![113-3](../Images/image04095.jpeg)

图3-34　（a|b）*abb对应的NFA N

等价NFA的开始状态A是∈-closure（0），即A={0，1，2，4，7}。A中的状态就是能够从状态0出发，只经过标号为∈的路径到达的所有状态。请注意，因为路径可以不包含边，所以状态0也是可以从它自身出发经过标号为∈的路径到达的状态。

NFA的输入字母表是{a，b}。因此，我们的第一步是标记A，并计算Dtran［A，a］= ∈-closure（move（A，a））以及Dtran［A，b］=∈-closure（move（A，b））。在状态0、1、2、4、7中，只有2和7有a上的转换，分别到达状态3和8，因此move（A，a）={3，8}，同时∈-closure（{3，8}）= {1，2，3，4，6，7，8}。因此我们有：

![113-2](../Images/image04096.jpeg)

我们称这个集合为B，得到Dtran［A，a］= B。

现在我们要计算Dtran［A，b］。在A的状态中只有4有一个输入b上的转换，它到达状态5，因此

![113-4](../Images/image04097.jpeg)

我们称这个集合为C，因此Dtran［A，b］=C。

如果我们对未加标记的集合B和C继续这个处理过程，最终会使得这个DFA的所有状态都被加上标记。这个结论一定正确，因为11个NFA状态的集合只有211个子集。我们实际上构造出5个不同的DFA状态。这些状态、它们对应的NFA状态集以及D的转换表显示在图3-35中。D的转换图如图3-36所示。状态A是D的开始状态，而包含NFA状态10的E状态是唯一的接受状态。

![113-5](../Images/image04098.jpeg)

图3-35　DFA D的转换表Dtran

![114-1](../Images/image04099.jpeg)

图3-36　将子集构造法应用于图3-34的结果

请注意，相比图3-28中接受相同语言（a|b）*abb的DFA，这个DFA D多了一个状态。D的状态A和C具有同样的转换函数，因此可以被合并。我们将在3.9.6中讨论使一个DFA的状态个数最小化问题。