   

# 第12章　过程间分析

在这一章中，我们讨论一些不能使用过程内分析技术解决的优化问题，由此引出了过程间分析的重要性。我们将首先描述过程间分析的常见形式，并解释实现它们的难点。然后将描述过程间分析的应用。对于诸如C和Java这样广泛使用的程序设计语言，指针别名分析是所有过程间分析技术的关键之处。因此本章将用大量篇幅讨论获取程序中的指针别名信息所需要的技术。我们先给出Datalog的描述，这种表示方法极大地隐藏了一个高效指针分析技术的复杂性。然后我们描述一个用于指针别名分析的算法，并说明如何使用二分决策图（Binary Decision Diagram, BDD）来高效地实现这个算法。

大部分编译器优化技术，包括那些在第9、10、11章中描述的技术，都是每次在一个过程中执行的。我们把这样的分析称为过程内分析。这些分析保守地假设被调用的过程有可能改变过程可见的所有变量的状态，并且它们还可能产生某种副作用，比如改变此过程可见的任何变量的值，或产生导致调用栈释放的异常。因此，过程内分析虽然不精确，但是却相对简单。有些优化不需要过程间分析，而有些优化不借助过程间分析几乎不会产生有用的信息。

一个过程间分析处理的是整个程序，它将信息从调用者传送到被调用者，或者反向传送。一个相对简单但有用的技术是过程内联（inline），就是把一个过程调用替换为被调用过程的过程体。在替换时需要考虑参数传递和返回值，因此需要进行适当修改。只有当我们知道这个过程调用的目标后才可以应用这个方法。

如果过程是通过一个指针或面向对象编程中常见的过程分发机制间接调用的，那么对程序指针或引用的分析有时可以确定这个间接调用的目标。如果目标是唯一的，那么就可以应用过程内联方法。

即使确定了每个过程调用只有一个调用目标，仍然必须谨慎使用内联转换。一般来说，不可能直接内联递归的过程，并且即使没有递归，内联转换也可能指数级地增加代码的大小。