### 12.4.1　为什么指针分析有难度

对C语言程序进行指针别名分析特别困难，因为C程序可以对指针进行任何运算。实际上，程序可以读入一个整数并把它赋给一个指针，这么做会使得这个指针成为程序中所有其他指针变量的别名。Java中的指针称为引用，对它们的分析要简单得多。它不支持算术运算，并且指针只能指向一个对象的开头。

指针别名分析必须是过程间分析。没有过程间分析，我们就必须假设任何方法调用都可能改变所有可被它访问的指针变量所指向的内容，造成所有过程内的指针别名分析非常低效。

支持间接函数调用的语言对指针别名分析提出了另一个挑战。在C语言中，人们可以通过调用一个解引用的函数指针来实现函数的间接调用。在分析被调用函数之前，我们需要知道这个函数指针指向哪里。显然，在分析被调用的函数之后，我们会发现这个函数指针可能指向更多的函数，因此这个过程需要迭代进行。

虽然C语言中的大部分函数是被直接调用的，但是Java中的虚方法使得很多调用成为间接调用。给定一个Java程序中的调用`x.m()`，对象x可能属于很多个类，这些类都具有名为m的方法。我们对x的实际类型了解得越精确，我们的调用图也就越精确。在理想情况下，我们可以在编译时刻准确地确定x的类，从而准确知道m指向哪个方法。

例12.21　考虑下面的Java语句序列：

![606-1](../Images/image05079.jpeg)

这里o被声明为一个`Object`。如果不分析o指向什么，我们必须把在各个类中声明的名为“hashCode”的所有方法都当作可能的调用目标。知道o指向一个`String`对象将会使过程间分析把范围精确地缩小到在`String`中声明的方法。

也可以使用近似的方法来减少目标的数量。比如，我们可以静态地确定被创建的对象的类型，然后把分析范围限定在这些类型中。但是，如果我们可以在做指针指向分析的同时，利用指针指向信息动态地构造调用图，就可以得到更加精确的结果。更加精确的调用图不仅仅可以获得更加精确的结果，也可以大大减少分析所需时间。

指针指向分析是很复杂的。它不是“简单的”数据流问题，在这类问题中我们只需要模拟单次执行一个语句循环的效果。在指针分析中，当我们发现一个新的指针目标时，我们必须重新分析所有把这个指针所指向的内容赋给其他指针的语句。

为简单起见，我们将主要关注Java。我们将从控制流无关和上下文无关的分析开始。当前我们假设程序中没有方法调用。然后，我们描述如何在计算指针指向分析结果的同时动态地构造调用图。最后我们将描述一个处理上下文相关性的方法。