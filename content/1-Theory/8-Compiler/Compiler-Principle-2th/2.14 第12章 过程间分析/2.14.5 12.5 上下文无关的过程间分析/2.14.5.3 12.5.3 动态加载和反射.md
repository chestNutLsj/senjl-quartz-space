### 12.5.3　动态加载和反射

Java这样的语言支持类的动态加载。因此分析一个程序执行的所有代码是不可能的，也就不可能静态地给出任何对调用图和指针别名的保守的估算。静态分析只能基于被分析代码给出一个近似。请记住，这里描述的所有分析都可以在Java字节码的层次上应用，因此不需要检查它们的源代码。这个选项非常重要，因为Java程序常常使用很多的类库。

即使假设已经分析了所有被执行的代码，还有一个更加复杂的机制使得我们不可能进行保守分析：反射机制。反射机制允许程序动态地决定将要创建的对象的类型、被调用的方法的名字以及被访问的字段名。这些类型、方法和字段名可以通过计算获得，也可以根据用户输入获得，因此一般情况下唯一可能的近似估算就是假设什么都有可能。

例12.25　下面的例子给出了反射机制的常见用法：

![612-1](../Images/image05091.jpeg)

其中的`Class`库中的方法`forName`的输入是一个包含了类名的字符串，它返回这个类。方法`newInstance`返回该类的一个实例。对象o的类型被强制转换成为所有预期类的超类T，而不是直接把`Object`当作o的类型。

虽然很多大的Java应用使用反射机制，但它们通常使用一些常见的习惯用法，比如例子12.25中给出的用法。只要这个应用没有重新定义类加载器，我们就可以在知道`className`的值时指出这个对象所属的类。如果`className`的值是在程序中定义的，因为Java中的字符串是不可变的，那么知道`className`指向什么值就可以知道这个类的名字。这个技术是指针指向分析的另一个应用。如果`className`的值是基于用户输入的，那么指针指向分析可以帮助确定这个值是在哪里输入的，而开发者就可以限定这个值的取值范围。

类似地，我们可以利用类型强制转换语句，即例子12.25中的第4行，来估算动态创建的对象的类型。假设没有重新定义强制类型转换的异常处理程序，那么这个对象必然属于类型T的某一个子类。