### 12.1.2　上下文相关

过程间分析很具有挑战性，因为各个过程的行为和它被调用时所在的上下文相关。例12.2通过一个小程序上的过程间常量传播问题说明了上下文的重要性。

例12.2　考虑图12-3中的程序片段。函数f在三个调用点`c1、c2`和`c3`上被调用。在循环的每次迭代中，常量0在`c1`上被作为实在参数传递，而常量243在`c2`和`c3`上被传递，这些调用分别返回常量1和244。因此，在各个上下文中函数`f`的实在参数都是常量，但是常量的具体值要根据上下文而定。

![590-1](../Images/image05054.jpeg)

图12-3　用来说明上下文相关分析的需求的一个程序片断

如我们将看到的，除非我们能够知道在上下文`c1`中调用f时返回1，且在其他两个上下文中调用f时返回244，否则不可能指出`t1、t2`和`t3`都被赋予了一个常量值（因此X［i］也被赋予了常量值）。通过一个简单的分析就可以知道对f的各次调用的返回值可能是1或244。

一种非常简单但是极端不精确的过程间分析方法称为上下文无关分析（context-insensitive analysis）。它把每个调用和返回语句看作一个“goto”操作。我们创建一个超级控制流图。图中除了一般的过程内控制流边外还有一些附加的边。这些边包括

1）从每个调用点到它所调用的过程的开始处的边。

2）从返回语句回到调用点的边[^1]。

另外还增加了一些赋值语句，它们把实在参数赋给相应的形式参数，并把返回值赋给接收返回结果的变量。然后，我们就可以对这个超级控制流图应用那些为分析单个过程而设计的标准分析技术，找出上下文无关的过程间分析结果。这个模型虽然简单，但它抽象掉了过程调用中输入值和输出值之间的重要关系，使得分析结果不够精确。

例12.3　图12-3中的程序的超级控制流图显示在图12-4中。块B6就是函数f。块B3包含了调用点`c1`，它把形式参数v设置为0，然后跳转到f的开始处。类似地，B4和B5分别表示调用点`c2`和`c3`。B4可以从f（基本块B6）的结尾处到达。我们在B4中把f的返回值赋给`t1`。然后把形式参数v设置成243并通过跳转到B6再次调用f。请注意，没有从B3到达B4的边。在从B3到达B4的路上，控制流必须穿越f。

![590-2](../Images/image05055.jpeg)

图12-4　图12-3的控制流图，它把函数调用当作控制流处理

B5和B4类似。它接收来自f的返回值并把返回值赋给`t2`，并初始化对f的第三次调用。块B7表示了第三次调用的返回和对X［i］的赋值。

如果我们把图12-4当作单个过程的流图，那么可以断定当控制流进入B6时，v的值可以是0或243。因此，我们最多能够断定`retval`的值是1或244，而不会是其他值。类似地，关于`t1、t2`和`t3`，我们只能断定它们的值是1或244。因此，看起来X［i］的值为3、246、489或732之一。反过来，一个上下文相关分析可以区分每次调用上下文的结果，并产生例12.2中描述的直觉结果：`t1`总是`1`，`t2`和`t3`的值总是244，而X［i］的值为489。