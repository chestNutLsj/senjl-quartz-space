### 12.3.2　Datalog规则

规则是表示逻辑推理关系的一种方法。在Datalog中，规则也说明了如何完成对正确的事实的计算。一个规则的形式为：

H：- B1&B2&…&Bn

其中的组成部分如下：

- H和B1, B2, …、Bn是字面值，即原子或原子的否定形式。但H不能是否定形式。
- H是规则的头，B1、B2、…、Bn组成了规则的体。
- 每个Bi有时被称为规则的子目标（subgoal）。

我们应该把符号：-读作“如果”。一个规则的含义是“如果规则体为真，那么规则头也为真”。更精确地说，我们按照下面的方法把规则应用到一组给定的基础原子集合上。考虑所有可能把规则中的变量替代为常量的替换方法。如果某个替换方法使得规则体的每个子目标都为真（假设所有且只有给定的基础原子为真），那么我们可以推断：按照这个替换方法把规则头中的变量替换为常量之后得到的断言为真。不能使所有子目标都为真的替换方法没有给我们任何信息，替换后的规则头可能为真也可能为假。

一个Datalog程序是一组规则的集合。这个程序被应用于一组“数据”，即某些断言的基础原子集合。这个程序的结果也是一组基础原子的集合，这个集合通过应用程序中的规则推断得到。程序将不断应用其中的规则，直到不能推断出新的基础原子为止。

例12.12　一个Datalog程序的简单例子是给定一个图的（有向）边，计算这个图的路径。也就是说，断言edge（X, Y）表示“有一条从结点X到Y的边”；断言path（X, Y）表示从X到Y有一条路径。定义路径的规则是：

1）path（X, Y）：- edge（X, Y）

2）path（X, Y）：- path（X, Z）& path（Z, Y）

第一个规则是说一条边就是一条路径。也就是说，只要我们把变量X替换为一个常量a且把变量Y替换为一个常量b，并且edge（a, b）为真（即有一条从结点a到结点b的边），那么path（a, b）也成立（即有一条从a到b的路径）。第二个规则是说如果有一条从某个结点X到某个结点Z的路径，并且还有一条路径从Z到结点Y，那么存在一条从X到Y的路径。这个规则表示“传递封闭性”。请注意，任何路径都可以通过选取路径上的边并不断应用传递封闭性规则得到。

比如，假设下列事实（基础原子）为真：edge（1, 2）、edge（2, 3）和edge（3, 4）。那么，我们可以使用第一个规则进行三次不同的替换，推断出path（1, 2）、path（2, 3）和path（3, 4）。例如，按照X=1和Y=2进行替换可以得到第一个规则的实例path（1, 2）：- edge（1, 2）。因为edge（1, 2）为真，所以可以推导出path（1, 2）。

根据这三个关于path的事实，我们可以多次使用第二个规则。如果按照X=1、Z=2和Y=3进行替换，我们可以得到这个规则的实例path（1, 3）：- path（1, 2）&path（2, 3）。因为规则体中的两个子目标都已经推导出来，已知它们为真，所以可以推出规则头：path（1, 3）。然后，使用替换方法X=1、Y=2和Z=4推出规则头path（1, 4）。也就是说，从结点1到结点4有一条路径。

Datalog的编码规则

我们将在Datalog程序中使用如下编码规则：

1）变量以大写字符开头。

2）所有的其他元素以小写字符或其他符号（比如数字）开头。这些元素包括断言和用作断言参数的常量。