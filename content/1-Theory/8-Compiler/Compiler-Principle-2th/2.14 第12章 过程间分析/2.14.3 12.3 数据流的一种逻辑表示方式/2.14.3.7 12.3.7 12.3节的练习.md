### 12.3.7　12.3节的练习

！练习12.3.1：在这个问题中，我们将考虑一个比例子12.13简单的到达定值数据流分析问题。假设每个语句本身就是一个基本块，并且一开始的时候假设每个语句对且只对一个变量定值。EDB断言pred（I, J）表示语句I是语句J的一个前驱。EDB断言defines（I, X）表示语句I所定值的变量为X。我们将使用IDB断言in（I, D）和out（I, D）分别表示定值D到达语句I的开头和结尾。请注意，一个定值实际上是一个语句的编号。图12-19是一个Datalog程序，它表示计算到达定值的常用算法。

请注意，规则1是说明一个语句杀死了它自己，但是规则2保证一个语句总是在它自己的输出集合中。规则3是普通的传递函数。因为I可以有多个前驱，所以规则4表示了交汇运算的情况。

你要解决的问题是修改这些规则来处理常见的二义性定义的情况，比如通过一个指针进行赋值运算。在这种情况下，defines（I, X）对多个不同的X和一个I成立。一个定值最好表示为一个二元组（D, X），其中D是一个语句，X是一个可能被D定值的变量。这样做的结果是，in和out变成了带有三个参数的断言。例如，in（I, D, X）表示在语句D上对X的（可能的）定值到达了语句I的开始处。

练习12.3.2：编写一个和图12-19类似的Datalog程序来计算可用表达式。除了断言defines之外，再加上一个断言eval（I, X, O, Y）。这个断言说明语句I使得表达式X O Y被求值。这里O是表达式中的运算符，例如+。

练习12.3.3： 编写一个和图12-19类似的Datalog程序来计算活跃变量。除了断言defines之外，假设一个断言use（I, X）表示语句I使用了变量X。

![605-1](../Images/image05078.jpeg)

图12-19　一个简单的到达定义分析的Datalog程序

练习12.3.4： 在9.5节中，我们定义了一个涉及六个概念的数据流计算，这些概念包括：预期执行的、可用的、最早的（earlist）、可后延的、最后的（latest）和被使用的。假设我们已经编写了一个Datalog程序。程序中包含了一些以EDB断言方式定义的可以从程序中获得的概念（例如gen和kill信息），并且使用这些EDB断言和这六个概念中的其他概念定义了每个概念。这六个概念中的哪些概念依赖于哪些其他概念？这些依赖关系中哪些是否定形式的？得到的Datalog程序是可分层的吗？

练习12.3.5：假设EDB断言edge（X, Y）包含下面的事实：

edge（1, 2）　edge（2, 3）　edge（3, 4）

edge（4, 1）　edge（4, 5）　edge（5, 6）

1）使用算法12.15中的简单求值策略，在这个数据上模拟运行例子12.12中的Datalog程序。给出每一轮中找到的path事实。

2）在这个数据上模拟执行图12-17中的Datalog程序。该程序实现了算法12.18中的增量式求值策略。给出每一轮中找出的path的事实。

练习12.3.6：下面的规则

p（X, Y）：- q（X, Z）& r（Z, W）& NOT p（W, Y）

是一个较大的Datalog程序P的一部分。

1）指出这个规则的头、规则体和各个子目标。

2）哪些断言一定是程序P的IDB断言？

3）哪些断言一定是P的EDB断言？

4）这个规则安全吗？

5）P是可分层的吗？

练习12.3.7：把图12-14中的规则转换成为增量形式。