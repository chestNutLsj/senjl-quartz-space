## 12.8　第12章总结

- 过程间分析：对跨越过程边界的信息进行跟踪的数据流分析称为过程间分析。很多分析技术，比如指针指向分析，只有当它是过程间分析的时候才可以完成有意义的分析工作。
- 调用点：程序中调用其他过程的程序点称为调用点。在一个调用点上被调用的过程可能是显然的。但是，如果这个调用是通过指针间接进行的，或者它调用的是具有多个实现的虚方法，那么被调用的过程也可能是不明确的。
- 调用图：一个程序的调用图是一个二分图，图的结点分为对应于调用点的结点和对应于过程的结点。如果一个过程在一个调用点上被调用，那么就有一条从这个调用点结点到这个过程结点的边。
- 内联：只要一个程序中没有递归，原则上我们可以把所有的过程调用替换为过程代码的拷贝，并对得到的程序使用过程内分析技术。从效果上看，这个分析是过程间分析。
- 控制流相关性和上下文相关性：如果一个数据流分析得到的事实和程序中的位置相关，那么它就是控制流相关的。如果一个数据流分析得到的事实和过程调用的历史相关，那么它就是上下文相关的。一个数据流分析可以是控制流相关的、上下文相关的、两者都相关或者都不相关。
- 基于克隆的上下文相关分析：从原则上讲，一旦我们建立了过程调用的不同上下文，就可以想象对于每个上下文都有一个该过程的克隆。按照这种方法，一个上下文无关分析技术可以用来进行上下文相关分析。
- 基于摘要的上下文相关分析：另一个过程间分析的方法，扩展原来为过程内分析而设计的基于区域的分析技术。每个过程有一个传递函数，并且在每一个调用该过程的地方它都被当作一个区域处理。
- 过程间分析技术的应用：需要过程间分析技术的重要应用之一是检测软件的安全漏洞。这些漏洞的常见特性是一个过程从某个不可信的输入源读取数据，而另一个过程以可能被利用的方式使用这个输入。
- Datalog：Datalog语言是if-then规则的简单表示方式，它可以用于在高层次上描述数据流分析。一组Datalog规则（或者说Datalog程序）可以使用多个标准算法中的任意一个算法进行求值。
- Datalog规则：一个Datalog规则由一个规则体（前提）和一个规则头（结果）组成。规则体是一个或多个原子，而规则头则是一个原子。原子就是作用于一组参数的断言，这些参数的值可以是变量或常量。规则体的多个原子通过逻辑AND连接，而规则体中的原子可能是断言的否定形式。
- IDB和EDB断言：一个Datalog程序中的EDB断言的真值事实在事先给出。在一个数据流分析中，这些断言对应于那些可以从被分析代码中获取的事实。IDB断言本身是通过规则定义的。在一个数据流分析中，它们对应于我们想从被分析代码中抽取的信息。
- Datalog程序的求值：我们应用规则的方法是把规则中的变量替换为一些能够使该规则体取真值的常量。当我们做了这样的替换后，就可以推断将规则头中的变量进行相同替换后得到的断言也为真。这个操作不断重复，直到不能推导出更多的事实为止。
- Datalog程序的增量求值：通过增量求值的方法可以改进Datalog程序的求值效率。我们将进行多轮求值。在每一轮中，我们只考虑如下的变量到常量的替换方法：它使得规则体中至少有一个原子是刚刚在上一轮中被发现的事实。
- Java指针分析：我们可以用一个框架对Java中的指针分析建模。在这个框架中，有一些指向堆对象的引用变量，而这些堆对象中又有一些字段可以指向其他堆对象。可以用一个Datalog程序写出一个上下文无关的指针分析方法。这个分析可以推导出两种事实：一个变量可能指向一个堆对象，以及一个堆对象的字段可能指向另一个堆对象。
- 使用类型信息改进指针分析：引用变量所指向的堆对象的类型要么和变量类型相同，要么是变量类型的子类型。如果我们能够利用这个事实，我们就可以得到更加精确的指针分析结果。
- 过程间指针分析：为了进行过程间分析，我们必须增加一些规则来反映参数是如何传递的，返回值是如何被赋给变量的。这些规则实质上和把一个引用变量复制到另一个引用变量的规则相同。
- 寻找调用图：因为Java具有虚方法，过程间分析要求我们首先界定有哪些过程可能在一个给定调用点上被调用。找出哪里可以调用哪些程序的限制的基本方法是分析对象的类型，并利用下面的事实：一个虚方法调用所指向的实际方法必须属于适当的类。
- 上下文相关分析：当过程具有递归特性时，我们必须把调用串中所包含的信息浓缩到有限多个上下文中。做这件事的有效方法之一是从调用串中删除某个过程调用与之相互递归调用的另一个过程（可能是调用者本身）的调用点。使用这样的表示方式，我们可以修改过程内指针分析的规则，使断言中包含上下文信息。这个方法模拟了基于克隆的分析。
- 二分决策图：BDD是一种使用带根的DAG表示布尔函数的简洁方法。内部结点对应于布尔变量，并且有两个子结点，即低子结点（表示0值）和高子结点（表示1值）。图中有标号分别为0和1的两个叶子结点。一个真假赋值使得被表示函数取真值当且仅当从图的根结点有一条如下的路径到达叶子结点1。这条路径从根结点开始，如果一个结点上的变量取值为0，那么我们就走到低子结点，否则走到高子结点。
- BDD和关系：一个BDD可以作为Datalog程序中的断言的简洁表示方法。常量被编码为一组布尔变量的真假赋值，BDD表示的函数为真当且仅当它的布尔变量表示了使这个断言取真值的事实。
- 使用BDD实现数据流分析：任何可以被表示为Datalog规则的数据流分析都可以使用BDD上的操作来实现。这些BDD表示了规则所涉及的断言。这个表示方法经常会得到一个比其他已知方法更加高效的实现。