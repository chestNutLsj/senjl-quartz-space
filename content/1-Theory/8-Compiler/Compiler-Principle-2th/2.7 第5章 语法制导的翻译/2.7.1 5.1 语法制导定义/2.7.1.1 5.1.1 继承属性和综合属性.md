### 5.1.1　继承属性和综合属性

我们将处理非终结符号的两种属性：

1）综合属性（synthesized attribute）：在分析树结点N上的非终结符号A的综合属性是由N上的产生式所关联的语义规则来定义的。请注意，这个产生式的头一定是A。结点N上的综合属性只能通过N的子结点或N本身的属性值来定义。

2）继承属性（inherited attribute）：在分析树结点N上的非终结符号B的继承属性是由N的父结点上的产生式所关联的语义规则来定义的。请注意，这个产生式的体中必然包含符号B。结点N上的继承属性只能通过N的父结点、N本身和N的兄弟结点上的属性值来定义。

另一种定义继承属性的方法

即使我们允许结点N上的一个继承属性B.c通过N的子结点、N本身、N的父结点和兄弟结点上的属性值来定义，我们可以定义的翻译的种类并不会增加。这样的规则可以通过创建附加的B的属性，比如B.c1、B.c2、… 来模拟。这些都是综合属性，用于把标号为B的结点的子结点上的属性拷贝过来。然后，我们使用属性B.c1、B.c2、…来替换子结点属性，按照继承属性的方法计算得到B.c。在实践中很少需要这种属性。

我们不允许结点N上的继承属性通过N的子结点上的属性值来定义，但是我们允许结点N上的一个综合属性通过结点N本身的继承属性来定义。

终结符号可以具有综合属性，但是不能有继承属性。终结符号的属性值是由词法分析器提供的词法值，在SDD中没有计算终结符号的属性值的语义规则。

例5.1　图5-1中的SDD基于我们熟悉的带有运算符*和+的算术表达式文法。它对一个以n作为结尾标记的表达式求值。在这个SDD中，每个非终结符号具有唯一的被称为val的综合属性。我们同时假设终结符号digit具有一个综合属性lexval，它是由词法分析器返回的整数值。

![210-1](../Images/image04301.jpeg)

图5-1　一个简单的桌上计算器的语法制导定义

产生式1 L→E n的规则将L.val设置为E.val。我们将看到，它就是整个表达式的值。

产生式2 E→E1+T也有一个规则。它计算出E1和T的值的和，作为产生式头E的val属性的值。在任何标号为E的语法分析树结点N上，E的val值是N的两个子结点（标号分别为E和T）上的val值的和。

产生式3 E→T有唯一的规则，它定义了E的val值和对应于T的子结点的val值相同。产生式4和第二个产生式类似，它的规则将子结点的值相乘，而不是相加。产生式5和6的规则和第三个产生式的规则类似，它们拷贝子结点的值。产生式7给F.val赋予一个digit的值，即由词法分析器返回的词法单元digit的数值。

一个只包含综合属性的SDD称为S属性（S-attribute）的SDD，图5-1中的SDD就具有这个性质。在一个S属性的SDD中，每个规则都根据相应产生式的产生式体中的属性值来计算产生式头部非终结符号的一个属性。

为简单起见，本节中的语义规则没有副作用。在实践中，允许SDD具有一些副作用会带来一些方便。比如允许打印桌上计算器计算得到的结果，或者和一个符号表进行交互。等到在5.2节中讨论了属性的求值顺序之后，我们将允许语义规则计算任意的函数，这些函数可能会有副作用。

一个S属性的SDD可以和一个LR语法分析器一起自然地实现。实际上，图5-1中的SDD是图4-58中的Yacc程序的另一种表示，该程序演示了在LR语法分析过程中进行翻译的过程。两者的区别在于，Yacc程序在产生式1的规则中通过副作用打印了E.val的值，而不是定义属性L.val。

一个没有副作用的SDD有时也称为属性文法（attribute grammar）。一个属性文法的规则仅仅通过其他属性值和常量值来定义一个属性值。