### 10.4.6　高级代码移动技术

如果我们的目标机器是静态调度的，并且具有丰富的指令级并行机制，我们可能需要更加积极的调度算法。下面是有关进一步扩展代码移动技术的一些高级描述：

1）为了便于进行下面的扩展，我们可以在那些从具有多个前驱的基本块出发的控制流边上增加新的基本块。在代码调度结束后将删除这些基本块中的空基本块。一个有用的启发式规则是试图把指令移出几乎为空的基本块，使得这个基本块可以被完全删除。

2）在算法10.11中，各基本块内执行的代码在此基本块被访问时一次性调度完毕。这个简单的方法已经足够了，因为这个算法只能够把运算上移到前面的支配基本块。为了进行需要额外补偿代码的代码移动，我们选用了一个略微不同的方法。当我们访问基本块B的时候，只对B以及和B控制等价的基本块中的指令进行调度。我们首先试图把这些指令放置到之前已经被访问过的前驱基本块中。这些基本块已经有了一个部分调度方案。我们试图找到一个目标基本块，使得移动后可以改进一个频繁执行的路径，然后在其他路径上放置这条指令的拷贝来保证移动的正确性。如果指令不能向上移动，那么它们和以前一样在当前的基本块中进行调度。

3）在以拓扑顺序访问基本块的算法中，实现向下的代码移动要更加困难一些，原因是目标基本块还在等待调度。虽然机会较少，但还是存在一些机会进行这样的代码移动。我们会移动所有同时满足下列条件的运算：

① 它们可以被移动。

② 在原来的基本块中它们不能免费执行。

如果目标机器有很多没有使用到的硬件资源，这个简单的策略会很有效。