### 10.3.3　带优先级的拓扑排序

列表调度算法不会回溯，它对每个结点进行一次且只进行一次指令调度。它使用一个启发式的优先级函数来从已经就绪的结点中选择下一个调度的结点。下面是一些关于结点的所有可能的带优先级的拓扑排序的性质：

- 如果不考虑资源约束，最短的调度方案可以根据关键路径（critical path）给出。所谓关键路径就是数据依赖图中的最长路径。一个可以被用作优先级函数的度量是结点的高度（height），就是从这个结点开始的最长路径的长度。
- 从另一方面考虑，如果所有的运算都是独立的，那么调度方案的长度受到可用资源的约束。关键资源就是具有最大的资源使用/可用数量比值的资源。所谓资源使用/可用数量比值是指对资源的使用和可用资源的单元数目的比值。使用较多关键资源的运算具有较高的优先级。
- 最后，我们可以使用源代码中的顺序来解决运算之间难分先后的问题，在源程序中先出现的运算应该首先被安排。

例10.8　对于图10-7中的数据依赖关系，它的关键路径的（包含了执行最后一条指令的时间）长度是6个时钟周期。也就是说，关键路径是最后的五个结点，从`R3`的加载运算开始到对`R7`的保存运算结束。这条路径中的所有边上的总延时是5，此外我们还要再加上执行最后一条指令所需的1个时钟周期。

使用结点高度作为优先级函数，算法10.7找到了一个如图10-9所示的优化的调度方案。请注意，因为`R3`的加载具有最大的高度，因此安排这条指令首先执行。`R3`和`R4`的加法在第二个时钟周期就有足够的资源，但是一条加载指令有2个时钟周期的延时，因此我们把这个加法安排到第三个时钟周期。也就是说，在第3个时钟周期开始之前我们不能保证`R3`中已经保存了需要的值。

![476-2](../Images/image04811.jpeg)

图10-9　将列表调度算法应用到图10-7后得到的结果