### 10.5.4　Do-Across循环

软件流水线化技术也可以用于各个迭代之间存在数据依赖关系的循环。这样的循环被称为do-across循环。

例10.16　代码

![487-1](../Images/image04831.jpeg)

的两个连续迭代之间具有数据依赖关系，因为前一次的`sum`值和A［i］相加得到新的`sum`值。如果目标机器可以提供足够的并行性，这个求和运算可以在O（logn）时间内完成。但是为了本次讨论，我们假设必须遵守所有的顺序依赖关系，上面的加法必须以原来的顺序完成。因为我们假设的机器模型需要两个时钟周期才能完成一个`ADD`运算，所以循环的运行不可能快过每两个时钟周期一个迭代。给该机器增加更多的加法器和乘法器都不会使循环运行得更快。像这样的do-across循环的吞吐量受迭代之间的依赖链的限制。

图10-23a显示了每个迭代的最好的局部紧凑的调度方案，经过软件流水线化处理的代码在图10-23b中显示。这个软件流水线化的循环每两个时钟启动一次迭代，因此运行的速度是最优的。

![487-2](../Images/image04832.jpeg)

图10-23　一个do-across循环的软件流水线化