### 10.1.1　指令流水线和分支延时

在实践中，不管是高性能超级计算机还是普通的机器，每个处理器都使用指令流水线（instruction pipeline）。使用指令流水线，每个时钟周期都可以取得一个新指令，而此时前面的指令还在流水线中执行。图10-1显示的是一个简单的5阶段指令流水线：它首先获取指令（IF），对该指令解码（ID），执行运算（EX），访问内存（MEM），然后回写结果（WB）。该图显示了指令i、i+1、i+2、i+3和i+4是如何在同一时刻并行运行的。图中的每一行对应于一个时钟周期，而每一列指明了各条指令在各时钟周期中所在的阶段。

![466-1](../Images/image04791.jpeg)

图10-1　在一个5阶段指令流水线中的五个连续指令

如果在后续指令需要某条指令的结果时此结果已经可用，那么处理器就可以在每个时钟周期内发出一条指令。分支指令特别容易出现问题，因为只有在它们被获取、解码并执行之后，处理器才能够知道下面该执行哪条指令。很多处理器假设分支不会跳转，投机性地选取下一条指令并解码。但是当这个分支真的需要跳转的时候，指令流水线被清空并获取分支跳转的目标指令。因此，分支跳转引入了为获取分支跳转目标而引起的延时，并使得指令流水线“打嗝”。先进的处理器使用硬件根据分支运行的历史来预测它们的结果，并从预测的目标位置预取指令。但是如果分支预测错误，依然会出现分支延时。