## 2.1　引言

编译器在分析阶段把一个源程序划分成各个组成部分，并生成源程序的内部表示形式。这种内部表示称为中间代码。然后，编译器在合成阶段将这个中间代码翻译成目标程序。

分析阶段的工作是围绕着待编译语言的“语法”展开的。一个程序设计语言的语法（syntax）描述了该语言的程序的正确形式，而该语言的语义（semantics）则定义了程序的含义，即每个程序在运行时做什么事情。我们将在2.2节中给出一个广范使用的表示方法来描述语法，这个方法就是上下文无关文法或BNF（Backus-Naur范式）。使用现有的语义表示方法来描述一个语言的语义的难度远远大于描述语言的语法的难度。因此，我们将结合非形式化描述和启发性的示例来描述语言的语义。

上下文无关文法不仅可以描述一个语言的语法，还可以指导程序的翻译过程。在2.3节中，我们将介绍一种面向文法的编译技术，即语法制导翻译（syntax-directed translation）技术。语法扫描，或者说语法分析，将在2.4节中介绍。

本章的其余部分将快速浏览一下图2-3所示的编译器前端模型。我们将首先介绍语法分析器。为简单起见，我们首先考虑从中缀表达式到后缀表达式的语法制导翻译过程。后缀表达式是一种将运算符置于运算分量之后的表示方法。例如，表达式9-5+2的后缀形式是95-2+。将表达式翻译为后缀形式的过程可以充分演示语法分析技术，同时这个翻译过程又很简单，我们将在2.5节中给出这个翻译器的全部程序。这个简单的翻译器处理的表达式是由加、减号分隔的数位序列，如9-5+2。我们之所以先考虑这样的简单表达式，主要目的是简化这个语法分析器，使得它在处理运算分量和运算符时只需要考虑单个字符。

![040-1](../Images/image03970.jpeg)

图2-3　一个编译器前端的模型

词法分析器使得翻译器可以处理由多个字符组成的构造，比如标识符。标识符由多个字符组成，但是在语法分析阶段被当作一个单元进行处理。这样的单元称作词法单元（token）。例如，在表达式count+1中，标识符count被当作一个单元。2.6节中介绍的词法分析器允许表达式中出现数值、标识符和“空白字符”（空格、制表符和换行符）。

接下来我们考虑中间代码的生成。在图2-4中显示了两种中间代码形式。一种称为抽象语法树（abstract syntax tree），或简称为语法树（syntax tree）。它表示了源程序的层次化语法结构。在图2-3的模型中，语法分析器生成一棵语法树，它又被进一步翻译为三地址代码。有些编译器会将语法分析和中间代码生成合并为一个组件。

![040-2](../Images/image03971.jpeg)

图2-4　`“do i=i+1；while（a［i］<v）`；”的中间代码

图2-4a中的抽象语法树的根表示整个do-while循环。根的左子树表示循环的循环体，它仅包含赋值语句i=i+1；，根的右子树表示循环控制条件a［i］<v。在2.8节中将介绍一个构造语法树的方法。

图2-4b中给出了另一种常见的中间表示形式，它是一组“三地址”指令序列，图2-2中显示了一个更加完整的示例。这个中间代码形式的名字源于它的指令形式：x=y op z，其中op是一个二目运算符，y和z是运算分量的地址，x是运算结果的存放地址。三地址指令最多只执行一个运算，通常是计算、比较或者分支跳转运算。

在附录A中，我们将把本章中的技术集成在一起，构造出一个用Java语言编写的编译器前端。这个前端将语句翻译成汇编级的指令序列。