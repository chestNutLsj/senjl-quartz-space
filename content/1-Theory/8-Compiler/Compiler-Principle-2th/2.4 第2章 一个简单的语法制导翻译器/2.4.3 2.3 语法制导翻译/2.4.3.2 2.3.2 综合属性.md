### 2.3.2　综合属性

将量和程序构造关联起来（比如把数值及类型和表达式相关联）的想法可以基于文法来表示。我们将属性和文法的非终结符号及终结符号相关联。然后，我们给文法的各个产生式附加上语义规则。对于语法分析树中的一个结点，如果它和它的子结点之间的关系符合某个产生式，那么该产生式对应的规则就描述了如何计算这个结点上的属性。

语法制导定义（syntax-directed definition）把①每个文法符号和一个属性集合相关联，并且把②每个产生式和一组语义规则（semantic rule）相关联，这些规则用于计算与该产生式中符号相关联的属性值。

属性可以按照如下方式求值。对于一个给定的输入串x，构建x的一个语法分析树。然后按照下面的方法应用语义规则来计算语法分析树中各个结点的属性。

假设语法分析树的一个结点N的标号为文法符号X。我们用X.a表示该结点上X的属性a的值。如果一棵语法分析树的各个结点上标记了相应的属性值，那么这棵语法分析树就称为注释（annotated）语法分析树（简称注释分析树）。比如，图2-9显示了`9-5+2`的一棵注释分析树，其中属性t与非终结符号expr和term关联。该属性在根结点处的值为`95-2+`，也就是`9-5+2`的后缀表示。我们很快会看到这些表达式的计算方法。

如果某个属性在语法分析树结点N上的值是由N的子结点以及N本身的属性值确定的，那么这个属性就称为综合属性（synthesized attribute）。综合属性具有一个很好的性质：只需要对语法分析树进行一次自底向上的遍历，就可以计算出属性的值。在5.1.1节中，我们将讨论另外一种重要的属性：“继承”属性。非正式地讲，继承属性在某个语法分析树结点上的值是由语法分析树中该结点本身、父结点以及兄弟结点上的属性值决定的。

例2.10　图2-9中的注释分析树是根据图2-10中的语法制导定义得到的。该语法制导定义用于把一个表达式翻译成为该表达式的后缀形式，待翻译的表达式是一个由加号和减号分隔的数位序列。图中每个非终结符号有一个值为字符串的属性t，它表示由该非终结符号生成的表达式的后缀表示形式。语义规则中的符号‖表示字符串的连接运算符。

![049-1](../Images/image03981.jpeg)

图2-9　一个语法分析树的各个结点上的属性值

![049-2](../Images/image03982.jpeg)

图2-10　从中缀表示到后缀表示的翻译的语法制导定义

一个数位的后缀形式是该数位本身。例如，与产生式term → `9`相关联的语义规则定义如下：当该产生式被应用在语法分析树的某个结点上时，term.t的值就是`9`本身。其他数位也按照类似的方法进行翻译。再如，当产生式expr→term被应用时，term.t的值成为expr.t的值。

产生式expr→expr1+term推导出一个带有加号的表达式[^3]。加法运算符的左运算分量由expr1给出，右运算分量由term给出。与这个产生式关联的语义规则

expr.t = expr1.t ‖ term.t‖′+′

定义了计算属性expr.t的值的方式，它将分别代表左右运算分量后缀表示形式的expr1.t和term.t连接起来，再在后面加上加号，就得到了属性expr.t的值。这个规则是后缀表达式定义的一个公式化表示。

区分一个非终结符号的不同使用的规则

在规则中，我们经常要区分同一个非终结符号在一个产生式的头和/或体中的多次使用，在例2.10中就有这样的情况。原因是在语法分析树中，标号为同一个非终结符号的不同结点通常在翻译中具有不同的属性值。我们将采用下面的规则：出现在产生式头中的非终结符号没有下标，而在产生式体中的非终结符号带有不同的下标。同一个非终结符号的所有出现都按照这种方式区分，并且下标不是名字的组成部分。然而，读者应该注意使用了这种下标约定的特定翻译规则和A→X1X2…Xn这样表示一般形式的产生式的区别。在后者中，带下标的X表示任意文法符号的列表，而不是某个名为X的非终结符号的不同实例。