### 2.8.3　静态检查

静态检查是指在编译过程中完成的各种一致性检查。这些检查不但可以确保一个程序被顺利地编译，而且还能在程序运行之前发现编程错误。静态检查包括：

- 语法检查。语法要求比文法中的要求的更多。例如下面的这些约束：任何作用域内同一个标识符最多只能声明一次，一个break语句必须处于一个循环或switch语句之内。这些约束都是语法要求，但是它们并没有包括在用于语法分析的文法中。
- 类型检查。一种语言的类型规则确保一个运算符或函数被应用到类型和数量都正确的运算分量上。如果必须要进行类型转换，比如将一个浮点数与一个整数相加时，类型检查器就会在语法树中插入一个运算符来表示这个转换。下面我们将使用常用的术语“自动类型转换”来讨论类型转换的问题。

左值和右值

现在我们考虑一些简单的静态检查，它们可以在源程序的抽象语法树构造过程中完成。一般来说，在进行复杂的静态检查时，首先要生成源程序的某个中间表示，然后再分析这个中间表示。

赋值表达式左部和右部的标识符的含义是不一样的。在下面的两个赋值语句

![076-1](../Images/image04030.jpeg)

中，表达式的右部描述了一个整数值，而左部描述的是用来存放该值的存储位置。术语左值（l-value）和右值（r-value）分别表示可以出现在赋值表达式左部和右部的值。也就是说，右值是我们通常所说的“值”，而左值是存储位置。

静态检查要确保一个赋值表达式的左部表示的是一个左值。一个像`i`这样的标识符是一个左值，像`a［2］`这样的数组访问也是左值，但`2`这样的常量不可以出现在一个赋值表达式的左部，因为它有一个右值，但不是左值。

类型检查

类型检查确保一个构造的类型符合其上下文对它的期望。比如说，在if语句

if（expr）stmt

中，期望表达式expr是boolean型的。

类型检查规则按照抽象语法中运算符/运算分量的结构进行描述。假设运算符rel表示关系运算符，如<=。那么运算符组rel的类型规则是：它的两个运算分量必须具有相同的类型，而其结果为布尔类型。用属性type来表示一个表达式的类型，令`E`表示将rel应用于E1和E2的表达式。那么E的类型检查可以在创建它对应的抽象语法树的结点时进行，执行如下所示的代码即可：

if（E1.type == E2.type）E.type = boolean；

else error；

即使在下面的情况下，仍可以运用将实际类型和期望类型相匹配的思想：

- 自动类型转换。当一个运算分量的类型被自动转换为运算符所期望的类型时，就发生了自动类型转换（coercion）。在一个像`2*3.14`这样的表达式中，常见的转换是将整数`2`转换为一个等值的浮点数`2.0`，然后对得到的两个浮点运算分量执行相应的浮点运算。程序设计语言的定义指明了允许的自动类型转换方式。比如，上面讨论的rel的实际规则可能是这样的；E1.type和E2.type可以被转换成相同的类型。如果是那样，把一个整数和一个浮点数比较就是合法的。
- 重载。Java中的运算符+应用于整数运算分量时表示相加，而应用于字符串型运算分量时表示连接。如果一个符号在不同上下文中有不同的含义，那么我们说这个符号是重载（overloading）的。因此，在Java中+是重载的。我们可以通过已知的运算分量类型和结果类型来判断一个重载的运算符的含义。比如，如果我们知道`x`、`y`或`z`中的任意一个是字符串类型，那么表达式`z=x+y`中的运算符`+`的含义就是连接。然而，如果我们还知道其中另一个运算分量是整型的，那么我们就找到了一个类型错误，`+`的这次使用就没有意义。