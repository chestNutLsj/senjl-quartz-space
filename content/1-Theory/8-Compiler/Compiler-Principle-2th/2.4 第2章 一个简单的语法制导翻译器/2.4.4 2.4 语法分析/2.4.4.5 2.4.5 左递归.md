### 2.4.5　左递归

递归下降语法分析器有可能进入无限循环。当出现如下所示的“左递归”产生式时，分析器就会出现无限循环：

expr → expr + term

在这里，产生式体的最左边的符号和产生式头部的非终结符相同。假设expr对应的过程决定使用这个产生式。因为产生式体的开头是expr，所以expr对应的过程将被递归调用。由于只有当产生式体中的一个终结符号被成功匹配时，向前看符号才会发生改变，因此在对expr的两次调用之间输入符号没有发生改变。结果，第二次expr调用所做的事情与第一次调用所做的完全相同，这意味着会对expr进行第三次调用，并不断重复，进入无限循环。

通过改写有问题的产生式就可以消除左递归。考虑有两个产生式：

A → Aα | β

的非终结符号A，其中α 和 β是不以A开头的终结符号/非终结符号的序列。例如，在产生式

expr → expr + term | term

中，非终结符号A=expr，串α= + term，串β=term。

因为产生式A → Aα的右部的最左符号是A自身，非终结符号A和它的产生式就称为左递归的（left recursive）[^4]。不断应用这个产生式将在A的右边生成一个α的序列，如图2-20a所示。当A最终被替换为β时，我们就得到了一个在β后跟有0个或多个α的序列。

![057-1](../Images/image03994.jpeg)

图2-20　生成一个串的左递归方式和右递归方式

如图2-20b所示，使用一个新的非终结符号R，并按照如下方式改写A的产生式可以达到同样的效果：

A → βR

R → αR | ∈

非终结符号R和它的产生式R → αR是右递归的（right recursive），因为这个产生式的右部的最后一个符号就是R本身。如图2-20b所示，右递归的产生式会使得树向右下方向生长。因为树是向右下生长的，对包含了左结合运算符（比如减法）的表达式的翻译就变得较为困难。然而，我们将在2.5.2节看到，通过仔细设计翻译方案，我们仍然可以将一个表达式正确地翻译成后缀表达式。

在4.3.3节，我们将考虑更一般的左递归形式，并说明如何从文法中消除左递归。