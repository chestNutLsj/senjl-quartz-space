## 2.7　符号表

符号表（symbol table）是一种供编译器用于保存有关源程序构造的各种信息的数据结构。这些信息在编译器的分析阶段被逐步收集并放入符号表，它们在综合阶段用于生成目标代码。符号表的每个条目中包含与一个标识符相关的信息，比如它的字符串（或者词素）、它的类型、它的存储位置和其他相关信息。符号表通常需要支持同一标识符在一个程序中的多重声明。

从1.6.1节介绍的内容可知，一个声明的作用域是指该声明起作用的那一部分程序。我们将为每个作用域建立一个单独的符号表来实现作用域。每个带有声明的程序块[^8]都会有自己的符号表，这个块中的每个声明都在此符号表中有一个对应的条目。这种方法对其他能够设立作用域的程序设计语言构造同样有效。例如，每个类也可以拥有自己的符号表，它的每个域和方法都在此表中有一个对应的条目。

本节包括一个符号表模块，它可以和本章中的Java翻译器代码片段一起使用。当我们在附录A中将这个翻译器集成到一起时可以直接使用这个模块。同时，为了简化问题，本节的主要例子是一个被简化了的语言，它只包含与符号表相关的关键构造，比如块、声明、因子等。所有其他的语句和表达式构造都被忽略了，这使得我们可以重点关注符号表的操作。一个程序由多个块组成，每个块包含可选的声明和由单个标识符组成的语句。每个这样的语句都表示对相应标识符的一次使用。下面是这个语言的一个例子程序：

![068-1](../Images/image04018.jpeg)

1.6.3节中块结构的例子处理了名字的定义和使用。输入（2.7）仅仅由名字的定义和使用组成。

我们将要完成的任务是打印出一个修改过的程序，程序中的声明部分已经被删除，而每个“语句”中的标识符之后都跟着一个冒号和该标识符的类型。

谁来创建符号表条目？

符号表条目是在分析阶段由词法分析器、语法分析器和语义分析器创建并使用的。在本章中，我们让语法分析器来创建这些条目。因为语法分析器知道一个程序的语法结构，因此相对于词法分析器而言，语法分析器通常更适合创建条目。它可以更好地区分一个标识符的不同声明。

在有些情况下，词法分析器可以在它碰到组成一个词素的字符串时立刻建立一个符号表条目。但是在更多的情况下，词法分析器只能向语法分析器返回一个词法单元，比如id，以及指向这个词素的指针。只有语法分析器才能够决定是使用之前已创建的符号表条目，还是为这个标识符创建一个新条目。

例2.14　在处理上面的输入（2.7）时，目标是生成

![069-1](../Images/image04019.jpeg)

第一个`x`和`y`来自输入（2.7）的内层块。由于`x`的使用指向外层块中`x`的声明，因此第一个x后面跟的是int，即该声明中的类型。内层块中对`y`的使用指向同一个块中的声明，因此具有布尔类型。我们同时看到，外层块中`x`和`y`的使用的类型分别为整型和字符型，也就是外层块中声明所指定的类型。