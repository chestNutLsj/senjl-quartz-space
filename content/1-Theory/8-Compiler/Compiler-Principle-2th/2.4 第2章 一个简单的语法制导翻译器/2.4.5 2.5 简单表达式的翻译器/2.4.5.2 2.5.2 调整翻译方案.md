### 2.5.2　调整翻译方案

图2-20中简述的左递归消除技术同样可以应用于包含了语义动作的产生式。首先，该技术被扩展到A的多个产生式中。在我们的例子中，A就是expr，它有两个expr的左递归产生式和一个非左递归的产生式。这个技术将产生式A→Aα| Aβ | γ转换成

A→γR

R→αR| βR | ∈

其次，我们要转换的产生式不仅包含终结符号和非终结符号，还包含内嵌动作。嵌入在产生式中的语义动作在转换时被当作终结符号直接进行复制。

例2.13　考虑图2-21中的翻译方案。令

A= expr

α= + term{print（′+′）}

β= - term{print（′-′）}

γ= term

那么进行左递归消除转换后将产生如图2-23所示的翻译方案。图2-21中的expr产生式已经转换成expr和新非终结符号rest的产生式，其中rest扮演了R的角色。term的产生式就是图2-21中term的产生式。图2-24展示了使用图2-23中的文法对`9-5+2`进行翻译的过程。

![059-1](../Images/image03997.jpeg)

图2-23　消除左递归后的翻译方案

![059-2](../Images/image03998.jpeg)

图2-24　从`9-5+2`到`95-2+`的翻译

左递归消除的工作必须小心进行，以确保消除后的结果保持语义动作的顺序。例如，在图2-23的翻译方案中，动作{print（′`+`′）}和{print（′`-`′）}都处于产生式体的中间，两边分别是非终结符号term和rest。假如将这个动作放到产生式的末尾，即rest之后，那么这个翻译就是不正确的。请读者自己证明，假如这么做，`9-5+2`就会被错误地转换成`952+-`，它是`9-（5+2）`的后缀表示方式；而我们实际想要的是`952+-`，即`（9-5）+2`的后缀表示方式。