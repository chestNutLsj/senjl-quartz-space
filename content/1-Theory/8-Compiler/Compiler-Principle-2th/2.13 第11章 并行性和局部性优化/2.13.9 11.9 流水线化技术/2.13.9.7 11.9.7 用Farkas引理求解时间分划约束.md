### 11.9.7　用Farkas引理求解时间分划约束

因为时间分划约束和空间分划约束类似，那么是否可以用一个类似的算法来求解这些约束呢？遗憾的是，两类问题之间的少许不同使得两个解决方法在技术上存在很大不同。算法11.43直接求解C1、c1、C2和c2的满足下面条件的值，使得对于所有![565-5](../Images/image05008.jpeg)中i1和![565-6](../Images/image05009.jpeg)中的i2，如果

F1i1+f1=F2i2+f2

成立，那么

C1i1+c1=C2i2+c2

根据循环界限而得到的线性不等式只用于确定两个引用是否具有数据依赖关系，没有其他用途。

为了找出时间分划约束的解，我们不能忽略线性不等式![567-3](../Images/image05017.jpeg)，忽略它们经常会使得只存在平凡解，而平凡解会把所有的迭代都放到同一个分划单元中。因此，寻找时间分划约束解的算法必须同时处理等式和不等式。

我们希望解决的一般性问题是：给定一个矩阵A，找出一个向量c使得对于所有满足Ax≥0的向量x，都有cTx≥0。换句话说，我们在寻找向量c，使得c和Ax≥0所定义的多面体之内任何向量的内积总是大于0。

这个问题可以用Farkas引理解决。令A为一个m×n的实数矩阵，且c为一个实数、非零的n维向量。Farkas引理说要么原不等式系统

Ax≥0　cTx<0

具有一个实数解x，要么相应的对偶系统

ATy=c，y≥0

具有一个实数解y，但是两者不会同时成立。

这个对偶系统可以用Fourier-Motzkin消除法进行处理，通过投影消除变量y。这个引理保证，对于每个对偶系统中有解的向量c，原系统不存在解。换句话说，我们可以找到对偶系统A Ty=c，y≥0的解，从而证明系统的否命题，即对于所有满足Ax≥0的x，都有cTx≥0。

关于Farkas引理

关于这个引理的证明可以在很多关于线性规划的标准课本中找到。最早在1901年被证明的Farkas引理是择一性定理之一。这些定理相互等价，但是尽管经过了多年的尝试，人们仍然没有找到有关这个引理或者它的某个等价定理的简单、直观的证明。

算法11.59　为一个外层的顺序循环找到一个合法的最大线性独立的仿射时间分划映射。

输入：一个带有数组访问的循环嵌套结构。

输出：线性独立时间分划映射的最大集。

方法：算法包括以下步骤：

1）找出程序中所有具有数据依赖关系的访问对。

2）对于每一对具有数据依赖的访问，在循环结构d1中的语句s1中的访问![557-1](../Images/image04979.jpeg)=<F1，f1,B1,b1>和嵌套在循环结构d2中的语句s2的访问![557-6](../Images/image04980.jpeg)=<F2，f2,B2,b2>，令<C1,c1>和<C2,c2>分别为语句s1和s2的（未知的）时间分划映射。回顾一下，时间分划约束是说：

- 如果![565-5](../Images/image05008.jpeg)中所有的i1和![565-6](../Images/image05009.jpeg)中的i2满足下列条件，

1）![568-1](../Images/image05018.jpeg)

2）B1i1+b1≥0

3）B2i2+b2≥0

4）F1i1+f1=F2i2+f2

那么必然有C1i1+c1≤C2i2+c2

因为![568-2](../Images/image05019.jpeg)是多个子句的析取式，因此我们可以为每个子句创立一个约束系统，并单独对它们求解。方法如下：

（a）和算法11.43的步骤2（a）类似，对方程

F1i1+f1=F2i2+f2

应用高斯消除法把向量

![568-3](../Images/image05020.jpeg)

归约为某个未知量的向量x。

（b）令c为这个分划映射中的所有未知量。把因为分划映射而产生的线性不等式约束可写成

cTDx≥0

其中D为一个矩阵。

（c）把循环下标变量的先后关系约束和循环边界表示为

Ax≥0

其中A为一个矩阵。

（d）应用Farkas引理。找到满足上面两个约束的x的任务等价于寻找满足下列条件的y：

ATy=DTc且y≥0

请注意，这里的cTD就是Farkas引理中的cT，而且我们使用的是这个引理的否定形式。

（e）在这个形式中，应用Fourier-Motzkin消除法把y的变量通过投影消除，并把关于系数c的约束表示为Ec≥0。

（f）令E′c′≥0为不包含常量项的约束。

3）使用附录B中的算法B.1，找出E′c′≥0的线性独立解的最大集合。这一复杂的算法的基本思路是跟踪每个语句的当前解集，并通过插入一些约束不断寻找更多的独立解。这些被插入的约束会保证相应的解至少对于一个语句来说是线性独立的。

4）根据找到的每个解c′得到一个仿射时间分划映射。映射的常量项通过不等式Ec≥0得到。

例11.60　例11.57的约束可以写作

![569-1](../Images/image05021.jpeg)

Farkas引理说这些约束和

![569-2](../Images/image05022.jpeg)

等价。解这个不等式系统，我们得到

C11=C21≥0且C12=c2-c1=0

请注意，我们在例11.57中得到的特定解满足这些约束。