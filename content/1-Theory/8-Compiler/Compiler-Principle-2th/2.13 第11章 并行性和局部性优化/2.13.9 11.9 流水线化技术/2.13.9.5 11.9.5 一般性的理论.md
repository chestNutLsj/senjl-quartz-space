### 11.9.5　一般性的理论

刚刚讨论的例子解释了关于流水线化的一般性理论：如果我们能够在一个循环嵌套结构中找到至少两个不同的最外层循环，并满足所有的依赖关系，那么就可以把这个计算过程流水线化。一个具有k个最外层完全可交换循环的循环嵌套结构具有k-1度的流水线化并行度。

不能被流水线化的循环嵌套结构没有可交换的外层循环。例11.56给出了这样的例子。为了遵循所有的依赖关系，在最外层循环中的每个迭代必须精确执行原来代码中的计算任务。但是，这样的代码仍然可能在内层循环中包含并行性。要利用这种并行性，我们必须引入至少n个同步运算，其中n是最外层循环中的迭代个数。

例11.56　图11-53是我们在例11.50中所见程序的一个更复杂的版本。如图11-53b的程序依赖图所示，语句s1和s2属于同一个强连通分量。因为我们不知道矩阵A中的内容，所以必须假设语句s2中的访问可以读取X的任何元素。从语句s1到语句s2之间有一个真依赖关系，并且从语句s2到语句s1存在一个反依赖关系。这两个语句都没有进行流水线化的机会，因为属于外层循环的迭代i的所有运算必须在属于迭代i+1的所有运算之前进行。为了找到更多的并行性，我们对内层循环重复并行化过程。第二个循环中的迭代可以被无同步地并行化。因此，我们需要200个同步栅障，在内层循环的每次执行之前和之后各需要一个。

![564-1](../Images/image05005.jpeg)

图11-53　一个顺序化的外层循环（参见图a）以及它的PDG图（参见图b）