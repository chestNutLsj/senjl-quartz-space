### 11.6.4　解决整数线性规划的启发式规则

数据依赖关系问题需要求解很多简单的整数线性规划问题。现在我们讨论处理简单不等式组的几个技术，以及一个可以利用在数据依赖关系分析时发现的相似性的技术。

独立变量测试

从数据依赖关系分析中得到的很多整数线性规划问题由多个只涉及一个未知量的不等式组成。这类规划问题的解法很简单，只需要分别测试常量上界和常量下界之间是否存在整数即可。

例11.35　考虑嵌套循环结构

![535-1](../Images/image04925.jpeg)

为了找出Z［i,j］和Z［j+10,i+11］之间是否存在数据依赖关系，我们考虑是否存在整数i，j，i′和j′，使得

0≤i，j，i′，j′≤10

i=j′+10

j=i′+11

对其中的方程应用GCD测试可以确定可能存在一个整数解。这些方程的整数解可表示如下：

i = t1，j=t2，i′=t2-11，j′=t1-10

其中，t1和t2是任意整数。把变量t1和t2代入上面的线性不等式，我们得到

![535-2](../Images/image04926.jpeg)

这样，把根据后两个不等式得到的下界与根据前两个不等式得到的上界组合起来，我们推出

10≤t1≤10

11≤t2≤10

因为t2的下界大于它的上界，因此不存在整数解，也就没有数据依赖关系。这个例子说明，即使存在涉及多个变量的等式，GCD测试（原文如此，实际应该是独立变量测试，译者注）依然可以构造出每个不等式只涉及一个变量的线性不等式组。

无环测试

另一个简单的启发式规则是寻找是否存在一个其上界或下界为常量的变量。在某些情况下，我们可以安全地用这个常量来替换这个变量。简化后的不等式组有一个整数解当且仅当原来的不等式组有一个整数解。明确地说，假设vi的每个下界都具有如下形式：

对于某个ci>0，c0≤civi

同时vi的上界都具有如下形式：

civi≤c0+c1v1+…+ci-1vi-1+ci+1vi+1+…+cnvn

其中，ci是非负整数。那么我们可以把变量vi替换为最小的可能整数值。如果没有这样的下界，我们可以把vi替换为-∞。类似地，如果涉及vi的所有约束都可以表示成上面的两种形式，但是不等号的方向相反，那么我们可以把变量vi替换为最大的可能整数值，或者在没有常量上界时替换为∞。可以重复这个步骤对不等式不断化简，在某些情况下可以确定不等式无解。

例11.36　考虑下面的不等式：

![536-1](../Images/image04927.jpeg)

变量v1的下界由v2确定，而上界由v3+4确定。但是，界定v2下界的只有常量1，界定v3上界的只有常量4。因此，在这些不等式中把v2替换为1并把v3替换为4，我们得到

![536-3](../Images/image04928.jpeg)

现在这个不等式组可以很容易地使用独立变量测试的方法求解。

循环残数测试

现在让我们考虑每个变量的上下界都由其他变量确定的情况。在数据依赖分析中经常会碰到形如vi≤vj+c的约束。这种情况可以使用Shostak提出的循环残数测试（loop-residue test）的一个简化版本来求解。这样的一组约束可以用一个有向图表示。这个图的结点标号为不等式中的变量。对于每一个约束vi≤vj+c，都有一条从结点vi到vj的标号为c的对应边。

我们把一条路径的权重（weight）定义为该路径上所有边的标号的和。图中的每条路径表示此约束系统中的一组约束的组合。也就是说，只要存在一条从v到v′的权重为c的边，我们就可以推断出v≤v′+c。图中的一条权重为c的环表示对环中的每个结点v都存在约束v≤v+c。如果我们能够在图中找到一个权重为负的环，那么就可以推断出v<v，而这是不可能成立的。此时，我们断定不等式组无解，因此也就没有依赖关系。

我们也可以把形如c≤v或v≤c的约束放到循环残数测试中去，这里v是一个变量，c是一个常量。我们向不等式系统引入一个新的哑变量v0。这个哑变量被加到每个常量上界和常量下界上。当然v0的值一定是0，但是因为循环残数测试只寻找图中的环，变量的实际值并不重要。为了处理常量上下界，我们把

v≤c替换为v≤v0+c

c≤v替换为v0≤v-c。

例11.37　考虑不等式

![536-4](../Images/image04929.jpeg)

变量v1的常量上下界变成了v0≤v1-1和v1≤v0+10；v2和v3的常量界限也可以做类似的处理。然后，把最后一个约束转换成v1≤v3-4，我们就得到图11-21中显示的图。环v1、v3、v0、v1的权重为-1，因此这个不等式组无解。

![536-2](../Images/image04930.jpeg)

图11-21　例子11.37中的约束的图形表示

记忆模式

因为一些简单的访问模式会在整个程序中重复出现，我们经常需要重复求解类似的数据依赖关系问题。提高数据依赖关系的处理速度的重要技术之一是使用记忆模式（memoization）。这个模式在生成一个问题的结果之后就把这个结果用表格记录下来。每次处理此类问题的时候，算法都会查询这个表。只有在表中找不到被处理问题的结果时才需要从头求解这个问题。