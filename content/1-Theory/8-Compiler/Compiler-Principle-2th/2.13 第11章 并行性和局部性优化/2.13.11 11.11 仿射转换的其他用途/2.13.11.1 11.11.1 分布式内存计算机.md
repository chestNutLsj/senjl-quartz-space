### 11.11.1　分布式内存计算机

在分布式内存计算机中，处理器通过发送消息和其他处理器进行通信。对于这类机器，给各个处理器分配大型的、独立的计算单元显得更加重要。仿射分划算法可以生成这样的单元。除了计算任务的分划，还存在其他一些编译问题需要处理：

1）数据分配。如果处理器使用的是一个数组的不同部分，每一个处理器只需要分配足够的空间以存放各自使用的部分。我们可以使用投影的方式来决定每个处理器使用数组的哪个部分。在决定数据分配时，输入是一个线性不等式系统，该系统表示循环界限，数组访问函数，以及把迭代映射到处理器ID的仿射分划。我们通过投影消除循环下标，并找出每个处理器ID所使用的数组位置。

2）通信代码。我们需要明确生成向其他处理器发送以及从其他处理器接收数据的代码。在每个同步点上，

① 确定存放在某个处理器上且其他处理器需要使用的数据。

② 生成具有如下功能的代码：找出所有将被发送的数据并把它们打包放到一个缓冲区中。

③ 类似地，确定这个处理器需要的数据，解开接收到的消息的数据包，把数据移动到适当的内存位置。

如果所有的访问都是仿射的，那么这些任务仍然可以由编译器使用仿射框架来完成。

3）优化。并不是所有的通信都必须在同步点上进行。比较好的做法是每个处理器在数据可用时立刻发送数据，而每个处理器只有在需要数据时才开始等待。必须对这个优化和另一个目标（即不能生成太多消息）加以权衡，因为处理每个消息的开销都比较大。

这里描述的技术还有其他用途。比如，一个专用的嵌入式系统可能使用协处理器来减轻某些计算负担。嵌入式系统也可能使用一个独立的控制器把数据加载进高速缓存或其他数据缓冲区，或从中卸载，而不是自己要求把数据调入高速缓存；在独立控制器调动数据时，处理器可同时在其他数据上执行运算。在这些情况下，我们可以使用类似的技术来生成移动数据的代码。