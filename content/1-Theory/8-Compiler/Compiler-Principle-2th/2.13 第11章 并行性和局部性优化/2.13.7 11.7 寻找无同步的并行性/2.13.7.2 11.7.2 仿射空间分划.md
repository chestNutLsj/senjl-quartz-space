### 11.7.2　仿射空间分划

如果一个循环嵌套结构内部具有k个可并行化的循环，那么这个循环嵌套结构就有k度的并行性。一个可并行化循环的不同迭代之间不存在数据依赖关系。比如，图11-24中的代码就具有2度并行性。把具有k度并行性的计算任务分配给一个k维的处理器阵列是很方便的。

一开始，我们将假设处理器阵列的每个维度上的处理器数目和相应循环的迭代个数一样多。在找到所有这些独立计算单元后，我们将把这些“虚拟”处理器映射到实际的处理器上。在实践中，每个处理器要负责相当多的迭代，否则就没有足够的工作量来分摊并行化所带来的额外开销。

我们把需要并行化的程序分解成为类似于三地址语句这样的基本语句。对于每个语句，我们找出一个仿射空间分划（affine space partition）。这个分划把这些语句的各个动态实例映射到一个处理器ID。这些动态实例使用其循环下标来标记。

例11.40　如上面所讨论的，图11-24的代码具有2度的并行性。我们把处理器阵列看作一个二维空间。令（p1,p2）为这个阵列中的一个处理器的ID。在11.7.1节中所讨论的并行化方案可以使用一个简单的仿射分划函数来描述。在第一个循环嵌套结构中的所有语句都有下面的仿射分划：

![542-1](../Images/image04939.jpeg)

在第二个和第三个循环嵌套结构中的所有语句共享如下的相同的仿射分划：

![542-2](../Images/image04940.jpeg)

寻找无同步并行性的算法由三个步骤组成：

1）为程序中的每个语句寻找一个能够最大化并行性度数的仿射分划。请注意，我们通常把语句（而不是单个访问）作为计算的单元。对于一个语句中的所有访问必须应用同样的仿射分划。这种对访问的分组方法是有意义的，因为在同一个语句中的访问之间几乎总是存在依赖关系。

2）在处理器之间分配由第1步得到的独立计算单元，并选择在每个处理器上执行的各个步骤之间的交替顺序关系。这个分配主要要考虑局部性。

3）生成一个将在各个处理器上执行的SPMD程序。

下面我们将讨论如何寻找仿射分划函数，如何生成一个顺序程序来串行执行各个分划，以及如何生成一个在不同处理器上执行各个分划的SPMD程序。在从11.8节到11.9.9节讨论了如何处理带有同步的并行性之后，我们将在11.10节回到上面的第2步，并讨论如何针对单处理器和多处理器系统进行局部性优化。