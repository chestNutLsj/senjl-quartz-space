## 11.10　局部性优化

不管一个处理器是不是某个多处理器系统的一部分，它的性能和它的高速缓存的行为密切相关。高速缓存中的脱靶可能要花费几十个时钟周期，因此高速缓存的高脱靶率会使处理器性能降低。在带有公共内存总线的多处理器系统的背景下，对总线的竞争会进一步加剧低劣的数据局部性所带来的损失。

我们将看到，即使我们只是希望提高单处理器系统的数据局部性，用于并行化的仿射分划算法也是有用的。它是一个有效的寻找循环转换机会的工具。在本节中，我们描述了三种在单处理器系统和多处理器系统中提高数据局部性的技术。

1）我们试图在计算结果生成之后尽快地使用它们，以提高计算结果的时间局部性。提高时间局部性的方法是把一个计算任务分割成为独立的分划单元，并把各个分划单元中具有依赖关系的运算紧靠在一起执行。

2）数组收缩（array contraction）技术降低了一个数组的维度，且降低了被访问内存位置的数目。如果在任意给定时刻该数组只有一个位置被使用，我们就可以应用数组收缩技术。

3）除了提高计算结果的时间局部性，我们也需要优化计算结果的空间局部性，同时优化只读数据的时间和空间局部性。我们可以交替执行多个分划单元，而不是一个接一个地执行它们。这样做可以使得分划单元之间的复用更加靠近。