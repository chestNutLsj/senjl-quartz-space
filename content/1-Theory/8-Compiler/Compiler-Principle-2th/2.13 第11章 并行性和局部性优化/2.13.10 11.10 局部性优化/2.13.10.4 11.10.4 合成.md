### 11.10.4　合成

算法11.71对一个单处理器系统的局部性进行了优化，而算法11.72则对一个多处理器系统的并行性和局部性进行了优化。

算法11.71　在一个单处理器系统上优化数据局部性。

输入：一个带有仿射数组访问的程序。

输出：一个最大化数据局部性的等价程序。

方法：执行下列步骤：

1）应用算法11.64来优化计算结果的时间局部性。

2）应用算法11.68在可能的时候收缩数组。

3）利用11.5节中描述的技术，确定可能共享相同数据或高速缓存线的迭代子空间。对于每个语句，找出具有数据复用的外层并行循环的维度。

4）对每个带有数据复用的外层并行循环，重复使用基本的交织方法，把一个迭代分块移动到最内层块中。

5）对位于那些带有复用的最内层的完全可交换循环中的维度的子集应用分块技术。

6）对外层完全可交换循环嵌套结构进行分块，其目的是利用内存层次结构中的更高层存储设备，比如第三层高速缓存或物理内存。

7）在必要的地方按照块的边长扩展标量或者数组。

算法11.72　针对多处理器系统优化并行性和数据局部性。

输入：一个带有仿射数组访问的程序。

输出：一个最大化并行性和数据局部性的等价程序。

方法：执行下列步骤：

1）使用算法11.64对这个程序进行并行化，并创建一个SPMD程序。

2）对步骤1中生成的SPMD程序应用算法11.71，以优化它的局部性。