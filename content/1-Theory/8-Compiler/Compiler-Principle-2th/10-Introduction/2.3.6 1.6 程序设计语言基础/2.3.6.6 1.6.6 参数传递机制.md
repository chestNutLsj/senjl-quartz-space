### 1.6.6　参数传递机制

所有的程序设计语言都有关于过程的概念，但是在这些过程如何获取它们的参数方面，不同的语言之间有所不同。在本节，我们将考虑实在参数（在调用过程时使用的参数）是如何与形式参数（在过程定义中使用的参数）关联起来的。使用哪一种传递机制决定了调用代码序列如何处理参数。大多数语言要么使用“值调用”，要么使用“引用调用”，或者两者都用。我们将解释这些术语以及另一个被称为“名调用”的方法，解释后者主要是基于对历史的兴趣。

值调用

在值调用（call-by-value）中，会对实在参数求值（如果它是表达式）或拷贝（如果它是变量）。这些值被放在属于被调用过程的相应形式参数的内存位置上。这种方法在C和Java中使用，也是C++语言及大部分其他语言的一个常用选项。值调用的效果是，被调用过程所做的所有有关形式参数的计算都局限于这个过程，相应的实在参数本身不会被改变。

然而请注意，在C语言中我们可以传递变量的一个指针，使得该变量的值能够被被调用者修改。同样，C、C++和Java中作为参数传递的数组名字实际上向被调用过程传递了一个指向该数组本身的指针或引用。因此，如果a是调用过程的一个数组的名字，且它被以值调用的方式传递给相应的形式参数x，那么像`x［2］=i`这样的赋值语句实际上改变了数组元素a［i］。原因是虽然x是a的值的一个拷贝，但这个值实际上是一个指针，指向被分配给数组a的存储区域的开始处。

类似地，Java中的很多变量实际上是对它们所代表的事物的引用，或者说指针。这个结论对数组、字符串和所有类的对象都有效。虽然Java只使用值调用，但只要我们把一个对象的名字传递给一个被调用过程，那个过程收到的值实际上是这个对象的指针。因此，被调用过程是可以改变这个对象本身的值的。

引用调用

在引用调用（call-by-reference）中，实在参数的地址作为相应的形式参数的值被传递给被调用者。在被调用者的代码中使用形式参数时，实现方法是沿着这个指针找到调用者指明的内存位置。因此，改变形式参数看起来就像是改变了实在参数一样。

但是，如果实在参数是一个表达式，那么在调用之前首先会对表达式求值，然后它的值被存放在一个该值自己的位置上。改变形式参数会改变这个位置上的值，但对调用者的数据没有影响。

C++中的“ref”参数使用的是引用调用。而在很多其他语言中，引用调用也是一种选项。当形式参数是一个大型的对象、数组或结构时，引用调用几乎是必不可少的。原因是严格的值调用要求调用者把整个实在参数拷贝到属于相应形式参数的空间上。当参数很大时，这种拷贝可能代价高昂。正如我们在讨论值调用时所指出的，像Java这样的语言解决数组、字符串和其他对象的参数传递问题的方法是仅仅复制这些对象的引用。结果是，Java运行时就好像它对所有不是基本类型（比如整数、实数等）的参数都使用了引用调用。

名调用

第三种机制——名调用——被早期的程序设计语言Algol 60使用。它要求被调用者的运行方式好像是用实在参数以字面方式替换了被调用者的代码中的形式参数一样。这么做就好像形式参数是一个代表了实在参数的宏。当然被调用过程的局部名字需要进行重命名，以便把它们和调用者中的名字区别开来。当实在参数是一个表达式而不是一个变量时，会发生一些和直觉不符的问题。这也是今天不再采用这种机制的原因之一。