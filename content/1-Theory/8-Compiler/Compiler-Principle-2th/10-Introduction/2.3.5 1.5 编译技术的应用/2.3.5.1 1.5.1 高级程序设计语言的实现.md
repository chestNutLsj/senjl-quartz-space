### 1.5.1　高级程序设计语言的实现

一个高级程序设计语言定义了一个编程抽象：程序员使用这个语言表达算法，而编译器必须把这个程序翻译成目标语言。总的来说，用高级程序设计语言编程比较容易，但是比较低效，也就是说，目标程序运行较慢。使用低级程序设计语言的程序员能够更多地控制一个计算过程，因此从原则上讲，可以产生更加高效的代码。遗憾的是，低级程序比较难编写，而且更糟糕的是可移植性较差，更容易出错，而且更加难以维护。优化编译器包括了提高所生成代码性能的技术，因此弥补了因高层次抽象而引入的低效率。

例1.2　C语言中的关键字register是编译器技术和语言发展互动的一个较早的例子。当C语言在20世纪70年代中期被创立时，人们认为有必要让程序员来控制哪个程序变量应该存放在寄存器中。当有效的寄存器分配技术出现后，这个控制变得没有必要了，大多数现代的程序不再使用这个语言特征。

实际上，使用关键字register的程序还可能损失效率，因为寄存器分配是一类很低层次的问题，程序员常常不是最好的判断这类问题的人选。寄存器分配的最优选择很大程度上取决于一个机器的体系结构的特点。把低层次资源管理的决策，比如寄存器分配，写死在程序中反而有可能损害性能。当运行程序的计算机有别于当初所设定的目标机时更是如此。

对于程序设计语言的选择的变化与不断提高抽象层次的方向是一致的。C语言是在20世纪80年代主流的系统程序设计语言；20世纪90年代开始的很多项目则选择C++；在1995年推出的Java很快在20世纪90年代后期流行起来。在每一轮中引入的新的程序设计语言特征都会推动对于编译器优化的新研究。接下来，我们将给出一个关于主要语言特征的概览，这些特征曾经推动了编译器技术的重要发展。

在实践中，所有的通用程序设计语言，包括C、Fortran和Cobol，都支持用户定义的聚合类型（如数组和结构）和高级控制流（比如循环和过程调用）。如果我们仅仅把每个高级结构和数据存取运算直接翻译成为机器代码，得到的代码将会非常低效。编译器优化的一个组成部分称为数据流优化，它可以对程序的数据流进行分析，并消除这些构造之间的冗余。它们很有效，生成的代码和一个熟练的低级语言程序员所写的代码类似。

面向对象概念首先于1967年在Simula中引入，并被集成到Smalltalk、C++、C#和Java这样的语言中。面向对象的主要思想是

1）数据抽象

2）特性的继承

人们发现这两者都可以使得程序更加模块化和易于维护。面向对象程序和用很多其他语言编写的程序之间的不同在于它们由多得多的（但是较小）过程（在面向对象术语中称为方法（method））组成。因此，编译器优化技术必须能够很好地跨越源程序中的过程边界进行优化。过程内联技术（即把一个过程调用替换为相应过程体）在这里是非常有用的。人们还开发了可以加速虚拟方法分发的优化技术。

Java有很多特征可以使编程变得更容易，其中的很多特征之前已经在别的语言中引入。Java语言是类型安全的；也就是说，一个对象不能被当作另一个无关类型的对象来使用。所有的数组访问运算都会被检查以保证它们在数组的界限之内。Java没有指针，也不允许指针运算。它具有一个内建的垃圾收集机制来自动释放那些不再使用的变量所占用的内存。虽然所有这些特征使得编程变得更加容易，但它们也会引起运行时刻的开销。人们开发了相应的编译优化技术来降低这个开销。比如，消除不必要的下标范围检查，以及把那些在过程之外不可访问的对象分配在栈里而不是堆里。此外，人们还开发了高效的算法来尽量降低垃圾收集的开销。

除此之外，Java用来支持可移植和可移动的代码。程序以Java字节码的方式分发。这些字节码要么被解释执行，要么被动态地（即在运行时刻）编译为本地代码。动态编译也曾经在其他上下文环境中被研究过。在那里，信息在运行时刻被动态地抽取出来，并用来生成更加优化的代码。在动态编译中，尽可能降低编译时间是很重要的，因为编译时间也是运行开销的一部分。一个常用的技术是只编译和优化那些经常运行的程序片断。