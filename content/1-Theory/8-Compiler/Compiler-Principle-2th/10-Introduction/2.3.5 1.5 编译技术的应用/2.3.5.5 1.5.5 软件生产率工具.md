### 1.5.5　软件生产率工具

程序可以说是人类迄今为止生产出的最复杂的工程制品，它们包含了很多很多的细节。要使得程序能够完全正确运行，每个细节都必须是正确的。结果是程序中的错误很是猖獗。错误可以使一个系统崩溃，产生错误的输出，使得系统容易受到安全性攻击，在关键系统中甚至会引起灾难性的运行错误。测试是对系统中的错误进行定位的主要技术。

一个很有意思且很有前景的辅助性方法是通过数据流分析技术静态地（即在程序运行之前）定位错误。数据流分析可以在所有可能的执行路径上找到错误，而不是像程序测试的时候所做的那样，仅仅是在那些由输入数据组合执行的路径上找错误。很多原本为编译器优化所开发的数据流分析技术可以用来创建相应的工具，帮助程序员完成他们的软件工程任务。

找到程序的所有错误是不可判定问题。可以设计一个数据流分析方法来找出所有可能带有某种错误的语句，对程序员发出警告。但是如果这些警告中的大部分都是误报，用户将不会使用这个工具。因此，实用的错误检测器经常既不是健全的也不是完全的。也就是说，它们不可能找出程序中的所有错误，也不能保证报告的所有错误都真正是错误。虽然如此，人们仍然开发了很多种静态分析工具，这些工具能够在实际程序中有效地找到错误，比如释放空指针或已释放过的指针。错误探测器可以是不健全的。这个事实使得它们和编译器的优化有着显著不同。优化器必须是保守的，在任何情况下都不能改变程序的语义。

在本节中，我们将提到使用程序分析技术来提高软件生产效率的几个已有途径。这些分析是在原本为编译器代码优化而开发的技术的基础上建立的。其中静态探测一个程序是否具有安全漏洞的技术是极为重要的。

类型检查

类型检查是一种有效的，且被充分研究的技术，它可以被用于捕捉程序中的不一致性。它可以用来检测一些错误，比如，运算被作用于错误类型的对象上，或者传递给一个过程的参数和该过程的范型（signature）不匹配。通过分析程序中的数据流，程序分析还可以做出比检查类型错误更多的工作。比如，一个指针被赋予了`NULL`值，然后又立刻被释放了，这个程序显然是错误的。

这个技术也可以用来捕捉某种安全漏洞。其中，攻击者可以向程序提供一个字符串或者其他数据，而这些数据没有被程序谨慎使用。一个用户提供的字符串可以被加上一个“危险”的标号。如果没有检查这个字符串是否满足特定的格式，那么它仍然是“危险”的。如果这种类型的字符串能够在某个程序点上影响代码的控制流，那么就存在一个潜在的安全漏洞。

边界检查

相对于较高级的程序设计语言而言，用较低级语言编程更加容易犯错。比如，很多系统中的安全漏洞都是因为用C语言编写的程序中的缓冲区溢出造成的。因为C语言没有数组边界检查，所以必须由用户来保证对数组的访问没有超出边界。因为不能检验用户提供的数据是否可能溢出一个缓冲区，程序可能被欺骗，把一个数据存放到缓冲区之外。攻击者可以巧妙处理这些数据，使得程序做出错误的行为，从而危及系统的安全。人们已经开发了一些技术来寻找程序中的缓冲区溢出，但收效并不显著。

如果程序是用一种包含了自动区间检查的安全的语言编写的，这个问题就不会发生。用来消除程序中的冗余区间检查的数据流分析技术也可以用来定位缓冲区溢出错误。而最大区别在于，没能消除某个区间检查仅仅会导致很小的额外运行时刻开销，而没有指出一个潜在的缓冲区溢出错误却可能危及系统的安全性。因此，虽然使用简单的技术去进行区间检查优化就已经足够了，但在错误探测工具中获得高质量的结果则需要复杂的分析技术，比如在过程之间跟踪指针值的技术。

内存管理工具

垃圾收集机制是在效率和易编程及软件可靠性之间进行折衷处理的另一个极好的例子。自动的内存管理消除了所有的内存管理错误（比如内存泄漏）。这些错误是C或C++程序中问题的主要来源之一。人们开发了很多工具来帮助程序员寻找内存管理错误。比如，Purify是一个能够动态地捕捉内存管理错误的被广泛使用的工具。还有一些能够帮助静态识别部分此类错误的工具也已经被开发出来。