   

## 13.4　用户程序的加载和重定位

好了，现在我们可以开始加载用户程序了。

用户程序加载之前，要先显示一段信息，意思是要加载用户程序了。这是第567、568 行的工作。字符串位于内核数据段中，第367 行声明了标号message_5 并初始化了字符串。

第569 行用于指定用户程序的起始逻辑扇区号。在指令中直接指定数值不是一个好习惯，正确的做法是用伪指令equ 声明成常数，并放到整个程序的起始部分以便修改。

内核的主要任务就是加载和执行用户程序。通常情况下，这样的工作会反复进行。为了方便， 一般要定义成可反复调用的过程。在这里， 我们也是这样做的， 过程的名字叫load_relocate_program。该过程位于第387 行，作用是加载和重定位用户程序。从代码清单中可以看出，它是内核代码段的一个内部过程。