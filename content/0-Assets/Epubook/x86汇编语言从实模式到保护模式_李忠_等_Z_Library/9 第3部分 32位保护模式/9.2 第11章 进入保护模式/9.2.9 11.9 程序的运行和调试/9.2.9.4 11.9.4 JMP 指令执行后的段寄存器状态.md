### 11.9.4　JMP 指令执行后的段寄存器状态

x86 处理器的保护模式分为两种：16 位保护模式和32 位保护模式。处理器加电、设置CR0寄存器的PE 位后，CS 描述符高速缓存器中的D 位是0，处理器根据此位将自己的状态设置为16位保护模式。

16 位保护模式和实模式相比，在指令格式和寻址方式上是相同的。因此，如果进入保护模式后的指令是16 位指令，从理论上来说不会有什么问题。实际上，因为各个段寄存器，特别是数据段寄存器中的内容并没有更新，不适当的内存访问将导致不可预知的问题。

以上所说，是解释为什么进入保护模式后，处理器还能接着往下执行的原因。问题在于，它虽然还能按原来的执行流程进行，但后面的代码是用bits 32 编译的。当处理器处在16 位保护模式时，它会按16 位的方式译码32 位指令，这是不行的。

因此，我们使用了jmp dword 0x0008:flush 指令。这是一个默认地用bits 16 编译，在16 位模式下译码，但要求按32 位执行的指令。所以，它必然具有反转操作数大小的前缀0x66。

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00459.jpeg)

图11-19　执行JMP 指令后的段寄存器内容

如图11-19 所示，这条远转移指令的机器码是66 EA 7E 00 00 00 08 00，在它执行后，我们又一次显示了段寄存器的状态。从图中可以看出，段寄存器CS 及其描述符高速缓存器的内容都已更新为有效内容。此后，处理器根据描述符高速缓存器的D 位（此时为“1”），把自己设置为32 位模式。