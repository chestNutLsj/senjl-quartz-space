### 11.9.3　设置PE 位后的段寄存器状态

一旦设置了控制寄存器CR0 的PE 位，处理器就进入了保护模式。但是，除非我们主动刷新段寄存器的内容，否则，段寄存器依然保持实模式下的内容不变。这就是说，设置了PE 位之后，刚进入保护模式时的段寄存器内容，就是实模式下的段寄存器内容。

如图11-18 所示，我们在执行mov cr0,eax 指令之后立即显示各个段寄存器的内容。实际上，尽管进入了保护模式，但显示的依然是实模式的内容。

从图中可以看出，代码段寄存器CS 描述符高速缓存器的dh 为0x00009300，即，G=0，D=0，L=0，P=1，DPL=00，S=1，TYPE=0011。通俗地说，这是一个粒度为字节的数据段。在实模式下，这些属性信息是没有作用的，定义成数据段也无所谓。

一旦设置了CR0 寄存器的PE 位，进入了保护模式，那么，理论上，这些属性信息就变得有用了，有意义了，但同时也是无效的。原因在于，它应当是一个代码段，而不是数据段。

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00456.jpeg)

图11-18　刚进入保护模式时的段寄存器状态

尽管如此，这对处理器继续取指令和执行指令没有影响。原因是，在保护模式下，对描述符有效与否的检查，通常只在加载段寄存器（选择器），并刷新描述符高速缓存器的时候进行。对代码段来说，典型的例子是远转移或者远过程调用，比如

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00457.jpeg)

而对于数据段来说，典型的例子是加载段选择子，比如

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00458.jpeg)

当这类指令执行时，处理器用指令中给出的选择子找到描述符，如果描述符有效，就将选择子加载到段寄存器（选择器），并把描述符加载到描述符高速缓存器。因此，一个不合格的、无效的描述符不可能被加载到段寄存器的描述符高速缓存器。不过，当前这个情况比较特殊，因为它是进入保护模式前遗留下来的。