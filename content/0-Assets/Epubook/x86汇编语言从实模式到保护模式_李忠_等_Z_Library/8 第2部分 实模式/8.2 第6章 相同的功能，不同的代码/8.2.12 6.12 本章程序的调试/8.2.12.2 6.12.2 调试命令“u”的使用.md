### 6.12.2　调试命令“u”的使用

之所以能够使用调试命令“n”来越过循环体，是因为Bochs 知道控制循环次数的是寄存器CX，它可以自动监视整个循环过程。

但是，“n”命令对于下面的循环结构无效：

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00191.jpeg)

原因很简单，条件转移指令（在这里是jns）不是循环指令，转移到的目标位置一般位于前方（源程序的后面），而不是像这里一样，目标位置是先前已经执行过的指令，于是恰巧构成了一个特殊的循环。

因此，如图6-9 所示，当用“n”命令执行jns show（在图中显示的是jns .-15）后，下一条指令又变成物理地址为0x0000000000007c52 处的指令mov al,byte ptr ds:[bx+si]（即mov al,[bx+si]），因为SF 标志为“0”。

如何越过条件转移指令构造的特殊循环体，往后调试执行呢？要解决这个问题，只需要知道循环体后面那条指令的物理地址即可，这可以使用反汇编命令“u”。

反汇编的意思是根据机器指令代码生成可读的汇编语言指令，正好与汇编过程相反。“u”命令可以使用两个参数，第一个参数是跟在“/”后面的数字，指定反汇编出多少条指令；第二个参数用于指定一个内存地址，Bochs 从这里开始反汇编操作。

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00192.jpeg)

图6-9　在Bochs 中用“n”命令执行jns 指令时的情景

如图6-10 所示，在jns .-15 指令执行前，用“u”命令反汇编。该命令指示从指令jns .-15 所在的地址处（0x0000000000007c5f）开始反汇编，而且只需得到2 条指令即可。注意，如果是从当前地址处开始反汇编，则地址参数可以省略。在这里，只需使用“u/2”即可。

命令下达后，Bochs 迅速做出回应，给出了两条指令，并显示了各自所在的物理地址。很显然，条件转移指令jns 之后的那条指令是mov word ptr es:[di],0x0744，也就是本章程序中的mov word [es:di],0x0744，其物理地址是0x7c61。

依然如图中所示，为了越过这个特殊的循环结构，首先使用“b”命令把0x7c61 设为断点，然后执行“c”命令来连续执行程序，直至发现已经处于断点位置。

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00193.jpeg)

图6-10　使用反汇编命令显示指定地址处的指令