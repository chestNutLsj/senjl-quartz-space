### 5.9.1　开源的Bochs 虚拟机软件

程序员的工作就像是在历险，困难重重，途中不可避免地要遇上暗礁。有时候，少了一个字符，或者多了一个字符，或者拼错了字符，程序就无法成功编译；有时候，尽管能够编译，但程序中存在逻辑错误，要么少写了语句，要么算法不对，运行的时候也得不到正确结果。

有时候，错误的原因很简单，就是因为马虎和误操作，但很难知道问题出在哪里。等到你终于发现的时候，一天，甚至几天的时间已经花掉了。在这种情况下，没有调试工具来找到程序中隐藏的错误是不行的。有时候，即使有调试工具的帮助，也会令人筋疲力尽，不过有总比没有好。在现实的世界里，不管是经验老道的程序设计师，还是刚入门的新手，没有谁敢说自己的程序是不需要调试的。

调试工具并不是智能到可以自动发现程序中的错误，这是不可能的。但是，它可以单步执行你的程序（每执行一条指令后就停下来），或者允许你在程序中设置断点，当它执行到断点位置时就停下来。这时，它可以显示处理器各个寄存器的内容，或者内存单元里的内容。因此，你可以根据机器的状态来判断程序的执行结果是否达到了预期。通过这种方式，你可以逐步逼近出现问题的地方，直到最终发现问题的所在。市面上有多种流行的程序调试工具软件，但它们通常都像你用的其他软件一样工作在操作系统之上。

麻烦的是，本书中的程序全都只能运行在没有操作系统的祼机下。这意味着，所有流行的调试工具都不可用。不过，好消息是，一款叫做Bochs 的软件可以帮助你。

Bochs 是开源软件，是你唯一可选择的调试器。开源意味着，你不用花钱购买就可以使用它。它用软件来模拟处理器取指令和执行指令的过程，以及整个计算机硬件。当它开始运行时，就直接模拟计算机的加电启动过程。正是因为如此，它才有可能做一些调试工作。

很重要的一点是，它本身就是一个虚拟机，类似于VirtualBox。因此，它也就很容易让你单步跟踪硬盘的启动过程，查看寄存器的内容和机器状态。在本书中，我们的程序都是直接从BIOS 那里接管处理器的控制权，因此，Bochs 的这个特点正好能够用来完成调试工作。不像本书中使用的其他工具，bochs 的使用方法在网上很容易搜索到。

要使用Bochs，首先要从它的官网下载安装程序。下载地址是：

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00113.jpeg)

在本书的配书文件包中，有一个关于如何下载、安装和配置Bochs 的帮助文档，有WORD 和PDF 两种格式可以选用。请按照帮助文档的说明，安装和配置好Bochs。

一般来说，你会选择VirtualBox 虚拟机来观察运行结果，而在调试程序时使用Bochs。因此，最好是它们共用同一个虚拟硬盘文件（VHD 文件）。通过阅读帮助文档，你应该已经知道如何做到这一点，这里就不再赘述。