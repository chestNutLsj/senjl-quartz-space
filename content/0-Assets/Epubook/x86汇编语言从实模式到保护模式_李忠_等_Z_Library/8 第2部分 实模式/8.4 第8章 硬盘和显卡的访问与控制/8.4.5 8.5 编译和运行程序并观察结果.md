   

## 8.5　编译和运行程序并观察结果

通常，用户程序执行完毕后，应当重新将控制返回到加载器，加载器可以重新加载和运行其他程序，所有的操作系统都是这么做的。

遗憾的是，我们的加载器不提供这样的功能，而用户程序也没有将控制返回到加载器，而是直接进入无限循环：

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00329.jpeg)

当然，这不是什么了不得的事情，将控制返回到加载器，其实现也不复杂。如果你有兴趣，可以试一试。但是，唯一麻烦的地方是栈，将控制返回的同时，也必须切换到加载器自己的栈，一定要小心！

对本章源代码的讲解到此结束。你可以在配书工具中找到源代码c08_mbr.asm 和c08.asm，或者自己手工编辑这两个文件。

首先编译源程序c08_mbr.asm，将编译后得到的c08_mbr.bin 文件写入虚拟硬盘主引导扇区（逻辑0 扇区）。然后，编译源程序c08.asm，并将生成的c08.bin 文件写入虚拟硬盘的逻辑100 扇区。

注意，在编译c08.asm 时，编译器将会产生警告信息：

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00330.jpeg)

这句话的意思是，c08.asm 源程序的第203 行声明了未初始化的空间。

还记得吗？在那里，我们用resb 伪指令保留了256 字节的栈空间，这段空间是未初始化的。

源程序的编译过程也是排错过程，你该感到高兴，而不是害怕，只有合乎规范的程序才能最终获得通过。编译器通常会有两种提示，一种是错误，另一种是警告。

错误（Error）表明程序中有编译器不认识的指令、不正确的语法和无法解释的内容，在这种情况下，编译器简单地告诉你是哪一行有错误，以及什么性质的错误，并停止编译。

警告（Warning）通常表示程序中有一些不规范的指令用法。在这种情况下，编译器继续完成编译工作，生成编译结果。通常情况下，编译后的结果也能正常运行。

现在，启动虚拟机，正常情况下，运行结果应当如图8-20 所示。

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00331.jpeg)

图8-20　本章程序运行结果