### 8.4.3　过程的嵌套

过程put_string 是在当前代码段定义的，位于代码清单8-2 的第28 行，用于显示给定的字符串。它接受两个参数DS 和BX，分别是字符串所在的段地址和偏移地址。另外，它要求字符串的最后一个数值是0，作为终止的标记。

过程put_string 的工作很简单，它循环从DS:BX 中取得单个字符，判断它是否为0。不为0 则调用另一个过程put_char，为0 则返回主程序。

为此，代码清单8-2 第30 行，从当前数据段中取得一个字符，段地址在DS 中，偏移地址由BX 提供。

第31 行，通过or 指令来促成标志的产生，它的功能类似于

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00324.jpeg)

在这里，or 指令的两个操作数相同，都是寄存器CL，一个数和它自己做“或”运算，结果还是它自己，但计算结果会影响标志寄存器中的某些位。如果ZF 置位，说明取到了串结束标志0，转移到第38 行返回主程序；否则，将取到的字符作为参数调用另一个过程put_char。

当过程put_char 返回后，第34 行，将寄存器BX 的内容加一以指向下一个要显示的字符。

第35 行，无条件转移到当前过程的开始处，重复取字符过程。

允许在一个过程中调用另一个过程，这称为过程嵌套。因为每次调用过程时，处理器都把返回地址压在栈中，返回时从栈中取得返回地址，所以，只要栈是安全的，嵌套的过程都能层层返回。

过程嵌套的层数在原则上是没有限制的，唯一的限制是栈的大小。不要忘了，实模式下，栈的空间最大是64KB，每执行一次过程调用需要2 字节或4 字节，这还没有包括在每个过程内部消耗的栈空间。