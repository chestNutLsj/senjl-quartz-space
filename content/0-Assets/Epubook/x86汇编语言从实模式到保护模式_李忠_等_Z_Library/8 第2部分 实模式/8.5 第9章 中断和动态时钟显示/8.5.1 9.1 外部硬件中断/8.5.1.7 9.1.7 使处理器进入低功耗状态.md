### 9.1.7　使处理器进入低功耗状态

RTC 更新周期结束中断的处理过程可以看成另一个程序，是独立的处理过程，是额外的执行流程，它随时都会发生，但和主程序互不相干。关于它的执行过程，马上就要讲到，现在继续来看主程序。

在为中断过程做了初始化工作之后，主程序还是要继续执行的。代码清单9-1 第163～167行，用于显示中断处理程序已安装成功的消息。

接着，第169～171 行，使段寄存器DS 指向显示缓冲区，并在屏幕上的第12 行33 列显示一个字符“@”，该位置差不多是整个屏幕的中心。表达式12*160 + 33*2 是在指令编译阶段计算的，是该字符在显存中的位置。每个字符在显存中占2 字节的位置，每行80 个字符。

在此之后，主程序就无事可做了。第174 行，hlt 指令使处理器停止执行指令，并处于停机状态，这将降低处理器的功耗。处于停机状态的处理器可以被外部中断唤醒并恢复执行，而且会继续执行hlt 后面的指令。

所以，第174～176 行用于形成一个循环，先是停机，接着某个外部中断使处理器恢复执行。一旦处理器的执行点来到hlt 指令之后，则立即使它继续处于停机状态。

第175 行，使用not 指令将字符@的显示属性反转。not 是按位取反指令，其格式为

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00346.jpeg)

not 指令执行时，会将操作数的每一位反转，原来的0 变成1，原来的1 变成0。比如：

![img](../0-Assets/Epubook/x86汇编语言从实模式到保护模式_李忠_等_Z_Library/images/00347.jpeg)

从显示效果上看，循环将显示属性反转将取得一个动画效果，可以很清楚地看到处理器每次从停机状态被唤醒的过程。not 指令不影响任何标志位。

相对于jmp $指令，使用hlt 指令会大大降低处理器的占用率。Windows 7 操作系统有一个叫做CPU 仪表盘的小工具，当使用jmp $指令时，你会看到处理器占用率是100%；而在一个循环中使用hlt 指令时，该占用率马上降到10%左右，这还是在虚拟机环境下，毕竟宿主操作系统还要占用处理器时间。